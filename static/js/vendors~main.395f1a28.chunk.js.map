{"version":3,"sources":["../../../other/.asdf/installs/nodejs/14.4.0/.npm/lib/node_modules/create-elm-app/node_modules/events/events.js","../node_modules/inherits/inherits_browser.js","../node_modules/immediate/lib/browser.js","../node_modules/argsarray/index.js","../node_modules/spark-md5/spark-md5.js","../../../other/.asdf/installs/nodejs/14.4.0/.npm/lib/node_modules/create-elm-app/node_modules/webpack/buildin/global.js","../node_modules/uuid/index.js","../node_modules/vuvuzela/index.js","../../../other/.asdf/installs/nodejs/14.4.0/.npm/lib/node_modules/create-elm-app/node_modules/promise/lib/core.js","../node_modules/uuid/lib/rng-browser.js","../node_modules/uuid/lib/bytesToUuid.js","../node_modules/pouchdb/lib/index-browser.es.js","../../../other/.asdf/installs/nodejs/14.4.0/.npm/lib/node_modules/create-elm-app/config/polyfills.js","../../../other/.asdf/installs/nodejs/14.4.0/.npm/lib/node_modules/create-elm-app/node_modules/promise/lib/rejection-tracking.js","../../../other/.asdf/installs/nodejs/14.4.0/.npm/lib/node_modules/create-elm-app/node_modules/asap/browser-raw.js","../../../other/.asdf/installs/nodejs/14.4.0/.npm/lib/node_modules/create-elm-app/node_modules/promise/lib/es6-extensions.js","../../../other/.asdf/installs/nodejs/14.4.0/.npm/lib/node_modules/create-elm-app/node_modules/whatwg-fetch/fetch.js","../../../other/.asdf/installs/nodejs/14.4.0/.npm/lib/node_modules/create-elm-app/node_modules/object-assign/index.js","../../../other/.asdf/installs/nodejs/14.4.0/.npm/lib/node_modules/create-elm-app/node_modules/process/browser.js","../node_modules/uuid/v1.js","../node_modules/uuid/v4.js"],"names":["ReflectOwnKeys","R","Reflect","_typeof","ReflectApply","apply","target","receiver","args","Function","prototype","call","ownKeys","Object","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","value","EventEmitter","init","this","module","exports","_events","undefined","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","type","prepend","m","events","existing","create","newListener","emit","unshift","push","length","warned","w","Error","name","emitter","count","console","warn","_onceWrap","state","fired","wrapFn","wrapped","removeListener","arguments","bind","_listeners","unwrap","evlistener","arr","ret","Array","i","unwrapListeners","arrayClone","listenerCount","n","copy","defineProperty","enumerable","get","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","err","message","context","handler","len","listeners","on","addListener","prependListener","once","prependOnceListener","off","list","position","originalListener","shift","index","pop","spliceOne","removeAllListeners","key","keys","rawListeners","eventNames","ctor","superCtor","super_","constructor","writable","configurable","TempCtor","global","scheduleDrain","draining","Mutation","MutationObserver","WebKitMutationObserver","called","observer","nextTick","element","document","createTextNode","observe","characterData","data","setImmediate","MessageChannel","createElement","scriptEl","onreadystatechange","parentNode","removeChild","documentElement","appendChild","setTimeout","channel","port1","onmessage","port2","postMessage","queue","oldQueue","task","fun","factory","hex_chr","md5cycle","x","k","a","b","c","d","md5blk","s","md5blks","charCodeAt","md5blk_array","md51","tail","tmp","lo","hi","substring","toString","match","parseInt","rhex","j","hex","join","toUtf8","str","test","unescape","encodeURIComponent","hexToBinaryString","bytes","substr","String","fromCharCode","SparkMD5","reset","ArrayBuffer","slice","clamp","val","Math","max","min","from","to","num","targetArray","sourceArray","byteLength","begin","end","Uint8Array","append","appendBinary","contents","_buff","_length","_hash","raw","buff","_finish","getState","hash","setState","destroy","hashBinary","content","first","second","result","buffer","subarray","utf8Str2ArrayBuffer","md51_array","__WEBPACK_AMD_DEFINE_RESULT__","define","__WEBPACK_AMD_DEFINE_FACTORY__","__webpack_require__","g","e","window","v1","require","v4","uuid","obj","stack","metaStack","lastMetaElement","lastElementIndex","isArray","stringify","input","next","objPrefix","res","prefix","JSON","hasOwnProperty","parse","collationIndex","parsedNum","numChar","parsedString","lastCh","numConsecutiveSlashes","ch","arrayElement","objElement","parseFloat","asap","noop","LAST_ERROR","IS_ERROR","Promise","fn","_U","_V","_W","_X","doResolve","handle","self","deferred","_Y","cb","onFulfilled","onRejected","ex","tryCallOne","reject","promise","resolve","handleResolved","newValue","then","getThen","finale","_Z","Handler","done","reason","tryCallTwo","_0","safeThen","getRandomValues","crypto","msCrypto","rnds8","rnds","r","random","byteToHex","buf","offset","ExportedSet","ExportedMap","mangle","unmangle","Map$1","_store","Set$1","array","add","mangled","has","forEach","size","Symbol","Map","Set","prop","getOwnPropertyDescriptor","species","supportsMapAndSet","funcToString","objectCtorString","clone","object","newObject","Date","toISOString","Blob","isBinaryObject","cloneArrayBuffer","webkitSlice","cloneBinaryObject","proto","Ctor","isPlainObject","getArguments","toPromise","func","usedCB","fulfill","resp","callback","mesg","adapterFun","_closed","_destroyed","logArgs","origCallback","responseArgs","logApiCall","taskqueue","isReady","addTask","failed","pick","hasLocal","MAX_NUM_CONCURRENT_REQUESTS","identityFunction","formatResultForOpenRevsGet","ok","bulkGet","db","opts","requests","docs","requestsById","request","id","numDocs","numDone","perDocResults","allRequests","nextBatch","batch","docId","docIdx","docRequests","docOpts","open_revs","map","rev","filter","formatResult","param","results","info","processBatch","localStorage","setItem","getItem","hasLocalStorage","Changes","addEventListener","guardedConsole","method","defaultBackOff","maxTimeout","randomNumber","explainError","status","inherits","dbName","inprogress","eventFunction","changesOpts","changes","seq","since","cancelled","onChange","immediate","notifyLocalWindows","notify","$inject_Object_assign","assign","nextSource","nextKey","PouchError","MISSING_BULK_DOCS","MISSING_DOC","REV_CONFLICT","INVALID_ID","MISSING_ID","RESERVED_ID","UNKNOWN_ERROR","BAD_ARG","QUERY_PARSE_ERROR","DOC_VALIDATION","BAD_REQUEST","NOT_AN_OBJECT","IDB_ERROR","INVALID_REV","MISSING_STUB","createError","CustomPouchError","p","generateErrorFromResponse","filterChange","req","hasFilter","query","query_params","change","doc","filterReturn","tryFilter","include_docs","attachments","att","_attachments","stub","flatten","arrs","invalidIdError","isRemote","_remote","parseDesignDocFunctionName","parts","split","normalizeDesignDocFunctionName","normalized","qName","qParser","parser","parseUri","exec","uri","indexOf","decodeURIComponent","replace","$0","$1","$2","scopeEval","source","scope","values","upsert","diffFun","docRev","_rev","newDoc","updated","_id","put","tryAndPut","thisAtob","atob","thisBtoa","btoa","createBlob","properties","builder","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","getBlob","binStringToBluffer","binString","bin","binaryStringToArrayBuffer","b64ToBluffer","b64","readAsBinaryString","blob","reader","FileReader","hasBinaryString","onloadend","binary","arrayBufferToBinaryString","readAsArrayBuffer","blobToBinaryString","blobOrBuffer","blobToBase64","base64","setImmediateShim","MD5_CHUNK_SIZE","appendBlob","start","sliceBlob","arrayBuffer","appendString","string","binaryMd5","inputIsString","chunkSize","chunks","ceil","currentChunk","Md5","loadNextChunk","rawToBase64","stringMd5","deterministic_revs","clonedDoc","_rev_tree","uuidV4","toLowerCase","winningRev","metadata","winningId","winningPos","winningDeleted","node","toVisit","rev_tree","tree","ids","branches","pos","deleted","traverseRevTree","revs","newCtx","ctx","sortByPos","collectLeaves","leaves","isLeaf","acc","sort","reverse","collectConflicts","win","conflicts","leaf","rootToLeaf","paths","history","sortByPos$1","insertSorted","item","comparator","idx","mid","low","high","binarySearch","splice","pathToTree","path","numStemmed","root","currentLeaf","compareTree","mergeTree","in_tree1","in_tree2","tree1","tree2","merged","doMerge","dontExpand","restree","branch","t1","t2","candidateParents","trees","diff","parent","parentIdx","elements","elementsLen","el","merge","depth","newTree","stemmed","stemmedRevs","revHash","stem","getTrees","isDeleted","isLocalId","Changes$1","complete","ee","onDestroy","cancel","pending","lastSeq","isCancelled","tryCatchInChangeListener","validateChanges","processChange","changeList","style","_conflicts","compare","left","right","yankError","compareByIdThenRev","idCompare","_revisions","AbstractPouchDB","TaskQueue","PouchDB","__opts","auto_compaction","backend","adapter","adapters","preferredAdapters","adapterName","use_prefix","parseAdapter","_adapter","valid","fail","onDestroyed","from_constructor","onClosed","prepareForDestruction","ready","_changesFilterPlugin","validate","doChanges","continuous","live","normalize","shouldFilter","descending","limit","newPromise","_changes","update_seq","post","bulkDocs","_putLocal","_deleted","_removeLocal","oldRevId","newRevNum","newRevId","putDoc","_put","new_edits","force","putAttachment","attachmentId","rev$$1","api","createAttachment","prevrevpos","content_type","revpos","removeAttachment","remove","docOrId","optsOrRev","was_delete","revsDiff","missing","addToMissing","revId","_getRevisionTree","missingForId","processDoc","missingObj","compactDocument","maxHeight","revTree","height","edges","prnt","edge","computeHeight","candidates","_doCompaction","compact","_compactionQueue","doNextCompaction","last_seq","_compact","promises","return_docs","row","all","_getLocal","finishOpenRevs","latest","l","_get","revs_info","splittedRev","revNo","currentPath","hashIndex","indexOfRev","_revs_info","_getAttachment","getAttachment","allDocs","skip","start_key","startkey","end_key","endkey","incompatibleOpt","allDocsKeysParse","_allDocs","close","_close","_info","db_name","_type","attachmentError","charAt","attachmentNameError","atts","cleanDocs","_bulkDocs","registerDependentDatabase","dependentDb","depDB","dependentDbs","usePrefix","destroyDb","_destroy","localDoc","deletedMap","trueName","RegExp","execute","AbortController","abort","f$1","fetch","h","Headers","eventEmitter","getFieldFromDoc","parsedField","parseField","fieldName","fields","current","Pouch","destructListeners","_destructionListeners","dbList","setUpEventEmitter","addToPreferredAdapters","plugin","__defaults","defaults","defaultOpts","PouchAlt","url","combinationFields","isCombinationalField","field","getKey","mergeAndedSelectors","selectors","selector","matcher","$eq","fieldMatchers","operator","$gte","$gt","mergeGtGte","$lte","$lt","mergeLtLte","$ne","mergeNe","mergeEq","MIN_MAGNITUDE","MAGNITUDE_DIGITS","SEP","collate","normalizeKey","ai","bi","stringCollate","arrayCollate","ak","bk","objectCollate","Infinity","origKey","toJSON","toIndexableString","expFormat","toExponential","magnitude","neg","magString","padWith","upToLength","padding","targetLength","pad","magForComparison","factor","abs","factorStr","toFixed","numToIndexableString","objKey","indexify","parseNumber","originalIdx","numAsString","magAsString","rowFilter","inMemoryFields","every","docFieldValue","some","orMatchers","find","matchCominationalSelector","matchSelector","userOperator","userValue","matchers","fieldExists","fieldIsNotUndefined","arrayContainsValue","$elemMatch","$allMatch","$exists","$mod","divisor","mod","modField","neValue","$in","$nin","$size","arraySize","$all","arrayContainsAllValues","$regex","regexMatch","$type","typeMatch","view","changesHandler","doc_ids","viewName","ddoc","mapFun","views","rowsMatched","rows","requestDef","fieldSorter","getFieldValuesAsArray","sorting","aRow","bRow","collation","createFieldSorter","filterInMemoryFields","wasAnded","isAndInSelector","isAnd","mergeAndedSelectorsNested","orOrNor","subSelector","massageSelector","matchesSelector","filterName","filterFun","filters","toObject","reduce","version","reservedWords","dataWords","parseRevisionInfo","parseDoc","newEdits","dbOpts","nRevNum","revInfo","revisions","revisionIds","makeRevTreeFromRevisions","specialKey","preprocessAttachment","blobType","asBinary","parseBase64","digest","preprocessString","md5","preprocessBlob","processDocs","revLimit","docInfos","fetchedDocs","tx","writeDoc","overallCallback","idsToDocs","docsDone","docsToDo","checkAllDocsDone","currentDoc","resultsIdx","docWritten","nextDoc","prev","docInfo","splitRev","targetPos","targetId","revExists","previousWinningRev","previouslyDeleted","newRev","rev_map","winningRev$$1","winningRevIsDeleted","delta","updateDoc","rootIsMissing","insertDoc","ADAPTER_VERSION","DOC_STORE","BY_SEQ_STORE","ATTACH_STORE","ATTACH_AND_SEQ_STORE","META_STORE","LOCAL_STORE","DETECT_BLOB_SUPPORT_STORE","idbError","evt","encodeMetadata","json","vuvuzela","safeJsonStringify","deletedOrLocal","decodeMetadata","storedObject","safeJsonParse","decodeDoc","_doc_id_rev","lastIndexOf","readBlobData","body","asBlob","fetchAttachmentsIfNecessary","txn","checkDone","attObj","objectStore","onsuccess","fetchAttachment","postProcessAttachments","compactRevs","possiblyOrphanedDigests","seqStore","attStore","attAndSeqStore","IDBKeyRange","bound","openCursor","only","event","cursor","digestSeq","primaryKey","openTransactionSafely","idb","stores","mode","transaction","runBatchedCursor","keyRange","batchSize","onBatch","keysBatch","valuesBatch","pseudoCursor","onGetAll","onGetAllKeys","onCursor","getAll","getAllKeys","continue","newKeyRange","lastKey","upper","upperOpen","code","lowerBound","idbAllDocs","keyRangeError","inclusiveEnd","upperBound","createKeyRange","inclusive_end","txnResult","oncomplete","onResultsReady","onabort","docCount","updateSeq","docStore","metaStore","docIdRevIndex","allDocsInner","fetchDocAsynchronously","batchValues","batchValue","batchKeys","returnVal","total_rows","maxKey","onSuccess","allDocsKeys","running","applyNext","blobSupportPromise","cachedDBs","openReqList","IdbPouch","action","addDeletedOrLocalIndex","createIndex","unique","migrateLocalStore","localStore","local","docIdRev","range","seqCursor","migrateAttsAndSeqs","digestMap","digests","migrateMetadata","bySeqStore","metadataSeq","onGetMetadataSeq","metadataToStore","_meta","instanceId","reqOpts","attachStore","attachAndSeqStore","docInfoError","metaDoc","allDocsProcessed","docCountDelta","preconditionErrored","onAllDocsProcessed","updateDocCountIfReady","newRevIsDeleted","isUpdate","collectResults","finishDoc","attachmentSaved","saveAttachment","writeAttachments","afterPutDoc","revsToDelete","afterPutMetadata","attsAdded","attsToAdd","onerror","preventDefault","stopPropagation","insertAttachmentMappings","putReq","overallErr","docv","recv","processedAttachment","preprocessAttachments","blobSupport","ontimeout","finish","filename","verifyAttachment","attErr","verifyAttachments","numFetched","readMetadata","revs_limit","fetchExistingDocs","startTransaction","idbBulkDocs","historyNode","attachId","attachment","blobData","doc_count","idb_attachment_format","docIds","numResults","docIdsToMetadata","onGetMetadata","objectStores","winningDocs","metadatas","fetchWinningDocAndMetadata","winningDoc","processMetadataAndWinningDoc","onBatchDone","filtered","oldRev","oStore","oldDoc","openReq","indexedDB","deleteDatabase","cached","open","onupgradeneeded","oldVersion","createObjectStore","keyPath","autoIncrement","createSchema","currentTarget","createLocalStoreSchema","addAttachAndSeqStore","migrations","migration","onversionchange","storedMetaDoc","completeSetup","storeMetaDocIfReady","instanceKey","countDocs","blob$$1","matchedChrome","navigator","userAgent","matchedEdge","checkBlobSupport","msg","tryCode","enqueueTask","CHANGES_BATCH_SIZE","MAX_SIMULTANEOUS_REVS","CHANGES_TIMEOUT_BUFFER","DEFAULT_HEARTBEAT","supportsBulkGetMap","readAttachmentsAsBlobOrBuffer","encodeDocId","preprocessAttachments$1","genDBUrl","genUrl","protocol","host","port","paramsToStr","params","HttpPouch","hasUrlPrefix","user","password","auth","username","getHost","dbUrl","setupPromise","ourFetch","options","headers","credentials","nAuth","token","ua","isIE","isTrident","isEdge","shouldCacheBust","now","adapterFun$$1","setup","fetchJSON","response","v","skip_setup","encodeAttachmentId","uuid$$1","ping","compact_running","interval","doBulkGet","doBulkGetShim","numBatches","onResult","batchNum","subOpts","supportsBulkGet","fetchAttachments","filenames","promiseFactories","doNext","runNextBatch","onError","thisErr","pool","typeFieldDescriptor","__proto__","fetchData","docOrDocs","contentType","process","browser","Content-Type","paramStr","batch_size","heartbeat","requestTimeout","timeout","leftToFetch","feed","seq_interval","param_name","lastFetchedSeq","controller","aborted","fetchOpts","signal","fetched","raw_results_length","QueryParseError","captureStackTrace","NotFoundError","BuiltInError","promisedCallback","sequentialize","promiseFactory","uniq","theSet","mapToKeysArray","createBuiltInError","sum","jLen","jNum","log","evalFunctionWithEval","TaskQueue$1","createView","sourceDB","reduceFun","temporary","localDocName","cachedViews","viewSignature","createViewSignature","_cachedViews","promiseForView","depDbName","fullViewName","depDbs","lastSeqDoc","persistentQueues","tempViewQueue","CHANGES_BATCH_SIZE$1","parseViewName","emitError","builtInReduce","sumsqr","_sumsqr","abstract","mapper","reducer","ddocValidator","tryMap","tryReduce","rereduce","output","sortByKeyThenValue","y","keyCompare","rowToDocId","postprocessAttachments","addHttpParam","paramName","asJson","coerceInteger","integerCandidate","asNumber","checkQueryParseError","startkeyName","endkeyName","group","group_level","optionName","number","checkPositiveInteger","defaultsTo","getQueue","updateView","mapResults","currentSeq","docIdsToChangesAndEmits","metaDocId","defaultMetaDoc","docData","indexableKeysToKeyValues","getKeyValueDocs","kvDocsRes","kvDocs","oldKeys","keyValue","newKeys","kvDoc","processKeyValueDocs","getDocsToPersist","listOfDocsToPersist","docsToPersist","saveKeyValues","processNextBatch","createIndexableKeysToKeyValues","createDocIdsToChangesAndEmits","emittedKeyValue","complexKey","updateViewInQueue","queryView","totalRows","shouldReduce","fetchFromView","viewOpts","expectedKeys","parsedKeyAndDocId","parsedStr","parseIndexableString","onMapResultsReady","finalResults","shouldGroup","groups","lvl","last","groupKey","reduceTry","sliceResults","reduceView","allDocsRes","docIdsToDocs","fetchPromises","keyStart","keyEnd","queryViewInQueue","coerceOptions","_query","customQuery","keysAsString","httpQuery","finalPromiseFactory","stale","queryPromised","viewCleanup","_viewCleanup","customViewCleanup","httpViewCleanup","docsToViews","designDocName","viewsToStatus","ddocName","statusIsGood","viewDBName","destroyPromises","localViewCleanup","createAbstractMapReduce","origMap","reduceFunString","getBuiltIn","mapreduce","isGenOne$1","getDocAttachments","getDocs","src","diffs","resultDocs","hasConflicts","fetchRevisionOneDocs","bulkGetOpts","missingRev","createBulkGetOpts","bulkGetResponse","bulkGetInfo","remoteDoc","doCheckForLocalAttachments","fileHasChanged","getDocAttachmentsFromTargetOrSource","Boolean","CHECKPOINT_VERSION","REPLICATOR","CHECKPOINT_HISTORY_SIZE","updateCheckpoint","checkpoint","session","returnValue","session_id","replicator","Checkpointer","writeCheckpoint","updateTarget","updateSource","writeTargetCheckpoint","writeSourceCheckpoint","isForbiddenError","comparisons","targetDoc","sourceDoc","1","compareReplicationHistory","sourceHistory","targetHistory","S","sourceRest","T","targetRest","hasSessionId","sessionId","props","rest","floor","getCheckpoint","STARTING_BACK_OFF","replicate","currentBatch","checkpointer","batches","pendingBatch","writingCheckpoint","changesCompleted","replicationCompleted","batches_limit","changesPending","changedDocs","start_time","docs_read","docs_written","doc_write_failures","errors","initCheckpointer","queryParams","filterViewName","sortObjectPropertiesByKey","queryData","md5sum","generateReplicationId","writeDocs","completeReplication","errorsById","errorsNo","errorName","finishBatch","outResult","getChanges","onCheckpointError","getBatchDocs","got","startNextBatch","abortReplication","processPendingBatch","immediate$$1","fatalError","end_time","retry","back_off_function","backOffSet","current_back_off","backOff","onChangesComplete","onChangesError","_abortChanges","abortChanges","startChanges","_addedListeners","Replication","toPouch","PouchConstructor","replicateWrapper","replicateRet","sync","Sync","canceled","optsPush","optsPull","pull","pullChange","direction","pushChange","pushDenied","pullDenied","pushPaused","pullPaused","pushActive","pullActive","removed","removeAll","addOneListener","out","success","_readyCalled","replicateMethods","other","enable","DEFAULT_WHITELIST","ReferenceError","enabled","disable","matchWhitelist","cls","displayId","rejections","_1","logged","onHandled","onUnhandled","clearTimeout","allRejections","whitelist","line","logError","rawAsap","requestFlush","capacity","flush","currentIndex","scan","newLength","toggle","BrowserMutationObserver","makeRequestCallFromTimer","timeoutHandle","handleTimer","intervalHandle","setInterval","clearInterval","TRUE","valuePromise","FALSE","NULL","UNDEFINED","ZERO","EMPTYSTRING","iterableToArray","iterable","remaining","race","__webpack_exports__","Request","Response","DOMException","support","searchParams","formData","viewClasses","isArrayBufferView","isView","normalizeName","normalizeValue","iteratorFor","items","iterator","header","consumed","bodyUsed","fileReaderReady","onload","readBlobAsArrayBuffer","bufferClone","Body","_initBody","_bodyInit","_bodyText","isPrototypeOf","_bodyBlob","FormData","_bodyFormData","URLSearchParams","DataView","_bodyArrayBuffer","rejected","text","readAsText","chars","readArrayBufferAsText","decode","oldValue","thisArg","entries","methods","upcased","toUpperCase","referrer","form","trim","bodyInit","statusText","redirectStatuses","redirect","location","xhr","XMLHttpRequest","abortXhr","rawHeaders","getAllResponseHeaders","responseURL","responseText","withCredentials","responseType","setRequestHeader","readyState","removeEventListener","send","polyfill","propIsEnumerable","propertyIsEnumerable","test1","test2","test3","letter","shouldUseNative","symbols","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","currentQueue","queueIndex","cleanUpNextTick","drainQueue","run","marker","runClearTimeout","Item","title","env","argv","versions","binding","cwd","chdir","umask","_nodeId","_clockseq","rng","bytesToUuid","_lastMSecs","_lastNSecs","clockseq","seedBytes","msecs","getTime","nsecs","dt","tl","tmh","ii"],"mappings":"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","file":"static/js/vendors~main.395f1a28.chunk.js","sourcesContent":["// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n","'use strict';\n\nmodule.exports = argsArray;\n\nfunction argsArray(fun) {\n  return function () {\n    var len = arguments.length;\n    if (len) {\n      var args = [];\n      var i = -1;\n      while (++i < len) {\n        args[i] = arguments[i];\n      }\n      return fun.call(this, args);\n    } else {\n      return fun.call(this, []);\n    }\n  };\n}","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} raw     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     raw True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","'use strict';\n\n/**\n * Stringify/parse functions that don't operate\n * recursively, so they avoid call stack exceeded\n * errors.\n */\nexports.stringify = function stringify(input) {\n  var queue = [];\n  queue.push({obj: input});\n\n  var res = '';\n  var next, obj, prefix, val, i, arrayPrefix, keys, k, key, value, objPrefix;\n  while ((next = queue.pop())) {\n    obj = next.obj;\n    prefix = next.prefix || '';\n    val = next.val || '';\n    res += prefix;\n    if (val) {\n      res += val;\n    } else if (typeof obj !== 'object') {\n      res += typeof obj === 'undefined' ? null : JSON.stringify(obj);\n    } else if (obj === null) {\n      res += 'null';\n    } else if (Array.isArray(obj)) {\n      queue.push({val: ']'});\n      for (i = obj.length - 1; i >= 0; i--) {\n        arrayPrefix = i === 0 ? '' : ',';\n        queue.push({obj: obj[i], prefix: arrayPrefix});\n      }\n      queue.push({val: '['});\n    } else { // object\n      keys = [];\n      for (k in obj) {\n        if (obj.hasOwnProperty(k)) {\n          keys.push(k);\n        }\n      }\n      queue.push({val: '}'});\n      for (i = keys.length - 1; i >= 0; i--) {\n        key = keys[i];\n        value = obj[key];\n        objPrefix = (i > 0 ? ',' : '');\n        objPrefix += JSON.stringify(key) + ':';\n        queue.push({obj: value, prefix: objPrefix});\n      }\n      queue.push({val: '{'});\n    }\n  }\n  return res;\n};\n\n// Convenience function for the parse function.\n// This pop function is basically copied from\n// pouchCollate.parseIndexableString\nfunction pop(obj, stack, metaStack) {\n  var lastMetaElement = metaStack[metaStack.length - 1];\n  if (obj === lastMetaElement.element) {\n    // popping a meta-element, e.g. an object whose value is another object\n    metaStack.pop();\n    lastMetaElement = metaStack[metaStack.length - 1];\n  }\n  var element = lastMetaElement.element;\n  var lastElementIndex = lastMetaElement.index;\n  if (Array.isArray(element)) {\n    element.push(obj);\n  } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n    var key = stack.pop();\n    element[key] = obj;\n  } else {\n    stack.push(obj); // obj with key only\n  }\n}\n\nexports.parse = function (str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n  var collationIndex,parsedNum,numChar;\n  var parsedString,lastCh,numConsecutiveSlashes,ch;\n  var arrayElement, objElement;\n  while (true) {\n    collationIndex = str[i++];\n    if (collationIndex === '}' ||\n        collationIndex === ']' ||\n        typeof collationIndex === 'undefined') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack.pop(), stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case ' ':\n      case '\\t':\n      case '\\n':\n      case ':':\n      case ',':\n        break;\n      case 'n':\n        i += 3; // 'ull'\n        pop(null, stack, metaStack);\n        break;\n      case 't':\n        i += 3; // 'rue'\n        pop(true, stack, metaStack);\n        break;\n      case 'f':\n        i += 4; // 'alse'\n        pop(false, stack, metaStack);\n        break;\n      case '0':\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n      case '-':\n        parsedNum = '';\n        i--;\n        while (true) {\n          numChar = str[i++];\n          if (/[\\d\\.\\-e\\+]/.test(numChar)) {\n            parsedNum += numChar;\n          } else {\n            i--;\n            break;\n          }\n        }\n        pop(parseFloat(parsedNum), stack, metaStack);\n        break;\n      case '\"':\n        parsedString = '';\n        lastCh = void 0;\n        numConsecutiveSlashes = 0;\n        while (true) {\n          ch = str[i++];\n          if (ch !== '\"' || (lastCh === '\\\\' &&\n              numConsecutiveSlashes % 2 === 1)) {\n            parsedString += ch;\n            lastCh = ch;\n            if (lastCh === '\\\\') {\n              numConsecutiveSlashes++;\n            } else {\n              numConsecutiveSlashes = 0;\n            }\n          } else {\n            break;\n          }\n        }\n        pop(JSON.parse('\"' + parsedString + '\"'), stack, metaStack);\n        break;\n      case '[':\n        arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '{':\n        objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      default:\n        throw new Error(\n          'unexpectedly reached end of input: ' + collationIndex);\n    }\n  }\n};\n","'use strict';\n\nvar asap = require('asap/raw');\n\nfunction noop() {}\n\n// States:\n//\n// 0 - pending\n// 1 - fulfilled with _value\n// 2 - rejected with _value\n// 3 - adopted the state of another promise, _value\n//\n// once the state is no longer pending (0) it is immutable\n\n// All `_` prefixed properties will be reduced to `_{random number}`\n// at build time to obfuscate them and discourage their use.\n// We don't use symbols or Object.defineProperty to fully hide them\n// because the performance isn't good enough.\n\n\n// to avoid using try/catch inside critical functions, we\n// extract them to here.\nvar LAST_ERROR = null;\nvar IS_ERROR = {};\nfunction getThen(obj) {\n  try {\n    return obj.then;\n  } catch (ex) {\n    LAST_ERROR = ex;\n    return IS_ERROR;\n  }\n}\n\nfunction tryCallOne(fn, a) {\n  try {\n    return fn(a);\n  } catch (ex) {\n    LAST_ERROR = ex;\n    return IS_ERROR;\n  }\n}\nfunction tryCallTwo(fn, a, b) {\n  try {\n    fn(a, b);\n  } catch (ex) {\n    LAST_ERROR = ex;\n    return IS_ERROR;\n  }\n}\n\nmodule.exports = Promise;\n\nfunction Promise(fn) {\n  if (typeof this !== 'object') {\n    throw new TypeError('Promises must be constructed via new');\n  }\n  if (typeof fn !== 'function') {\n    throw new TypeError('Promise constructor\\'s argument is not a function');\n  }\n  this._U = 0;\n  this._V = 0;\n  this._W = null;\n  this._X = null;\n  if (fn === noop) return;\n  doResolve(fn, this);\n}\nPromise._Y = null;\nPromise._Z = null;\nPromise._0 = noop;\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  if (this.constructor !== Promise) {\n    return safeThen(this, onFulfilled, onRejected);\n  }\n  var res = new Promise(noop);\n  handle(this, new Handler(onFulfilled, onRejected, res));\n  return res;\n};\n\nfunction safeThen(self, onFulfilled, onRejected) {\n  return new self.constructor(function (resolve, reject) {\n    var res = new Promise(noop);\n    res.then(resolve, reject);\n    handle(self, new Handler(onFulfilled, onRejected, res));\n  });\n}\nfunction handle(self, deferred) {\n  while (self._V === 3) {\n    self = self._W;\n  }\n  if (Promise._Y) {\n    Promise._Y(self);\n  }\n  if (self._V === 0) {\n    if (self._U === 0) {\n      self._U = 1;\n      self._X = deferred;\n      return;\n    }\n    if (self._U === 1) {\n      self._U = 2;\n      self._X = [self._X, deferred];\n      return;\n    }\n    self._X.push(deferred);\n    return;\n  }\n  handleResolved(self, deferred);\n}\n\nfunction handleResolved(self, deferred) {\n  asap(function() {\n    var cb = self._V === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      if (self._V === 1) {\n        resolve(deferred.promise, self._W);\n      } else {\n        reject(deferred.promise, self._W);\n      }\n      return;\n    }\n    var ret = tryCallOne(cb, self._W);\n    if (ret === IS_ERROR) {\n      reject(deferred.promise, LAST_ERROR);\n    } else {\n      resolve(deferred.promise, ret);\n    }\n  });\n}\nfunction resolve(self, newValue) {\n  // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n  if (newValue === self) {\n    return reject(\n      self,\n      new TypeError('A promise cannot be resolved with itself.')\n    );\n  }\n  if (\n    newValue &&\n    (typeof newValue === 'object' || typeof newValue === 'function')\n  ) {\n    var then = getThen(newValue);\n    if (then === IS_ERROR) {\n      return reject(self, LAST_ERROR);\n    }\n    if (\n      then === self.then &&\n      newValue instanceof Promise\n    ) {\n      self._V = 3;\n      self._W = newValue;\n      finale(self);\n      return;\n    } else if (typeof then === 'function') {\n      doResolve(then.bind(newValue), self);\n      return;\n    }\n  }\n  self._V = 1;\n  self._W = newValue;\n  finale(self);\n}\n\nfunction reject(self, newValue) {\n  self._V = 2;\n  self._W = newValue;\n  if (Promise._Z) {\n    Promise._Z(self, newValue);\n  }\n  finale(self);\n}\nfunction finale(self) {\n  if (self._U === 1) {\n    handle(self, self._X);\n    self._X = null;\n  }\n  if (self._U === 2) {\n    for (var i = 0; i < self._X.length; i++) {\n      handle(self, self._X[i]);\n    }\n    self._X = null;\n  }\n}\n\nfunction Handler(onFulfilled, onRejected, promise){\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, promise) {\n  var done = false;\n  var res = tryCallTwo(fn, function (value) {\n    if (done) return;\n    done = true;\n    resolve(promise, value);\n  }, function (reason) {\n    if (done) return;\n    done = true;\n    reject(promise, reason);\n  });\n  if (!done && res === IS_ERROR) {\n    done = true;\n    reject(promise, LAST_ERROR);\n  }\n}\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto\n// implementation. Also, find the complete implementation of crypto on IE11.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && typeof window.msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto));\n\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([bth[buf[i++]], bth[buf[i++]], \n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]]]).join('');\n}\n\nmodule.exports = bytesToUuid;\n","import immediate from 'immediate';\nimport uuidV4 from 'uuid';\nimport Md5 from 'spark-md5';\nimport vuvuzela from 'vuvuzela';\nimport getArguments from 'argsarray';\nimport inherits from 'inherits';\nimport { EventEmitter } from 'events';\n\nfunction mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new ExportedMap();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar $inject_Object_assign = assign;\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nvar thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\n\nvar setImmediateShim = global.setImmediate || global.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return thisBtoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\n// We fetch all leafs of the revision tree, and sort them based on tree length\n// and whether they were deleted, undeleted documents with the longest revision\n// tree (most edits) win\n// The final sort algorithm is slightly documented in a sidebar here:\n// http://guide.couchdb.org/draft/conflicts.html\nfunction winningRev(metadata) {\n  var winningId;\n  var winningPos;\n  var winningDeleted;\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var tree = node.ids;\n    var branches = tree[2];\n    var pos = node.pos;\n    if (branches.length) { // non-leaf\n      for (var i = 0, len = branches.length; i < len; i++) {\n        toVisit.push({pos: pos + 1, ids: branches[i]});\n      }\n      continue;\n    }\n    var deleted = !!tree[1].deleted;\n    var id = tree[0];\n    // sort by deleted, then pos, then id\n    if (!winningId || (winningDeleted !== deleted ? winningDeleted :\n        winningPos !== pos ? winningPos < pos : winningId < id)) {\n      winningId = id;\n      winningPos = pos;\n      winningDeleted = deleted;\n    }\n  }\n\n  return winningPos + '-' + winningId;\n}\n\n// Pretty much all below can be combined into a higher order function to\n// traverse revisions\n// The return value from the callback will be passed as context to all\n// children of that node\nfunction traverseRevTree(revs, callback) {\n  var toVisit = revs.slice();\n\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var branches = tree[2];\n    var newCtx =\n      callback(branches.length === 0, pos, tree[0], node.ctx, tree[1]);\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], ctx: newCtx});\n    }\n  }\n}\n\nfunction sortByPos(a, b) {\n  return a.pos - b.pos;\n}\n\nfunction collectLeaves(revs) {\n  var leaves = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, acc, opts) {\n    if (isLeaf) {\n      leaves.push({rev: pos + \"-\" + id, pos: pos, opts: opts});\n    }\n  });\n  leaves.sort(sortByPos).reverse();\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    delete leaves[i].pos;\n  }\n  return leaves;\n}\n\n// returns revs of all conflicts that is leaves such that\n// 1. are not deleted and\n// 2. are different than winning revision\nfunction collectConflicts(metadata) {\n  var win = winningRev(metadata);\n  var leaves = collectLeaves(metadata.rev_tree);\n  var conflicts = [];\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    var leaf = leaves[i];\n    if (leaf.rev !== win && !leaf.opts.deleted) {\n      conflicts.push(leaf.rev);\n    }\n  }\n  return conflicts;\n}\n\n// compact a tree by marking its non-leafs as missing,\n// and return a list of revs to delete\nfunction compactTree(metadata) {\n  var revs = [];\n  traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                               revHash, ctx, opts) {\n    if (opts.status === 'available' && !isLeaf) {\n      revs.push(pos + '-' + revHash);\n      opts.status = 'missing';\n    }\n  });\n  return revs;\n}\n\n// build up a list of all the paths to the leafs in this revision tree\nfunction rootToLeaf(revs) {\n  var paths = [];\n  var toVisit = revs.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, opts: opts});\n    if (isLeaf) {\n      paths.push({pos: (pos + 1 - history.length), ids: history});\n    }\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], history: history});\n    }\n  }\n  return paths.reverse();\n}\n\n// for a better overview of what this is doing, read:\n\nfunction sortByPos$1(a, b) {\n  return a.pos - b.pos;\n}\n\n// classic binary search\nfunction binarySearch(arr, item, comparator) {\n  var low = 0;\n  var high = arr.length;\n  var mid;\n  while (low < high) {\n    mid = (low + high) >>> 1;\n    if (comparator(arr[mid], item) < 0) {\n      low = mid + 1;\n    } else {\n      high = mid;\n    }\n  }\n  return low;\n}\n\n// assuming the arr is sorted, insert the item in the proper place\nfunction insertSorted(arr, item, comparator) {\n  var idx = binarySearch(arr, item, comparator);\n  arr.splice(idx, 0, item);\n}\n\n// Turn a path as a flat array into a tree with a single branch.\n// If any should be stemmed from the beginning of the array, that's passed\n// in as the second argument\nfunction pathToTree(path, numStemmed) {\n  var root;\n  var leaf;\n  for (var i = numStemmed, len = path.length; i < len; i++) {\n    var node = path[i];\n    var currentLeaf = [node.id, node.opts, []];\n    if (leaf) {\n      leaf[2].push(currentLeaf);\n      leaf = currentLeaf;\n    } else {\n      root = leaf = currentLeaf;\n    }\n  }\n  return root;\n}\n\n// compare the IDs of two trees\nfunction compareTree(a, b) {\n  return a[0] < b[0] ? -1 : 1;\n}\n\n// Merge two trees together\n// The roots of tree1 and tree2 must be the same revision\nfunction mergeTree(in_tree1, in_tree2) {\n  var queue = [{tree1: in_tree1, tree2: in_tree2}];\n  var conflicts = false;\n  while (queue.length > 0) {\n    var item = queue.pop();\n    var tree1 = item.tree1;\n    var tree2 = item.tree2;\n\n    if (tree1[1].status || tree2[1].status) {\n      tree1[1].status =\n        (tree1[1].status ===  'available' ||\n        tree2[1].status === 'available') ? 'available' : 'missing';\n    }\n\n    for (var i = 0; i < tree2[2].length; i++) {\n      if (!tree1[2][0]) {\n        conflicts = 'new_leaf';\n        tree1[2][0] = tree2[2][i];\n        continue;\n      }\n\n      var merged = false;\n      for (var j = 0; j < tree1[2].length; j++) {\n        if (tree1[2][j][0] === tree2[2][i][0]) {\n          queue.push({tree1: tree1[2][j], tree2: tree2[2][i]});\n          merged = true;\n        }\n      }\n      if (!merged) {\n        conflicts = 'new_branch';\n        insertSorted(tree1[2], tree2[2][i], compareTree);\n      }\n    }\n  }\n  return {conflicts: conflicts, tree: in_tree1};\n}\n\nfunction doMerge(tree, path, dontExpand) {\n  var restree = [];\n  var conflicts = false;\n  var merged = false;\n  var res;\n\n  if (!tree.length) {\n    return {tree: [path], conflicts: 'new_leaf'};\n  }\n\n  for (var i = 0, len = tree.length; i < len; i++) {\n    var branch = tree[i];\n    if (branch.pos === path.pos && branch.ids[0] === path.ids[0]) {\n      // Paths start at the same position and have the same root, so they need\n      // merged\n      res = mergeTree(branch.ids, path.ids);\n      restree.push({pos: branch.pos, ids: res.tree});\n      conflicts = conflicts || res.conflicts;\n      merged = true;\n    } else if (dontExpand !== true) {\n      // The paths start at a different position, take the earliest path and\n      // traverse up until it as at the same point from root as the path we\n      // want to merge.  If the keys match we return the longer path with the\n      // other merged After stemming we dont want to expand the trees\n\n      var t1 = branch.pos < path.pos ? branch : path;\n      var t2 = branch.pos < path.pos ? path : branch;\n      var diff = t2.pos - t1.pos;\n\n      var candidateParents = [];\n\n      var trees = [];\n      trees.push({ids: t1.ids, diff: diff, parent: null, parentIdx: null});\n      while (trees.length > 0) {\n        var item = trees.pop();\n        if (item.diff === 0) {\n          if (item.ids[0] === t2.ids[0]) {\n            candidateParents.push(item);\n          }\n          continue;\n        }\n        var elements = item.ids[2];\n        for (var j = 0, elementsLen = elements.length; j < elementsLen; j++) {\n          trees.push({\n            ids: elements[j],\n            diff: item.diff - 1,\n            parent: item.ids,\n            parentIdx: j\n          });\n        }\n      }\n\n      var el = candidateParents[0];\n\n      if (!el) {\n        restree.push(branch);\n      } else {\n        res = mergeTree(el.ids, t2.ids);\n        el.parent[2][el.parentIdx] = res.tree;\n        restree.push({pos: t1.pos, ids: t1.ids});\n        conflicts = conflicts || res.conflicts;\n        merged = true;\n      }\n    } else {\n      restree.push(branch);\n    }\n  }\n\n  // We didnt find\n  if (!merged) {\n    restree.push(path);\n  }\n\n  restree.sort(sortByPos$1);\n\n  return {\n    tree: restree,\n    conflicts: conflicts || 'internal_node'\n  };\n}\n\n// To ensure we dont grow the revision tree infinitely, we stem old revisions\nfunction stem(tree, depth) {\n  // First we break out the tree into a complete list of root to leaf paths\n  var paths = rootToLeaf(tree);\n  var stemmedRevs;\n\n  var result;\n  for (var i = 0, len = paths.length; i < len; i++) {\n    // Then for each path, we cut off the start of the path based on the\n    // `depth` to stem to, and generate a new set of flat trees\n    var path = paths[i];\n    var stemmed = path.ids;\n    var node;\n    if (stemmed.length > depth) {\n      // only do the stemming work if we actually need to stem\n      if (!stemmedRevs) {\n        stemmedRevs = {}; // avoid allocating this object unnecessarily\n      }\n      var numStemmed = stemmed.length - depth;\n      node = {\n        pos: path.pos + numStemmed,\n        ids: pathToTree(stemmed, numStemmed)\n      };\n\n      for (var s = 0; s < numStemmed; s++) {\n        var rev = (path.pos + s) + '-' + stemmed[s].id;\n        stemmedRevs[rev] = true;\n      }\n    } else { // no need to actually stem\n      node = {\n        pos: path.pos,\n        ids: pathToTree(stemmed, 0)\n      };\n    }\n\n    // Then we remerge all those flat trees together, ensuring that we dont\n    // connect trees that would go beyond the depth limit\n    if (result) {\n      result = doMerge(result, node, true).tree;\n    } else {\n      result = [node];\n    }\n  }\n\n  // this is memory-heavy per Chrome profiler, avoid unless we actually stemmed\n  if (stemmedRevs) {\n    traverseRevTree(result, function (isLeaf, pos, revHash) {\n      // some revisions may have been removed in a branch but not in another\n      delete stemmedRevs[pos + '-' + revHash];\n    });\n  }\n\n  return {\n    tree: result,\n    revs: stemmedRevs ? Object.keys(stemmedRevs) : []\n  };\n}\n\nfunction merge(tree, path, depth) {\n  var newTree = doMerge(tree, path);\n  var stemmed = stem(newTree.tree, depth);\n  return {\n    tree: stemmed.tree,\n    stemmedRevs: stemmed.revs,\n    conflicts: newTree.conflicts\n  };\n}\n\n// return true if a rev exists in the rev tree, false otherwise\nfunction revExists(revs, rev) {\n  var toVisit = revs.slice();\n  var splitRev = rev.split('-');\n  var targetPos = parseInt(splitRev[0], 10);\n  var targetId = splitRev[1];\n\n  var node;\n  while ((node = toVisit.pop())) {\n    if (node.pos === targetPos && node.ids[0] === targetId) {\n      return true;\n    }\n    var branches = node.ids[2];\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: node.pos + 1, ids: branches[i]});\n    }\n  }\n  return false;\n}\n\nfunction getTrees(node) {\n  return node.ids;\n}\n\n// check if a specific revision of a doc has been deleted\n//  - metadata: the metadata object from the doc store\n//  - rev: (optional) the revision to check. defaults to winning revision\nfunction isDeleted(metadata, rev) {\n  if (!rev) {\n    rev = winningRev(metadata);\n  }\n  var id = rev.substring(rev.indexOf('-') + 1);\n  var toVisit = metadata.rev_tree.map(getTrees);\n\n  var tree;\n  while ((tree = toVisit.pop())) {\n    if (tree[0] === id) {\n      return !!tree[1].deleted;\n    }\n    toVisit = toVisit.concat(tree[2]);\n  }\n}\n\nfunction isLocalId(id) {\n  return (/^_local/).test(id);\n}\n\n// returns the current leaf node for a given revision\nfunction latest(rev, metadata) {\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, pos: pos, opts: opts});\n\n    if (isLeaf) {\n      for (var i = 0, len = history.length; i < len; i++) {\n        var historyNode = history[i];\n        var historyRev = historyNode.pos + '-' + historyNode.id;\n\n        if (historyRev === rev) {\n          // return the rev of this leaf\n          return pos + '-' + id;\n        }\n      }\n    }\n\n    for (var j = 0, l = branches.length; j < l; j++) {\n      toVisit.push({pos: pos + 1, ids: branches[j], history: history});\n    }\n  }\n\n  /* istanbul ignore next */\n  throw new Error('Unable to resolve latest revision for id ' + metadata.id + ', rev ' + rev);\n}\n\ninherits(Changes$1, EventEmitter);\n\nfunction tryCatchInChangeListener(self, change, pending, lastSeq) {\n  // isolate try/catches to avoid V8 deoptimizations\n  try {\n    self.emit('change', change, pending, lastSeq);\n  } catch (e) {\n    guardedConsole('error', 'Error in .on(\"change\", function):', e);\n  }\n}\n\nfunction Changes$1(db, opts, callback) {\n  EventEmitter.call(this);\n  var self = this;\n  this.db = db;\n  opts = opts ? clone(opts) : {};\n  var complete = opts.complete = once(function (err, resp) {\n    if (err) {\n      if (listenerCount(self, 'error') > 0) {\n        self.emit('error', err);\n      }\n    } else {\n      self.emit('complete', resp);\n    }\n    self.removeAllListeners();\n    db.removeListener('destroyed', onDestroy);\n  });\n  if (callback) {\n    self.on('complete', function (resp) {\n      callback(null, resp);\n    });\n    self.on('error', callback);\n  }\n  function onDestroy() {\n    self.cancel();\n  }\n  db.once('destroyed', onDestroy);\n\n  opts.onChange = function (change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (self.isCancelled) {\n      return;\n    }\n    tryCatchInChangeListener(self, change, pending, lastSeq);\n  };\n\n  var promise = new Promise(function (fulfill, reject) {\n    opts.complete = function (err, res) {\n      if (err) {\n        reject(err);\n      } else {\n        fulfill(res);\n      }\n    };\n  });\n  self.once('cancel', function () {\n    db.removeListener('destroyed', onDestroy);\n    opts.complete(null, {status: 'cancelled'});\n  });\n  this.then = promise.then.bind(promise);\n  this['catch'] = promise['catch'].bind(promise);\n  this.then(function (result) {\n    complete(null, result);\n  }, complete);\n\n\n\n  if (!db.taskqueue.isReady) {\n    db.taskqueue.addTask(function (failed) {\n      if (failed) {\n        opts.complete(failed);\n      } else if (self.isCancelled) {\n        self.emit('cancel');\n      } else {\n        self.validateChanges(opts);\n      }\n    });\n  } else {\n    self.validateChanges(opts);\n  }\n}\nChanges$1.prototype.cancel = function () {\n  this.isCancelled = true;\n  if (this.db.taskqueue.isReady) {\n    this.emit('cancel');\n  }\n};\nfunction processChange(doc, metadata, opts) {\n  var changeList = [{rev: doc._rev}];\n  if (opts.style === 'all_docs') {\n    changeList = collectLeaves(metadata.rev_tree)\n    .map(function (x) { return {rev: x.rev}; });\n  }\n  var change = {\n    id: metadata.id,\n    changes: changeList,\n    doc: doc\n  };\n\n  if (isDeleted(metadata, doc._rev)) {\n    change.deleted = true;\n  }\n  if (opts.conflicts) {\n    change.doc._conflicts = collectConflicts(metadata);\n    if (!change.doc._conflicts.length) {\n      delete change.doc._conflicts;\n    }\n  }\n  return change;\n}\n\nChanges$1.prototype.validateChanges = function (opts) {\n  var callback = opts.complete;\n  var self = this;\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.validate(opts, function (err) {\n      if (err) {\n        return callback(err);\n      }\n      self.doChanges(opts);\n    });\n  } else {\n    self.doChanges(opts);\n  }\n};\n\nChanges$1.prototype.doChanges = function (opts) {\n  var self = this;\n  var callback = opts.complete;\n\n  opts = clone(opts);\n  if ('live' in opts && !('continuous' in opts)) {\n    opts.continuous = opts.live;\n  }\n  opts.processChange = processChange;\n\n  if (opts.since === 'latest') {\n    opts.since = 'now';\n  }\n  if (!opts.since) {\n    opts.since = 0;\n  }\n  if (opts.since === 'now') {\n    this.db.info().then(function (info) {\n      /* istanbul ignore if */\n      if (self.isCancelled) {\n        callback(null, {status: 'cancelled'});\n        return;\n      }\n      opts.since = info.update_seq;\n      self.doChanges(opts);\n    }, callback);\n    return;\n  }\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.normalize(opts);\n    if (PouchDB._changesFilterPlugin.shouldFilter(this, opts)) {\n      return PouchDB._changesFilterPlugin.filter(this, opts);\n    }\n  } else {\n    ['doc_ids', 'filter', 'selector', 'view'].forEach(function (key) {\n      if (key in opts) {\n        guardedConsole('warn',\n          'The \"' + key + '\" option was passed in to changes/replicate, ' +\n          'but pouchdb-changes-filter plugin is not installed, so it ' +\n          'was ignored. Please install the plugin to enable filtering.'\n        );\n      }\n    });\n  }\n\n  if (!('descending' in opts)) {\n    opts.descending = false;\n  }\n\n  // 0 and 1 should return 1 document\n  opts.limit = opts.limit === 0 ? 1 : opts.limit;\n  opts.complete = callback;\n  var newPromise = this.db._changes(opts);\n  /* istanbul ignore else */\n  if (newPromise && typeof newPromise.cancel === 'function') {\n    var cancel = self.cancel;\n    self.cancel = getArguments(function (args) {\n      newPromise.cancel();\n      cancel.apply(this, args);\n    });\n  }\n};\n\n/*\n * A generic pouch adapter\n */\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Wrapper for functions that call the bulkdocs api with a single doc,\n// if the first result is an error, return an error\nfunction yankError(callback, docId) {\n  return function (err, results) {\n    if (err || (results[0] && results[0].error)) {\n      err = err || results[0];\n      err.docId = docId;\n      callback(err);\n    } else {\n      callback(null, results.length ? results[0]  : results);\n    }\n  };\n}\n\n// clean docs given to us by the user\nfunction cleanDocs(docs) {\n  for (var i = 0; i < docs.length; i++) {\n    var doc = docs[i];\n    if (doc._deleted) {\n      delete doc._attachments; // ignore atts for deleted docs\n    } else if (doc._attachments) {\n      // filter out extraneous keys from _attachments\n      var atts = Object.keys(doc._attachments);\n      for (var j = 0; j < atts.length; j++) {\n        var att = atts[j];\n        doc._attachments[att] = pick(doc._attachments[att],\n          ['data', 'digest', 'content_type', 'length', 'revpos', 'stub']);\n      }\n    }\n  }\n}\n\n// compare two docs, first by _id then by _rev\nfunction compareByIdThenRev(a, b) {\n  var idCompare = compare(a._id, b._id);\n  if (idCompare !== 0) {\n    return idCompare;\n  }\n  var aStart = a._revisions ? a._revisions.start : 0;\n  var bStart = b._revisions ? b._revisions.start : 0;\n  return compare(aStart, bStart);\n}\n\n// for every node in a revision tree computes its distance from the closest\n// leaf\nfunction computeHeight(revs) {\n  var height = {};\n  var edges = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, prnt) {\n    var rev$$1 = pos + \"-\" + id;\n    if (isLeaf) {\n      height[rev$$1] = 0;\n    }\n    if (prnt !== undefined) {\n      edges.push({from: prnt, to: rev$$1});\n    }\n    return rev$$1;\n  });\n\n  edges.reverse();\n  edges.forEach(function (edge) {\n    if (height[edge.from] === undefined) {\n      height[edge.from] = 1 + height[edge.to];\n    } else {\n      height[edge.from] = Math.min(height[edge.from], 1 + height[edge.to]);\n    }\n  });\n  return height;\n}\n\nfunction allDocsKeysParse(opts) {\n  var keys =  ('limit' in opts) ?\n    opts.keys.slice(opts.skip, opts.limit + opts.skip) :\n    (opts.skip > 0) ? opts.keys.slice(opts.skip) : opts.keys;\n  opts.keys = keys;\n  opts.skip = 0;\n  delete opts.limit;\n  if (opts.descending) {\n    keys.reverse();\n    opts.descending = false;\n  }\n}\n\n// all compaction is done in a queue, to avoid attaching\n// too many listeners at once\nfunction doNextCompaction(self) {\n  var task = self._compactionQueue[0];\n  var opts = task.opts;\n  var callback = task.callback;\n  self.get('_local/compaction').catch(function () {\n    return false;\n  }).then(function (doc) {\n    if (doc && doc.last_seq) {\n      opts.last_seq = doc.last_seq;\n    }\n    self._compact(opts, function (err, res) {\n      /* istanbul ignore if */\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, res);\n      }\n      immediate(function () {\n        self._compactionQueue.shift();\n        if (self._compactionQueue.length) {\n          doNextCompaction(self);\n        }\n      });\n    });\n  });\n}\n\nfunction attachmentNameError(name) {\n  if (name.charAt(0) === '_') {\n    return name + ' is not a valid attachment name, attachment ' +\n      'names cannot start with \\'_\\'';\n  }\n  return false;\n}\n\ninherits(AbstractPouchDB, EventEmitter);\n\nfunction AbstractPouchDB() {\n  EventEmitter.call(this);\n\n  // re-bind prototyped methods\n  for (var p in AbstractPouchDB.prototype) {\n    if (typeof this[p] === 'function') {\n      this[p] = this[p].bind(this);\n    }\n  }\n}\n\nAbstractPouchDB.prototype.post =\n  adapterFun('post', function (doc, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return callback(createError(NOT_AN_OBJECT));\n  }\n  this.bulkDocs({docs: [doc]}, opts, yankError(callback, doc._id));\n});\n\nAbstractPouchDB.prototype.put = adapterFun('put', function (doc, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return cb(createError(NOT_AN_OBJECT));\n  }\n  invalidIdError(doc._id);\n  if (isLocalId(doc._id) && typeof this._putLocal === 'function') {\n    if (doc._deleted) {\n      return this._removeLocal(doc, cb);\n    } else {\n      return this._putLocal(doc, cb);\n    }\n  }\n  var self = this;\n  if (opts.force && doc._rev) {\n    transformForceOptionToNewEditsOption();\n    putDoc(function (err) {\n      var result = err ? null : {ok: true, id: doc._id, rev: doc._rev};\n      cb(err, result);\n    });\n  } else {\n    putDoc(cb);\n  }\n\n  function transformForceOptionToNewEditsOption() {\n    var parts = doc._rev.split('-');\n    var oldRevId = parts[1];\n    var oldRevNum = parseInt(parts[0], 10);\n\n    var newRevNum = oldRevNum + 1;\n    var newRevId = rev();\n\n    doc._revisions = {\n      start: newRevNum,\n      ids: [newRevId, oldRevId]\n    };\n    doc._rev = newRevNum + '-' + newRevId;\n    opts.new_edits = false;\n  }\n  function putDoc(next) {\n    if (typeof self._put === 'function' && opts.new_edits !== false) {\n      self._put(doc, opts, next);\n    } else {\n      self.bulkDocs({docs: [doc]}, opts, yankError(next, doc._id));\n    }\n  }\n});\n\nAbstractPouchDB.prototype.putAttachment =\n  adapterFun('putAttachment', function (docId, attachmentId, rev$$1,\n                                              blob, type) {\n  var api = this;\n  if (typeof type === 'function') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  // Lets fix in https://github.com/pouchdb/pouchdb/issues/3267\n  /* istanbul ignore if */\n  if (typeof type === 'undefined') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  if (!type) {\n    guardedConsole('warn', 'Attachment', attachmentId, 'on document', docId, 'is missing content_type');\n  }\n\n  function createAttachment(doc) {\n    var prevrevpos = '_rev' in doc ? parseInt(doc._rev, 10) : 0;\n    doc._attachments = doc._attachments || {};\n    doc._attachments[attachmentId] = {\n      content_type: type,\n      data: blob,\n      revpos: ++prevrevpos\n    };\n    return api.put(doc);\n  }\n\n  return api.get(docId).then(function (doc) {\n    if (doc._rev !== rev$$1) {\n      throw createError(REV_CONFLICT);\n    }\n\n    return createAttachment(doc);\n  }, function (err) {\n     // create new doc\n    /* istanbul ignore else */\n    if (err.reason === MISSING_DOC.message) {\n      return createAttachment({_id: docId});\n    } else {\n      throw err;\n    }\n  });\n});\n\nAbstractPouchDB.prototype.removeAttachment =\n  adapterFun('removeAttachment', function (docId, attachmentId, rev$$1,\n                                                 callback) {\n  var self = this;\n  self.get(docId, function (err, obj) {\n    /* istanbul ignore if */\n    if (err) {\n      callback(err);\n      return;\n    }\n    if (obj._rev !== rev$$1) {\n      callback(createError(REV_CONFLICT));\n      return;\n    }\n    /* istanbul ignore if */\n    if (!obj._attachments) {\n      return callback();\n    }\n    delete obj._attachments[attachmentId];\n    if (Object.keys(obj._attachments).length === 0) {\n      delete obj._attachments;\n    }\n    self.put(obj, callback);\n  });\n});\n\nAbstractPouchDB.prototype.remove =\n  adapterFun('remove', function (docOrId, optsOrRev, opts, callback) {\n  var doc;\n  if (typeof optsOrRev === 'string') {\n    // id, rev, opts, callback style\n    doc = {\n      _id: docOrId,\n      _rev: optsOrRev\n    };\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n  } else {\n    // doc, opts, callback style\n    doc = docOrId;\n    if (typeof optsOrRev === 'function') {\n      callback = optsOrRev;\n      opts = {};\n    } else {\n      callback = opts;\n      opts = optsOrRev;\n    }\n  }\n  opts = opts || {};\n  opts.was_delete = true;\n  var newDoc = {_id: doc._id, _rev: (doc._rev || opts.rev)};\n  newDoc._deleted = true;\n  if (isLocalId(newDoc._id) && typeof this._removeLocal === 'function') {\n    return this._removeLocal(doc, callback);\n  }\n  this.bulkDocs({docs: [newDoc]}, opts, yankError(callback, newDoc._id));\n});\n\nAbstractPouchDB.prototype.revsDiff =\n  adapterFun('revsDiff', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  var ids = Object.keys(req);\n\n  if (!ids.length) {\n    return callback(null, {});\n  }\n\n  var count = 0;\n  var missing = new ExportedMap();\n\n  function addToMissing(id, revId) {\n    if (!missing.has(id)) {\n      missing.set(id, {missing: []});\n    }\n    missing.get(id).missing.push(revId);\n  }\n\n  function processDoc(id, rev_tree) {\n    // Is this fast enough? Maybe we should switch to a set simulated by a map\n    var missingForId = req[id].slice(0);\n    traverseRevTree(rev_tree, function (isLeaf, pos, revHash, ctx,\n      opts) {\n        var rev$$1 = pos + '-' + revHash;\n        var idx = missingForId.indexOf(rev$$1);\n        if (idx === -1) {\n          return;\n        }\n\n        missingForId.splice(idx, 1);\n        /* istanbul ignore if */\n        if (opts.status !== 'available') {\n          addToMissing(id, rev$$1);\n        }\n      });\n\n    // Traversing the tree is synchronous, so now `missingForId` contains\n    // revisions that were not found in the tree\n    missingForId.forEach(function (rev$$1) {\n      addToMissing(id, rev$$1);\n    });\n  }\n\n  ids.map(function (id) {\n    this._getRevisionTree(id, function (err, rev_tree) {\n      if (err && err.status === 404 && err.message === 'missing') {\n        missing.set(id, {missing: req[id]});\n      } else if (err) {\n        /* istanbul ignore next */\n        return callback(err);\n      } else {\n        processDoc(id, rev_tree);\n      }\n\n      if (++count === ids.length) {\n        // convert LazyMap to object\n        var missingObj = {};\n        missing.forEach(function (value, key) {\n          missingObj[key] = value;\n        });\n        return callback(null, missingObj);\n      }\n    });\n  }, this);\n});\n\n// _bulk_get API for faster replication, as described in\n// https://github.com/apache/couchdb-chttpd/pull/33\n// At the \"abstract\" level, it will just run multiple get()s in\n// parallel, because this isn't much of a performance cost\n// for local databases (except the cost of multiple transactions, which is\n// small). The http adapter overrides this in order\n// to do a more efficient single HTTP request.\nAbstractPouchDB.prototype.bulkGet =\n  adapterFun('bulkGet', function (opts, callback) {\n  bulkGet(this, opts, callback);\n});\n\n// compact one document and fire callback\n// by compacting we mean removing all revisions which\n// are further from the leaf in revision tree than max_height\nAbstractPouchDB.prototype.compactDocument =\n  adapterFun('compactDocument', function (docId, maxHeight, callback) {\n  var self = this;\n  this._getRevisionTree(docId, function (err, revTree) {\n    /* istanbul ignore if */\n    if (err) {\n      return callback(err);\n    }\n    var height = computeHeight(revTree);\n    var candidates = [];\n    var revs = [];\n    Object.keys(height).forEach(function (rev$$1) {\n      if (height[rev$$1] > maxHeight) {\n        candidates.push(rev$$1);\n      }\n    });\n\n    traverseRevTree(revTree, function (isLeaf, pos, revHash, ctx, opts) {\n      var rev$$1 = pos + '-' + revHash;\n      if (opts.status === 'available' && candidates.indexOf(rev$$1) !== -1) {\n        revs.push(rev$$1);\n      }\n    });\n    self._doCompaction(docId, revs, callback);\n  });\n});\n\n// compact the whole database using single document\n// compaction\nAbstractPouchDB.prototype.compact =\n  adapterFun('compact', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  self._compactionQueue = self._compactionQueue || [];\n  self._compactionQueue.push({opts: opts, callback: callback});\n  if (self._compactionQueue.length === 1) {\n    doNextCompaction(self);\n  }\n});\nAbstractPouchDB.prototype._compact = function (opts, callback) {\n  var self = this;\n  var changesOpts = {\n    return_docs: false,\n    last_seq: opts.last_seq || 0\n  };\n  var promises = [];\n\n  function onChange(row) {\n    promises.push(self.compactDocument(row.id, 0));\n  }\n  function onComplete(resp) {\n    var lastSeq = resp.last_seq;\n    Promise.all(promises).then(function () {\n      return upsert(self, '_local/compaction', function deltaFunc(doc) {\n        if (!doc.last_seq || doc.last_seq < lastSeq) {\n          doc.last_seq = lastSeq;\n          return doc;\n        }\n        return false; // somebody else got here first, don't update\n      });\n    }).then(function () {\n      callback(null, {ok: true});\n    }).catch(callback);\n  }\n  self.changes(changesOpts)\n    .on('change', onChange)\n    .on('complete', onComplete)\n    .on('error', callback);\n};\n\n/* Begin api wrappers. Specific functionality to storage belongs in the\n   _[method] */\nAbstractPouchDB.prototype.get = adapterFun('get', function (id, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof id !== 'string') {\n    return cb(createError(INVALID_ID));\n  }\n  if (isLocalId(id) && typeof this._getLocal === 'function') {\n    return this._getLocal(id, cb);\n  }\n  var leaves = [], self = this;\n\n  function finishOpenRevs() {\n    var result = [];\n    var count = leaves.length;\n    /* istanbul ignore if */\n    if (!count) {\n      return cb(null, result);\n    }\n\n    // order with open_revs is unspecified\n    leaves.forEach(function (leaf) {\n      self.get(id, {\n        rev: leaf,\n        revs: opts.revs,\n        latest: opts.latest,\n        attachments: opts.attachments,\n        binary: opts.binary\n      }, function (err, doc) {\n        if (!err) {\n          // using latest=true can produce duplicates\n          var existing;\n          for (var i = 0, l = result.length; i < l; i++) {\n            if (result[i].ok && result[i].ok._rev === doc._rev) {\n              existing = true;\n              break;\n            }\n          }\n          if (!existing) {\n            result.push({ok: doc});\n          }\n        } else {\n          result.push({missing: leaf});\n        }\n        count--;\n        if (!count) {\n          cb(null, result);\n        }\n      });\n    });\n  }\n\n  if (opts.open_revs) {\n    if (opts.open_revs === \"all\") {\n      this._getRevisionTree(id, function (err, rev_tree) {\n        /* istanbul ignore if */\n        if (err) {\n          return cb(err);\n        }\n        leaves = collectLeaves(rev_tree).map(function (leaf) {\n          return leaf.rev;\n        });\n        finishOpenRevs();\n      });\n    } else {\n      if (Array.isArray(opts.open_revs)) {\n        leaves = opts.open_revs;\n        for (var i = 0; i < leaves.length; i++) {\n          var l = leaves[i];\n          // looks like it's the only thing couchdb checks\n          if (!(typeof (l) === \"string\" && /^\\d+-/.test(l))) {\n            return cb(createError(INVALID_REV));\n          }\n        }\n        finishOpenRevs();\n      } else {\n        return cb(createError(UNKNOWN_ERROR, 'function_clause'));\n      }\n    }\n    return; // open_revs does not like other options\n  }\n\n  return this._get(id, opts, function (err, result) {\n    if (err) {\n      err.docId = id;\n      return cb(err);\n    }\n\n    var doc = result.doc;\n    var metadata = result.metadata;\n    var ctx = result.ctx;\n\n    if (opts.conflicts) {\n      var conflicts = collectConflicts(metadata);\n      if (conflicts.length) {\n        doc._conflicts = conflicts;\n      }\n    }\n\n    if (isDeleted(metadata, doc._rev)) {\n      doc._deleted = true;\n    }\n\n    if (opts.revs || opts.revs_info) {\n      var splittedRev = doc._rev.split('-');\n      var revNo       = parseInt(splittedRev[0], 10);\n      var revHash     = splittedRev[1];\n\n      var paths = rootToLeaf(metadata.rev_tree);\n      var path = null;\n\n      for (var i = 0; i < paths.length; i++) {\n        var currentPath = paths[i];\n        var hashIndex = currentPath.ids.map(function (x) { return x.id; })\n          .indexOf(revHash);\n        var hashFoundAtRevPos = hashIndex === (revNo - 1);\n\n        if (hashFoundAtRevPos || (!path && hashIndex !== -1)) {\n          path = currentPath;\n        }\n      }\n\n      /* istanbul ignore if */\n      if (!path) {\n        err = new Error('invalid rev tree');\n        err.docId = id;\n        return cb(err);\n      }\n\n      var indexOfRev = path.ids.map(function (x) { return x.id; })\n        .indexOf(doc._rev.split('-')[1]) + 1;\n      var howMany = path.ids.length - indexOfRev;\n      path.ids.splice(indexOfRev, howMany);\n      path.ids.reverse();\n\n      if (opts.revs) {\n        doc._revisions = {\n          start: (path.pos + path.ids.length) - 1,\n          ids: path.ids.map(function (rev$$1) {\n            return rev$$1.id;\n          })\n        };\n      }\n      if (opts.revs_info) {\n        var pos =  path.pos + path.ids.length;\n        doc._revs_info = path.ids.map(function (rev$$1) {\n          pos--;\n          return {\n            rev: pos + '-' + rev$$1.id,\n            status: rev$$1.opts.status\n          };\n        });\n      }\n    }\n\n    if (opts.attachments && doc._attachments) {\n      var attachments = doc._attachments;\n      var count = Object.keys(attachments).length;\n      if (count === 0) {\n        return cb(null, doc);\n      }\n      Object.keys(attachments).forEach(function (key) {\n        this._getAttachment(doc._id, key, attachments[key], {\n          // Previously the revision handling was done in adapter.js\n          // getAttachment, however since idb-next doesnt we need to\n          // pass the rev through\n          rev: doc._rev,\n          binary: opts.binary,\n          ctx: ctx\n        }, function (err, data) {\n          var att = doc._attachments[key];\n          att.data = data;\n          delete att.stub;\n          delete att.length;\n          if (!--count) {\n            cb(null, doc);\n          }\n        });\n      }, self);\n    } else {\n      if (doc._attachments) {\n        for (var key in doc._attachments) {\n          /* istanbul ignore else */\n          if (doc._attachments.hasOwnProperty(key)) {\n            doc._attachments[key].stub = true;\n          }\n        }\n      }\n      cb(null, doc);\n    }\n  });\n});\n\n// TODO: I dont like this, it forces an extra read for every\n// attachment read and enforces a confusing api between\n// adapter.js and the adapter implementation\nAbstractPouchDB.prototype.getAttachment =\n  adapterFun('getAttachment', function (docId, attachmentId, opts, callback) {\n  var self = this;\n  if (opts instanceof Function) {\n    callback = opts;\n    opts = {};\n  }\n  this._get(docId, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (res.doc._attachments && res.doc._attachments[attachmentId]) {\n      opts.ctx = res.ctx;\n      opts.binary = true;\n      self._getAttachment(docId, attachmentId,\n                          res.doc._attachments[attachmentId], opts, callback);\n    } else {\n      return callback(createError(MISSING_DOC));\n    }\n  });\n});\n\nAbstractPouchDB.prototype.allDocs =\n  adapterFun('allDocs', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  opts.skip = typeof opts.skip !== 'undefined' ? opts.skip : 0;\n  if (opts.start_key) {\n    opts.startkey = opts.start_key;\n  }\n  if (opts.end_key) {\n    opts.endkey = opts.end_key;\n  }\n  if ('keys' in opts) {\n    if (!Array.isArray(opts.keys)) {\n      return callback(new TypeError('options.keys must be an array'));\n    }\n    var incompatibleOpt =\n      ['startkey', 'endkey', 'key'].filter(function (incompatibleOpt) {\n      return incompatibleOpt in opts;\n    })[0];\n    if (incompatibleOpt) {\n      callback(createError(QUERY_PARSE_ERROR,\n        'Query parameter `' + incompatibleOpt +\n        '` is not compatible with multi-get'\n      ));\n      return;\n    }\n    if (!isRemote(this)) {\n      allDocsKeysParse(opts);\n      if (opts.keys.length === 0) {\n        return this._allDocs({limit: 0}, callback);\n      }\n    }\n  }\n\n  return this._allDocs(opts, callback);\n});\n\nAbstractPouchDB.prototype.changes = function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  // By default set return_docs to false if the caller has opts.live = true,\n  // this will prevent us from collecting the set of changes indefinitely\n  // resulting in growing memory\n  opts.return_docs = ('return_docs' in opts) ? opts.return_docs : !opts.live;\n\n  return new Changes$1(this, opts, callback);\n};\n\nAbstractPouchDB.prototype.close = adapterFun('close', function (callback) {\n  this._closed = true;\n  this.emit('closed');\n  return this._close(callback);\n});\n\nAbstractPouchDB.prototype.info = adapterFun('info', function (callback) {\n  var self = this;\n  this._info(function (err, info) {\n    if (err) {\n      return callback(err);\n    }\n    // assume we know better than the adapter, unless it informs us\n    info.db_name = info.db_name || self.name;\n    info.auto_compaction = !!(self.auto_compaction && !isRemote(self));\n    info.adapter = self.adapter;\n    callback(null, info);\n  });\n});\n\nAbstractPouchDB.prototype.id = adapterFun('id', function (callback) {\n  return this._id(callback);\n});\n\n/* istanbul ignore next */\nAbstractPouchDB.prototype.type = function () {\n  return (typeof this._type === 'function') ? this._type() : this.adapter;\n};\n\nAbstractPouchDB.prototype.bulkDocs =\n  adapterFun('bulkDocs', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  if (Array.isArray(req)) {\n    req = {\n      docs: req\n    };\n  }\n\n  if (!req || !req.docs || !Array.isArray(req.docs)) {\n    return callback(createError(MISSING_BULK_DOCS));\n  }\n\n  for (var i = 0; i < req.docs.length; ++i) {\n    if (typeof req.docs[i] !== 'object' || Array.isArray(req.docs[i])) {\n      return callback(createError(NOT_AN_OBJECT));\n    }\n  }\n\n  var attachmentError;\n  req.docs.forEach(function (doc) {\n    if (doc._attachments) {\n      Object.keys(doc._attachments).forEach(function (name) {\n        attachmentError = attachmentError || attachmentNameError(name);\n        if (!doc._attachments[name].content_type) {\n          guardedConsole('warn', 'Attachment', name, 'on document', doc._id, 'is missing content_type');\n        }\n      });\n    }\n  });\n\n  if (attachmentError) {\n    return callback(createError(BAD_REQUEST, attachmentError));\n  }\n\n  if (!('new_edits' in opts)) {\n    if ('new_edits' in req) {\n      opts.new_edits = req.new_edits;\n    } else {\n      opts.new_edits = true;\n    }\n  }\n\n  var adapter = this;\n  if (!opts.new_edits && !isRemote(adapter)) {\n    // ensure revisions of the same doc are sorted, so that\n    // the local adapter processes them correctly (#2935)\n    req.docs.sort(compareByIdThenRev);\n  }\n\n  cleanDocs(req.docs);\n\n  // in the case of conflicts, we want to return the _ids to the user\n  // however, the underlying adapter may destroy the docs array, so\n  // create a copy here\n  var ids = req.docs.map(function (doc) {\n    return doc._id;\n  });\n\n  return this._bulkDocs(req, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (!opts.new_edits) {\n      // this is what couch does when new_edits is false\n      res = res.filter(function (x) {\n        return x.error;\n      });\n    }\n    // add ids for error/conflict responses (not required for CouchDB)\n    if (!isRemote(adapter)) {\n      for (var i = 0, l = res.length; i < l; i++) {\n        res[i].id = res[i].id || ids[i];\n      }\n    }\n\n    callback(null, res);\n  });\n});\n\nAbstractPouchDB.prototype.registerDependentDatabase =\n  adapterFun('registerDependentDatabase', function (dependentDb,\n                                                          callback) {\n  var depDB = new this.constructor(dependentDb, this.__opts);\n\n  function diffFun(doc) {\n    doc.dependentDbs = doc.dependentDbs || {};\n    if (doc.dependentDbs[dependentDb]) {\n      return false; // no update required\n    }\n    doc.dependentDbs[dependentDb] = true;\n    return doc;\n  }\n  upsert(this, '_local/_pouch_dependentDbs', diffFun)\n    .then(function () {\n      callback(null, {db: depDB});\n    }).catch(callback);\n});\n\nAbstractPouchDB.prototype.destroy =\n  adapterFun('destroy', function (opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  var usePrefix = 'use_prefix' in self ? self.use_prefix : true;\n\n  function destroyDb() {\n    // call destroy method of the particular adaptor\n    self._destroy(opts, function (err, resp) {\n      if (err) {\n        return callback(err);\n      }\n      self._destroyed = true;\n      self.emit('destroyed');\n      callback(null, resp || { 'ok': true });\n    });\n  }\n\n  if (isRemote(self)) {\n    // no need to check for dependent DBs if it's a remote DB\n    return destroyDb();\n  }\n\n  self.get('_local/_pouch_dependentDbs', function (err, localDoc) {\n    if (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        return callback(err);\n      } else { // no dependencies\n        return destroyDb();\n      }\n    }\n    var dependentDbs = localDoc.dependentDbs;\n    var PouchDB = self.constructor;\n    var deletedMap = Object.keys(dependentDbs).map(function (name) {\n      // use_prefix is only false in the browser\n      /* istanbul ignore next */\n      var trueName = usePrefix ?\n        name.replace(new RegExp('^' + PouchDB.prefix), '') : name;\n      return new PouchDB(trueName, self.__opts).destroy();\n    });\n    Promise.all(deletedMap).then(destroyDb, callback);\n  });\n});\n\nfunction TaskQueue() {\n  this.isReady = false;\n  this.failed = false;\n  this.queue = [];\n}\n\nTaskQueue.prototype.execute = function () {\n  var fun;\n  if (this.failed) {\n    while ((fun = this.queue.shift())) {\n      fun(this.failed);\n    }\n  } else {\n    while ((fun = this.queue.shift())) {\n      fun();\n    }\n  }\n};\n\nTaskQueue.prototype.fail = function (err) {\n  this.failed = err;\n  this.execute();\n};\n\nTaskQueue.prototype.ready = function (db) {\n  this.isReady = true;\n  this.db = db;\n  this.execute();\n};\n\nTaskQueue.prototype.addTask = function (fun) {\n  this.queue.push(fun);\n  if (this.failed) {\n    this.execute();\n  }\n};\n\nfunction parseAdapter(name, opts) {\n  var match = name.match(/([a-z-]*):\\/\\/(.*)/);\n  if (match) {\n    // the http adapter expects the fully qualified name\n    return {\n      name: /https?/.test(match[1]) ? match[1] + '://' + match[2] : match[2],\n      adapter: match[1]\n    };\n  }\n\n  var adapters = PouchDB.adapters;\n  var preferredAdapters = PouchDB.preferredAdapters;\n  var prefix = PouchDB.prefix;\n  var adapterName = opts.adapter;\n\n  if (!adapterName) { // automatically determine adapter\n    for (var i = 0; i < preferredAdapters.length; ++i) {\n      adapterName = preferredAdapters[i];\n      // check for browsers that have been upgraded from websql-only to websql+idb\n      /* istanbul ignore if */\n      if (adapterName === 'idb' && 'websql' in adapters &&\n          hasLocalStorage() && localStorage['_pouch__websqldb_' + prefix + name]) {\n        // log it, because this can be confusing during development\n        guardedConsole('log', 'PouchDB is downgrading \"' + name + '\" to WebSQL to' +\n          ' avoid data loss, because it was already opened with WebSQL.');\n        continue; // keep using websql to avoid user data loss\n      }\n      break;\n    }\n  }\n\n  var adapter = adapters[adapterName];\n\n  // if adapter is invalid, then an error will be thrown later\n  var usePrefix = (adapter && 'use_prefix' in adapter) ?\n    adapter.use_prefix : true;\n\n  return {\n    name: usePrefix ? (prefix + name) : name,\n    adapter: adapterName\n  };\n}\n\n// OK, so here's the deal. Consider this code:\n//     var db1 = new PouchDB('foo');\n//     var db2 = new PouchDB('foo');\n//     db1.destroy();\n// ^ these two both need to emit 'destroyed' events,\n// as well as the PouchDB constructor itself.\n// So we have one db object (whichever one got destroy() called on it)\n// responsible for emitting the initial event, which then gets emitted\n// by the constructor, which then broadcasts it to any other dbs\n// that may have been created with the same name.\nfunction prepareForDestruction(self) {\n\n  function onDestroyed(from_constructor) {\n    self.removeListener('closed', onClosed);\n    if (!from_constructor) {\n      self.constructor.emit('destroyed', self.name);\n    }\n  }\n\n  function onClosed() {\n    self.removeListener('destroyed', onDestroyed);\n    self.constructor.emit('unref', self);\n  }\n\n  self.once('destroyed', onDestroyed);\n  self.once('closed', onClosed);\n  self.constructor.emit('ref', self);\n}\n\ninherits(PouchDB, AbstractPouchDB);\nfunction PouchDB(name, opts) {\n  // In Node our test suite only tests this for PouchAlt unfortunately\n  /* istanbul ignore if */\n  if (!(this instanceof PouchDB)) {\n    return new PouchDB(name, opts);\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  if (name && typeof name === 'object') {\n    opts = name;\n    name = opts.name;\n    delete opts.name;\n  }\n\n  if (opts.deterministic_revs === undefined) {\n    opts.deterministic_revs = true;\n  }\n\n  this.__opts = opts = clone(opts);\n\n  self.auto_compaction = opts.auto_compaction;\n  self.prefix = PouchDB.prefix;\n\n  if (typeof name !== 'string') {\n    throw new Error('Missing/invalid DB name');\n  }\n\n  var prefixedName = (opts.prefix || '') + name;\n  var backend = parseAdapter(prefixedName, opts);\n\n  opts.name = backend.name;\n  opts.adapter = opts.adapter || backend.adapter;\n\n  self.name = name;\n  self._adapter = opts.adapter;\n  PouchDB.emit('debug', ['adapter', 'Picked adapter: ', opts.adapter]);\n\n  if (!PouchDB.adapters[opts.adapter] ||\n      !PouchDB.adapters[opts.adapter].valid()) {\n    throw new Error('Invalid Adapter: ' + opts.adapter);\n  }\n\n  AbstractPouchDB.call(self);\n  self.taskqueue = new TaskQueue();\n\n  self.adapter = opts.adapter;\n\n  PouchDB.adapters[opts.adapter].call(self, opts, function (err) {\n    if (err) {\n      return self.taskqueue.fail(err);\n    }\n    prepareForDestruction(self);\n\n    self.emit('created', self);\n    PouchDB.emit('created', self.name);\n    self.taskqueue.ready(self);\n  });\n\n}\n\n// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f$1 = fetch;\nvar h = Headers;\n\nPouchDB.adapters = {};\nPouchDB.preferredAdapters = [];\n\nPouchDB.prefix = '_pouch_';\n\nvar eventEmitter = new EventEmitter();\n\nfunction setUpEventEmitter(Pouch) {\n  Object.keys(EventEmitter.prototype).forEach(function (key) {\n    if (typeof EventEmitter.prototype[key] === 'function') {\n      Pouch[key] = eventEmitter[key].bind(eventEmitter);\n    }\n  });\n\n  // these are created in constructor.js, and allow us to notify each DB with\n  // the same name that it was destroyed, via the constructor object\n  var destructListeners = Pouch._destructionListeners = new ExportedMap();\n\n  Pouch.on('ref', function onConstructorRef(db) {\n    if (!destructListeners.has(db.name)) {\n      destructListeners.set(db.name, []);\n    }\n    destructListeners.get(db.name).push(db);\n  });\n\n  Pouch.on('unref', function onConstructorUnref(db) {\n    if (!destructListeners.has(db.name)) {\n      return;\n    }\n    var dbList = destructListeners.get(db.name);\n    var pos = dbList.indexOf(db);\n    if (pos < 0) {\n      /* istanbul ignore next */\n      return;\n    }\n    dbList.splice(pos, 1);\n    if (dbList.length > 1) {\n      /* istanbul ignore next */\n      destructListeners.set(db.name, dbList);\n    } else {\n      destructListeners.delete(db.name);\n    }\n  });\n\n  Pouch.on('destroyed', function onConstructorDestroyed(name) {\n    if (!destructListeners.has(name)) {\n      return;\n    }\n    var dbList = destructListeners.get(name);\n    destructListeners.delete(name);\n    dbList.forEach(function (db) {\n      db.emit('destroyed',true);\n    });\n  });\n}\n\nsetUpEventEmitter(PouchDB);\n\nPouchDB.adapter = function (id, obj, addToPreferredAdapters) {\n  /* istanbul ignore else */\n  if (obj.valid()) {\n    PouchDB.adapters[id] = obj;\n    if (addToPreferredAdapters) {\n      PouchDB.preferredAdapters.push(id);\n    }\n  }\n};\n\nPouchDB.plugin = function (obj) {\n  if (typeof obj === 'function') { // function style for plugins\n    obj(PouchDB);\n  } else if (typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    throw new Error('Invalid plugin: got \"' + obj + '\", expected an object or a function');\n  } else {\n    Object.keys(obj).forEach(function (id) { // object style for plugins\n      PouchDB.prototype[id] = obj[id];\n    });\n  }\n  if (this.__defaults) {\n    PouchDB.__defaults = $inject_Object_assign({}, this.__defaults);\n  }\n  return PouchDB;\n};\n\nPouchDB.defaults = function (defaultOpts) {\n  function PouchAlt(name, opts) {\n    if (!(this instanceof PouchAlt)) {\n      return new PouchAlt(name, opts);\n    }\n\n    opts = opts || {};\n\n    if (name && typeof name === 'object') {\n      opts = name;\n      name = opts.name;\n      delete opts.name;\n    }\n\n    opts = $inject_Object_assign({}, PouchAlt.__defaults, opts);\n    PouchDB.call(this, name, opts);\n  }\n\n  inherits(PouchAlt, PouchDB);\n\n  PouchAlt.preferredAdapters = PouchDB.preferredAdapters.slice();\n  Object.keys(PouchDB).forEach(function (key) {\n    if (!(key in PouchAlt)) {\n      PouchAlt[key] = PouchDB[key];\n    }\n  });\n\n  // make default options transitive\n  // https://github.com/pouchdb/pouchdb/issues/5922\n  PouchAlt.__defaults = $inject_Object_assign({}, this.__defaults, defaultOpts);\n\n  return PouchAlt;\n};\n\nPouchDB.fetch = function (url, opts) {\n  return f$1(url, opts);\n};\n\n// managed automatically by set-version.js\nvar version = \"7.2.1\";\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction compare$1(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n//#7458: execute function mergeAndedSelectors on nested $and\nfunction mergeAndedSelectorsNested(obj) {\n    for (var prop in obj) {\n        if (Array.isArray(obj)) {\n            for (var i in obj) {\n                if (obj[i]['$and']) {\n                    obj[i] = mergeAndedSelectors(obj[i]['$and']);\n                }\n            }\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            mergeAndedSelectorsNested(value); // <- recursive call\n        }\n    }\n    return obj;\n}\n\n//#7458: determine id $and is present in selector (at any level)\nfunction isAndInSelector(obj, isAnd) {\n    for (var prop in obj) {\n        if (prop === '$and') {\n            isAnd = true;\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            isAnd = isAndInSelector(value, isAnd); // <- recursive call\n        }\n    }\n    return isAnd;\n}\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n    //#7458: if $and is present in selector (at any level) merge nested $and\n    if (isAndInSelector(result, false)) {\n        result = mergeAndedSelectorsNested(result);\n        if ('$and' in result) {\n            result = mergeAndedSelectors(result['$and']);\n        }\n        wasAnded = true;\n    }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\nfunction pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare$1(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  // is matcher an object, if so continue recursion\n  if (typeof matcher === 'object') {\n    return Object.keys(matcher).every(function (userOperator) {\n      var userValue = matcher[userOperator];\n      return match(userOperator, doc, userValue, parsedField, docFieldValue);\n    });\n  }\n\n  // no more depth, No need to recurse further\n  return matcher === docFieldValue;\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nfunction evalFilter(input) {\n  return scopeEval('\"use strict\";\\nreturn ' + input + ';', {});\n}\n\nfunction evalView(input) {\n  var code = [\n    'return function(doc) {',\n    '  \"use strict\";',\n    '  var emitted = false;',\n    '  var emit = function (a, b) {',\n    '    emitted = true;',\n    '  };',\n    '  var view = ' + input + ';',\n    '  view(doc);',\n    '  if (emitted) {',\n    '    return true;',\n    '  }',\n    '};'\n  ].join('\\n');\n\n  return scopeEval(code, {});\n}\n\nfunction validate(opts, callback) {\n  if (opts.selector) {\n    if (opts.filter && opts.filter !== '_selector') {\n      var filterName = typeof opts.filter === 'string' ?\n        opts.filter : 'function';\n      return callback(new Error('selector invalid for filter \"' + filterName + '\"'));\n    }\n  }\n  callback();\n}\n\nfunction normalize(opts) {\n  if (opts.view && !opts.filter) {\n    opts.filter = '_view';\n  }\n\n  if (opts.selector && !opts.filter) {\n    opts.filter = '_selector';\n  }\n\n  if (opts.filter && typeof opts.filter === 'string') {\n    if (opts.filter === '_view') {\n      opts.view = normalizeDesignDocFunctionName(opts.view);\n    } else {\n      opts.filter = normalizeDesignDocFunctionName(opts.filter);\n    }\n  }\n}\n\nfunction shouldFilter(changesHandler, opts) {\n  return opts.filter && typeof opts.filter === 'string' &&\n    !opts.doc_ids && !isRemote(changesHandler.db);\n}\n\nfunction filter(changesHandler, opts) {\n  var callback = opts.complete;\n  if (opts.filter === '_view') {\n    if (!opts.view || typeof opts.view !== 'string') {\n      var err = createError(BAD_REQUEST,\n        '`view` filter parameter not found or invalid.');\n      return callback(err);\n    }\n    // fetch a view from a design doc, make it behave like a filter\n    var viewName = parseDesignDocFunctionName(opts.view);\n    changesHandler.db.get('_design/' + viewName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var mapFun = ddoc && ddoc.views && ddoc.views[viewName[1]] &&\n        ddoc.views[viewName[1]].map;\n      if (!mapFun) {\n        return callback(createError(MISSING_DOC,\n          (ddoc.views ? 'missing json key: ' + viewName[1] :\n            'missing json key: views')));\n      }\n      opts.filter = evalView(mapFun);\n      changesHandler.doChanges(opts);\n    });\n  } else if (opts.selector) {\n    opts.filter = function (doc) {\n      return matchesSelector(doc, opts.selector);\n    };\n    changesHandler.doChanges(opts);\n  } else {\n    // fetch a filter from a design doc\n    var filterName = parseDesignDocFunctionName(opts.filter);\n    changesHandler.db.get('_design/' + filterName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var filterFun = ddoc && ddoc.filters && ddoc.filters[filterName[1]];\n      if (!filterFun) {\n        return callback(createError(MISSING_DOC,\n          ((ddoc && ddoc.filters) ? 'missing json key: ' + filterName[1]\n            : 'missing json key: filters')));\n      }\n      opts.filter = evalFilter(filterFun);\n      changesHandler.doChanges(opts);\n    });\n  }\n}\n\nfunction applyChangesFilterPlugin(PouchDB) {\n  PouchDB._changesFilterPlugin = {\n    validate: validate,\n    normalize: normalize,\n    shouldFilter: shouldFilter,\n    filter: filter\n  };\n}\n\n// TODO: remove from pouchdb-core (breaking)\nPouchDB.plugin(applyChangesFilterPlugin);\n\nPouchDB.version = version;\n\nfunction toObject(array) {\n  return array.reduce(function (obj, item) {\n    obj[item] = true;\n    return obj;\n  }, {});\n}\n// List of top level reserved words for doc\nvar reservedWords = toObject([\n  '_id',\n  '_rev',\n  '_attachments',\n  '_deleted',\n  '_revisions',\n  '_revs_info',\n  '_conflicts',\n  '_deleted_conflicts',\n  '_local_seq',\n  '_rev_tree',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats',\n  // Specific to Couchbase Sync Gateway\n  '_removed'\n]);\n\n// List of reserved words that should end up the document\nvar dataWords = toObject([\n  '_attachments',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats'\n]);\n\nfunction parseRevisionInfo(rev$$1) {\n  if (!/^\\d+-/.test(rev$$1)) {\n    return createError(INVALID_REV);\n  }\n  var idx = rev$$1.indexOf('-');\n  var left = rev$$1.substring(0, idx);\n  var right = rev$$1.substring(idx + 1);\n  return {\n    prefix: parseInt(left, 10),\n    id: right\n  };\n}\n\nfunction makeRevTreeFromRevisions(revisions, opts) {\n  var pos = revisions.start - revisions.ids.length + 1;\n\n  var revisionIds = revisions.ids;\n  var ids = [revisionIds[0], opts, []];\n\n  for (var i = 1, len = revisionIds.length; i < len; i++) {\n    ids = [revisionIds[i], {status: 'missing'}, [ids]];\n  }\n\n  return [{\n    pos: pos,\n    ids: ids\n  }];\n}\n\n// Preprocess documents, parse their revisions, assign an id and a\n// revision for new writes that are missing them, etc\nfunction parseDoc(doc, newEdits, dbOpts) {\n  if (!dbOpts) {\n    dbOpts = {\n      deterministic_revs: true\n    };\n  }\n\n  var nRevNum;\n  var newRevId;\n  var revInfo;\n  var opts = {status: 'available'};\n  if (doc._deleted) {\n    opts.deleted = true;\n  }\n\n  if (newEdits) {\n    if (!doc._id) {\n      doc._id = uuid();\n    }\n    newRevId = rev(doc, dbOpts.deterministic_revs);\n    if (doc._rev) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      doc._rev_tree = [{\n        pos: revInfo.prefix,\n        ids: [revInfo.id, {status: 'missing'}, [[newRevId, opts, []]]]\n      }];\n      nRevNum = revInfo.prefix + 1;\n    } else {\n      doc._rev_tree = [{\n        pos: 1,\n        ids : [newRevId, opts, []]\n      }];\n      nRevNum = 1;\n    }\n  } else {\n    if (doc._revisions) {\n      doc._rev_tree = makeRevTreeFromRevisions(doc._revisions, opts);\n      nRevNum = doc._revisions.start;\n      newRevId = doc._revisions.ids[0];\n    }\n    if (!doc._rev_tree) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      nRevNum = revInfo.prefix;\n      newRevId = revInfo.id;\n      doc._rev_tree = [{\n        pos: nRevNum,\n        ids: [newRevId, opts, []]\n      }];\n    }\n  }\n\n  invalidIdError(doc._id);\n\n  doc._rev = nRevNum + '-' + newRevId;\n\n  var result = {metadata : {}, data : {}};\n  for (var key in doc) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(doc, key)) {\n      var specialKey = key[0] === '_';\n      if (specialKey && !reservedWords[key]) {\n        var error = createError(DOC_VALIDATION, key);\n        error.message = DOC_VALIDATION.message + ': ' + key;\n        throw error;\n      } else if (specialKey && !dataWords[key]) {\n        result.metadata[key.slice(1)] = doc[key];\n      } else {\n        result.data[key] = doc[key];\n      }\n    }\n  }\n  return result;\n}\n\nfunction parseBase64(data) {\n  try {\n    return thisAtob(data);\n  } catch (e) {\n    var err = createError(BAD_ARG,\n      'Attachment is not a valid base64 string');\n    return {error: err};\n  }\n}\n\nfunction preprocessString(att, blobType, callback) {\n  var asBinary = parseBase64(att.data);\n  if (asBinary.error) {\n    return callback(asBinary.error);\n  }\n\n  att.length = asBinary.length;\n  if (blobType === 'blob') {\n    att.data = binStringToBluffer(asBinary, att.content_type);\n  } else if (blobType === 'base64') {\n    att.data = thisBtoa(asBinary);\n  } else { // binary\n    att.data = asBinary;\n  }\n  binaryMd5(asBinary, function (result) {\n    att.digest = 'md5-' + result;\n    callback();\n  });\n}\n\nfunction preprocessBlob(att, blobType, callback) {\n  binaryMd5(att.data, function (md5) {\n    att.digest = 'md5-' + md5;\n    // size is for blobs (browser), length is for buffers (node)\n    att.length = att.data.size || att.data.length || 0;\n    if (blobType === 'binary') {\n      blobToBinaryString(att.data, function (binString) {\n        att.data = binString;\n        callback();\n      });\n    } else if (blobType === 'base64') {\n      blobToBase64(att.data, function (b64) {\n        att.data = b64;\n        callback();\n      });\n    } else {\n      callback();\n    }\n  });\n}\n\nfunction preprocessAttachment(att, blobType, callback) {\n  if (att.stub) {\n    return callback();\n  }\n  if (typeof att.data === 'string') { // input is a base64 string\n    preprocessString(att, blobType, callback);\n  } else { // input is a blob\n    preprocessBlob(att, blobType, callback);\n  }\n}\n\nfunction preprocessAttachments(docInfos, blobType, callback) {\n\n  if (!docInfos.length) {\n    return callback();\n  }\n\n  var docv = 0;\n  var overallErr;\n\n  docInfos.forEach(function (docInfo) {\n    var attachments = docInfo.data && docInfo.data._attachments ?\n      Object.keys(docInfo.data._attachments) : [];\n    var recv = 0;\n\n    if (!attachments.length) {\n      return done();\n    }\n\n    function processedAttachment(err) {\n      overallErr = err;\n      recv++;\n      if (recv === attachments.length) {\n        done();\n      }\n    }\n\n    for (var key in docInfo.data._attachments) {\n      if (docInfo.data._attachments.hasOwnProperty(key)) {\n        preprocessAttachment(docInfo.data._attachments[key],\n          blobType, processedAttachment);\n      }\n    }\n  });\n\n  function done() {\n    docv++;\n    if (docInfos.length === docv) {\n      if (overallErr) {\n        callback(overallErr);\n      } else {\n        callback();\n      }\n    }\n  }\n}\n\nfunction updateDoc(revLimit, prev, docInfo, results,\n                   i, cb, writeDoc, newEdits) {\n\n  if (revExists(prev.rev_tree, docInfo.metadata.rev) && !newEdits) {\n    results[i] = docInfo;\n    return cb();\n  }\n\n  // sometimes this is pre-calculated. historically not always\n  var previousWinningRev = prev.winningRev || winningRev(prev);\n  var previouslyDeleted = 'deleted' in prev ? prev.deleted :\n    isDeleted(prev, previousWinningRev);\n  var deleted = 'deleted' in docInfo.metadata ? docInfo.metadata.deleted :\n    isDeleted(docInfo.metadata);\n  var isRoot = /^1-/.test(docInfo.metadata.rev);\n\n  if (previouslyDeleted && !deleted && newEdits && isRoot) {\n    var newDoc = docInfo.data;\n    newDoc._rev = previousWinningRev;\n    newDoc._id = docInfo.metadata.id;\n    docInfo = parseDoc(newDoc, newEdits);\n  }\n\n  var merged = merge(prev.rev_tree, docInfo.metadata.rev_tree[0], revLimit);\n\n  var inConflict = newEdits && ((\n    (previouslyDeleted && deleted && merged.conflicts !== 'new_leaf') ||\n    (!previouslyDeleted && merged.conflicts !== 'new_leaf') ||\n    (previouslyDeleted && !deleted && merged.conflicts === 'new_branch')));\n\n  if (inConflict) {\n    var err = createError(REV_CONFLICT);\n    results[i] = err;\n    return cb();\n  }\n\n  var newRev = docInfo.metadata.rev;\n  docInfo.metadata.rev_tree = merged.tree;\n  docInfo.stemmedRevs = merged.stemmedRevs || [];\n  /* istanbul ignore else */\n  if (prev.rev_map) {\n    docInfo.metadata.rev_map = prev.rev_map; // used only by leveldb\n  }\n\n  // recalculate\n  var winningRev$$1 = winningRev(docInfo.metadata);\n  var winningRevIsDeleted = isDeleted(docInfo.metadata, winningRev$$1);\n\n  // calculate the total number of documents that were added/removed,\n  // from the perspective of total_rows/doc_count\n  var delta = (previouslyDeleted === winningRevIsDeleted) ? 0 :\n    previouslyDeleted < winningRevIsDeleted ? -1 : 1;\n\n  var newRevIsDeleted;\n  if (newRev === winningRev$$1) {\n    // if the new rev is the same as the winning rev, we can reuse that value\n    newRevIsDeleted = winningRevIsDeleted;\n  } else {\n    // if they're not the same, then we need to recalculate\n    newRevIsDeleted = isDeleted(docInfo.metadata, newRev);\n  }\n\n  writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n    true, delta, i, cb);\n}\n\nfunction rootIsMissing(docInfo) {\n  return docInfo.metadata.rev_tree[0].ids[1].status === 'missing';\n}\n\nfunction processDocs(revLimit, docInfos, api, fetchedDocs, tx, results,\n                     writeDoc, opts, overallCallback) {\n\n  // Default to 1000 locally\n  revLimit = revLimit || 1000;\n\n  function insertDoc(docInfo, resultsIdx, callback) {\n    // Cant insert new deleted documents\n    var winningRev$$1 = winningRev(docInfo.metadata);\n    var deleted = isDeleted(docInfo.metadata, winningRev$$1);\n    if ('was_delete' in opts && deleted) {\n      results[resultsIdx] = createError(MISSING_DOC, 'deleted');\n      return callback();\n    }\n\n    // 4712 - detect whether a new document was inserted with a _rev\n    var inConflict = newEdits && rootIsMissing(docInfo);\n\n    if (inConflict) {\n      var err = createError(REV_CONFLICT);\n      results[resultsIdx] = err;\n      return callback();\n    }\n\n    var delta = deleted ? 0 : 1;\n\n    writeDoc(docInfo, winningRev$$1, deleted, deleted, false,\n      delta, resultsIdx, callback);\n  }\n\n  var newEdits = opts.new_edits;\n  var idsToDocs = new ExportedMap();\n\n  var docsDone = 0;\n  var docsToDo = docInfos.length;\n\n  function checkAllDocsDone() {\n    if (++docsDone === docsToDo && overallCallback) {\n      overallCallback();\n    }\n  }\n\n  docInfos.forEach(function (currentDoc, resultsIdx) {\n\n    if (currentDoc._id && isLocalId(currentDoc._id)) {\n      var fun = currentDoc._deleted ? '_removeLocal' : '_putLocal';\n      api[fun](currentDoc, {ctx: tx}, function (err, res) {\n        results[resultsIdx] = err || res;\n        checkAllDocsDone();\n      });\n      return;\n    }\n\n    var id = currentDoc.metadata.id;\n    if (idsToDocs.has(id)) {\n      docsToDo--; // duplicate\n      idsToDocs.get(id).push([currentDoc, resultsIdx]);\n    } else {\n      idsToDocs.set(id, [[currentDoc, resultsIdx]]);\n    }\n  });\n\n  // in the case of new_edits, the user can provide multiple docs\n  // with the same id. these need to be processed sequentially\n  idsToDocs.forEach(function (docs, id) {\n    var numDone = 0;\n\n    function docWritten() {\n      if (++numDone < docs.length) {\n        nextDoc();\n      } else {\n        checkAllDocsDone();\n      }\n    }\n    function nextDoc() {\n      var value = docs[numDone];\n      var currentDoc = value[0];\n      var resultsIdx = value[1];\n\n      if (fetchedDocs.has(id)) {\n        updateDoc(revLimit, fetchedDocs.get(id), currentDoc, results,\n          resultsIdx, docWritten, writeDoc, newEdits);\n      } else {\n        // Ensure stemming applies to new writes as well\n        var merged = merge([], currentDoc.metadata.rev_tree[0], revLimit);\n        currentDoc.metadata.rev_tree = merged.tree;\n        currentDoc.stemmedRevs = merged.stemmedRevs || [];\n        insertDoc(currentDoc, resultsIdx, docWritten);\n      }\n    }\n    nextDoc();\n  });\n}\n\n// IndexedDB requires a versioned database structure, so we use the\n// version here to manage migrations.\nvar ADAPTER_VERSION = 5;\n\n// The object stores created for each database\n// DOC_STORE stores the document meta data, its revision history and state\n// Keyed by document id\nvar DOC_STORE = 'document-store';\n// BY_SEQ_STORE stores a particular version of a document, keyed by its\n// sequence id\nvar BY_SEQ_STORE = 'by-sequence';\n// Where we store attachments\nvar ATTACH_STORE = 'attach-store';\n// Where we store many-to-many relations\n// between attachment digests and seqs\nvar ATTACH_AND_SEQ_STORE = 'attach-seq-store';\n\n// Where we store database-wide meta data in a single record\n// keyed by id: META_STORE\nvar META_STORE = 'meta-store';\n// Where we store local documents\nvar LOCAL_STORE = 'local-store';\n// Where we detect blob support\nvar DETECT_BLOB_SUPPORT_STORE = 'detect-blob-support';\n\nfunction safeJsonParse(str) {\n  // This try/catch guards against stack overflow errors.\n  // JSON.parse() is faster than vuvuzela.parse() but vuvuzela\n  // cannot overflow.\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.parse(str);\n  }\n}\n\nfunction safeJsonStringify(json) {\n  try {\n    return JSON.stringify(json);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.stringify(json);\n  }\n}\n\nfunction idbError(callback) {\n  return function (evt) {\n    var message = 'unknown_error';\n    if (evt.target && evt.target.error) {\n      message = evt.target.error.name || evt.target.error.message;\n    }\n    callback(createError(IDB_ERROR, message, evt.type));\n  };\n}\n\n// Unfortunately, the metadata has to be stringified\n// when it is put into the database, because otherwise\n// IndexedDB can throw errors for deeply-nested objects.\n// Originally we just used JSON.parse/JSON.stringify; now\n// we use this custom vuvuzela library that avoids recursion.\n// If we could do it all over again, we'd probably use a\n// format for the revision trees other than JSON.\nfunction encodeMetadata(metadata, winningRev, deleted) {\n  return {\n    data: safeJsonStringify(metadata),\n    winningRev: winningRev,\n    deletedOrLocal: deleted ? '1' : '0',\n    seq: metadata.seq, // highest seq for this doc\n    id: metadata.id\n  };\n}\n\nfunction decodeMetadata(storedObject) {\n  if (!storedObject) {\n    return null;\n  }\n  var metadata = safeJsonParse(storedObject.data);\n  metadata.winningRev = storedObject.winningRev;\n  metadata.deleted = storedObject.deletedOrLocal === '1';\n  metadata.seq = storedObject.seq;\n  return metadata;\n}\n\n// read the doc back out from the database. we don't store the\n// _id or _rev because we already have _doc_id_rev.\nfunction decodeDoc(doc) {\n  if (!doc) {\n    return doc;\n  }\n  var idx = doc._doc_id_rev.lastIndexOf(':');\n  doc._id = doc._doc_id_rev.substring(0, idx - 1);\n  doc._rev = doc._doc_id_rev.substring(idx + 1);\n  delete doc._doc_id_rev;\n  return doc;\n}\n\n// Read a blob from the database, encoding as necessary\n// and translating from base64 if the IDB doesn't support\n// native Blobs\nfunction readBlobData(body, type, asBlob, callback) {\n  if (asBlob) {\n    if (!body) {\n      callback(createBlob([''], {type: type}));\n    } else if (typeof body !== 'string') { // we have blob support\n      callback(body);\n    } else { // no blob support\n      callback(b64ToBluffer(body, type));\n    }\n  } else { // as base64 string\n    if (!body) {\n      callback('');\n    } else if (typeof body !== 'string') { // we have blob support\n      readAsBinaryString(body, function (binary) {\n        callback(thisBtoa(binary));\n      });\n    } else { // no blob support\n      callback(body);\n    }\n  }\n}\n\nfunction fetchAttachmentsIfNecessary(doc, opts, txn, cb) {\n  var attachments = Object.keys(doc._attachments || {});\n  if (!attachments.length) {\n    return cb && cb();\n  }\n  var numDone = 0;\n\n  function checkDone() {\n    if (++numDone === attachments.length && cb) {\n      cb();\n    }\n  }\n\n  function fetchAttachment(doc, att) {\n    var attObj = doc._attachments[att];\n    var digest = attObj.digest;\n    var req = txn.objectStore(ATTACH_STORE).get(digest);\n    req.onsuccess = function (e) {\n      attObj.body = e.target.result.body;\n      checkDone();\n    };\n  }\n\n  attachments.forEach(function (att) {\n    if (opts.attachments && opts.include_docs) {\n      fetchAttachment(doc, att);\n    } else {\n      doc._attachments[att].stub = true;\n      checkDone();\n    }\n  });\n}\n\n// IDB-specific postprocessing necessary because\n// we don't know whether we stored a true Blob or\n// a base64-encoded string, and if it's a Blob it\n// needs to be read outside of the transaction context\nfunction postProcessAttachments(results, asBlob) {\n  return Promise.all(results.map(function (row) {\n    if (row.doc && row.doc._attachments) {\n      var attNames = Object.keys(row.doc._attachments);\n      return Promise.all(attNames.map(function (att) {\n        var attObj = row.doc._attachments[att];\n        if (!('body' in attObj)) { // already processed\n          return;\n        }\n        var body = attObj.body;\n        var type = attObj.content_type;\n        return new Promise(function (resolve) {\n          readBlobData(body, type, asBlob, function (data) {\n            row.doc._attachments[att] = $inject_Object_assign(\n              pick(attObj, ['digest', 'content_type']),\n              {data: data}\n            );\n            resolve();\n          });\n        });\n      }));\n    }\n  }));\n}\n\nfunction compactRevs(revs, docId, txn) {\n\n  var possiblyOrphanedDigests = [];\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var attStore = txn.objectStore(ATTACH_STORE);\n  var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n  var count = revs.length;\n\n  function checkDone() {\n    count--;\n    if (!count) { // done processing all revs\n      deleteOrphanedAttachments();\n    }\n  }\n\n  function deleteOrphanedAttachments() {\n    if (!possiblyOrphanedDigests.length) {\n      return;\n    }\n    possiblyOrphanedDigests.forEach(function (digest) {\n      var countReq = attAndSeqStore.index('digestSeq').count(\n        IDBKeyRange.bound(\n          digest + '::', digest + '::\\uffff', false, false));\n      countReq.onsuccess = function (e) {\n        var count = e.target.result;\n        if (!count) {\n          // orphaned\n          attStore.delete(digest);\n        }\n      };\n    });\n  }\n\n  revs.forEach(function (rev$$1) {\n    var index = seqStore.index('_doc_id_rev');\n    var key = docId + \"::\" + rev$$1;\n    index.getKey(key).onsuccess = function (e) {\n      var seq = e.target.result;\n      if (typeof seq !== 'number') {\n        return checkDone();\n      }\n      seqStore.delete(seq);\n\n      var cursor = attAndSeqStore.index('seq')\n        .openCursor(IDBKeyRange.only(seq));\n\n      cursor.onsuccess = function (event) {\n        var cursor = event.target.result;\n        if (cursor) {\n          var digest = cursor.value.digestSeq.split('::')[0];\n          possiblyOrphanedDigests.push(digest);\n          attAndSeqStore.delete(cursor.primaryKey);\n          cursor.continue();\n        } else { // done\n          checkDone();\n        }\n      };\n    };\n  });\n}\n\nfunction openTransactionSafely(idb, stores, mode) {\n  try {\n    return {\n      txn: idb.transaction(stores, mode)\n    };\n  } catch (err) {\n    return {\n      error: err\n    };\n  }\n}\n\nvar changesHandler = new Changes();\n\nfunction idbBulkDocs(dbOpts, req, opts, api, idb, callback) {\n  var docInfos = req.docs;\n  var txn;\n  var docStore;\n  var bySeqStore;\n  var attachStore;\n  var attachAndSeqStore;\n  var metaStore;\n  var docInfoError;\n  var metaDoc;\n\n  for (var i = 0, len = docInfos.length; i < len; i++) {\n    var doc = docInfos[i];\n    if (doc._id && isLocalId(doc._id)) {\n      continue;\n    }\n    doc = docInfos[i] = parseDoc(doc, opts.new_edits, dbOpts);\n    if (doc.error && !docInfoError) {\n      docInfoError = doc;\n    }\n  }\n\n  if (docInfoError) {\n    return callback(docInfoError);\n  }\n\n  var allDocsProcessed = false;\n  var docCountDelta = 0;\n  var results = new Array(docInfos.length);\n  var fetchedDocs = new ExportedMap();\n  var preconditionErrored = false;\n  var blobType = api._meta.blobSupport ? 'blob' : 'base64';\n\n  preprocessAttachments(docInfos, blobType, function (err) {\n    if (err) {\n      return callback(err);\n    }\n    startTransaction();\n  });\n\n  function startTransaction() {\n\n    var stores = [\n      DOC_STORE, BY_SEQ_STORE,\n      ATTACH_STORE,\n      LOCAL_STORE, ATTACH_AND_SEQ_STORE,\n      META_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    txn = txnResult.txn;\n    txn.onabort = idbError(callback);\n    txn.ontimeout = idbError(callback);\n    txn.oncomplete = complete;\n    docStore = txn.objectStore(DOC_STORE);\n    bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    attachStore = txn.objectStore(ATTACH_STORE);\n    attachAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n    metaStore = txn.objectStore(META_STORE);\n\n    metaStore.get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result;\n      updateDocCountIfReady();\n    };\n\n    verifyAttachments(function (err) {\n      if (err) {\n        preconditionErrored = true;\n        return callback(err);\n      }\n      fetchExistingDocs();\n    });\n  }\n\n  function onAllDocsProcessed() {\n    allDocsProcessed = true;\n    updateDocCountIfReady();\n  }\n\n  function idbProcessDocs() {\n    processDocs(dbOpts.revs_limit, docInfos, api, fetchedDocs,\n                txn, results, writeDoc, opts, onAllDocsProcessed);\n  }\n\n  function updateDocCountIfReady() {\n    if (!metaDoc || !allDocsProcessed) {\n      return;\n    }\n    // caching the docCount saves a lot of time in allDocs() and\n    // info(), which is why we go to all the trouble of doing this\n    metaDoc.docCount += docCountDelta;\n    metaStore.put(metaDoc);\n  }\n\n  function fetchExistingDocs() {\n\n    if (!docInfos.length) {\n      return;\n    }\n\n    var numFetched = 0;\n\n    function checkDone() {\n      if (++numFetched === docInfos.length) {\n        idbProcessDocs();\n      }\n    }\n\n    function readMetadata(event) {\n      var metadata = decodeMetadata(event.target.result);\n\n      if (metadata) {\n        fetchedDocs.set(metadata.id, metadata);\n      }\n      checkDone();\n    }\n\n    for (var i = 0, len = docInfos.length; i < len; i++) {\n      var docInfo = docInfos[i];\n      if (docInfo._id && isLocalId(docInfo._id)) {\n        checkDone(); // skip local docs\n        continue;\n      }\n      var req = docStore.get(docInfo.metadata.id);\n      req.onsuccess = readMetadata;\n    }\n  }\n\n  function complete() {\n    if (preconditionErrored) {\n      return;\n    }\n\n    changesHandler.notify(api._meta.name);\n    callback(null, results);\n  }\n\n  function verifyAttachment(digest, callback) {\n\n    var req = attachStore.get(digest);\n    req.onsuccess = function (e) {\n      if (!e.target.result) {\n        var err = createError(MISSING_STUB,\n          'unknown stub attachment with digest ' +\n          digest);\n        err.status = 412;\n        callback(err);\n      } else {\n        callback();\n      }\n    };\n  }\n\n  function verifyAttachments(finish) {\n\n\n    var digests = [];\n    docInfos.forEach(function (docInfo) {\n      if (docInfo.data && docInfo.data._attachments) {\n        Object.keys(docInfo.data._attachments).forEach(function (filename) {\n          var att = docInfo.data._attachments[filename];\n          if (att.stub) {\n            digests.push(att.digest);\n          }\n        });\n      }\n    });\n    if (!digests.length) {\n      return finish();\n    }\n    var numDone = 0;\n    var err;\n\n    function checkDone() {\n      if (++numDone === digests.length) {\n        finish(err);\n      }\n    }\n    digests.forEach(function (digest) {\n      verifyAttachment(digest, function (attErr) {\n        if (attErr && !err) {\n          err = attErr;\n        }\n        checkDone();\n      });\n    });\n  }\n\n  function writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n                    isUpdate, delta, resultsIdx, callback) {\n\n    docInfo.metadata.winningRev = winningRev$$1;\n    docInfo.metadata.deleted = winningRevIsDeleted;\n\n    var doc = docInfo.data;\n    doc._id = docInfo.metadata.id;\n    doc._rev = docInfo.metadata.rev;\n\n    if (newRevIsDeleted) {\n      doc._deleted = true;\n    }\n\n    var hasAttachments = doc._attachments &&\n      Object.keys(doc._attachments).length;\n    if (hasAttachments) {\n      return writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n        isUpdate, resultsIdx, callback);\n    }\n\n    docCountDelta += delta;\n    updateDocCountIfReady();\n\n    finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n      isUpdate, resultsIdx, callback);\n  }\n\n  function finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n                     isUpdate, resultsIdx, callback) {\n\n    var doc = docInfo.data;\n    var metadata = docInfo.metadata;\n\n    doc._doc_id_rev = metadata.id + '::' + metadata.rev;\n    delete doc._id;\n    delete doc._rev;\n\n    function afterPutDoc(e) {\n      var revsToDelete = docInfo.stemmedRevs || [];\n\n      if (isUpdate && api.auto_compaction) {\n        revsToDelete = revsToDelete.concat(compactTree(docInfo.metadata));\n      }\n\n      if (revsToDelete && revsToDelete.length) {\n        compactRevs(revsToDelete, docInfo.metadata.id, txn);\n      }\n\n      metadata.seq = e.target.result;\n      // Current _rev is calculated from _rev_tree on read\n      // delete metadata.rev;\n      var metadataToStore = encodeMetadata(metadata, winningRev$$1,\n        winningRevIsDeleted);\n      var metaDataReq = docStore.put(metadataToStore);\n      metaDataReq.onsuccess = afterPutMetadata;\n    }\n\n    function afterPutDocError(e) {\n      // ConstraintError, need to update, not put (see #1638 for details)\n      e.preventDefault(); // avoid transaction abort\n      e.stopPropagation(); // avoid transaction onerror\n      var index = bySeqStore.index('_doc_id_rev');\n      var getKeyReq = index.getKey(doc._doc_id_rev);\n      getKeyReq.onsuccess = function (e) {\n        var putReq = bySeqStore.put(doc, e.target.result);\n        putReq.onsuccess = afterPutDoc;\n      };\n    }\n\n    function afterPutMetadata() {\n      results[resultsIdx] = {\n        ok: true,\n        id: metadata.id,\n        rev: metadata.rev\n      };\n      fetchedDocs.set(docInfo.metadata.id, docInfo.metadata);\n      insertAttachmentMappings(docInfo, metadata.seq, callback);\n    }\n\n    var putReq = bySeqStore.put(doc);\n\n    putReq.onsuccess = afterPutDoc;\n    putReq.onerror = afterPutDocError;\n  }\n\n  function writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n                            isUpdate, resultsIdx, callback) {\n\n\n    var doc = docInfo.data;\n\n    var numDone = 0;\n    var attachments = Object.keys(doc._attachments);\n\n    function collectResults() {\n      if (numDone === attachments.length) {\n        finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n          isUpdate, resultsIdx, callback);\n      }\n    }\n\n    function attachmentSaved() {\n      numDone++;\n      collectResults();\n    }\n\n    attachments.forEach(function (key) {\n      var att = docInfo.data._attachments[key];\n      if (!att.stub) {\n        var data = att.data;\n        delete att.data;\n        att.revpos = parseInt(winningRev$$1, 10);\n        var digest = att.digest;\n        saveAttachment(digest, data, attachmentSaved);\n      } else {\n        numDone++;\n        collectResults();\n      }\n    });\n  }\n\n  // map seqs to attachment digests, which\n  // we will need later during compaction\n  function insertAttachmentMappings(docInfo, seq, callback) {\n\n    var attsAdded = 0;\n    var attsToAdd = Object.keys(docInfo.data._attachments || {});\n\n    if (!attsToAdd.length) {\n      return callback();\n    }\n\n    function checkDone() {\n      if (++attsAdded === attsToAdd.length) {\n        callback();\n      }\n    }\n\n    function add(att) {\n      var digest = docInfo.data._attachments[att].digest;\n      var req = attachAndSeqStore.put({\n        seq: seq,\n        digestSeq: digest + '::' + seq\n      });\n\n      req.onsuccess = checkDone;\n      req.onerror = function (e) {\n        // this callback is for a constaint error, which we ignore\n        // because this docid/rev has already been associated with\n        // the digest (e.g. when new_edits == false)\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n        checkDone();\n      };\n    }\n    for (var i = 0; i < attsToAdd.length; i++) {\n      add(attsToAdd[i]); // do in parallel\n    }\n  }\n\n  function saveAttachment(digest, data, callback) {\n\n\n    var getKeyReq = attachStore.count(digest);\n    getKeyReq.onsuccess = function (e) {\n      var count = e.target.result;\n      if (count) {\n        return callback(); // already exists\n      }\n      var newAtt = {\n        digest: digest,\n        body: data\n      };\n      var putReq = attachStore.put(newAtt);\n      putReq.onsuccess = callback;\n    };\n  }\n}\n\n// Abstraction over IDBCursor and getAll()/getAllKeys() that allows us to batch our operations\n// while falling back to a normal IDBCursor operation on browsers that don't support getAll() or\n// getAllKeys(). This allows for a much faster implementation than just straight-up cursors, because\n// we're not processing each document one-at-a-time.\nfunction runBatchedCursor(objectStore, keyRange, descending, batchSize, onBatch) {\n\n  if (batchSize === -1) {\n    batchSize = 1000;\n  }\n\n  // Bail out of getAll()/getAllKeys() in the following cases:\n  // 1) either method is unsupported - we need both\n  // 2) batchSize is 1 (might as well use IDBCursor)\n  // 3) descending  no real way to do this via getAll()/getAllKeys()\n\n  var useGetAll = typeof objectStore.getAll === 'function' &&\n    typeof objectStore.getAllKeys === 'function' &&\n    batchSize > 1 && !descending;\n\n  var keysBatch;\n  var valuesBatch;\n  var pseudoCursor;\n\n  function onGetAll(e) {\n    valuesBatch = e.target.result;\n    if (keysBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function onGetAllKeys(e) {\n    keysBatch = e.target.result;\n    if (valuesBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function continuePseudoCursor() {\n    if (!keysBatch.length) { // no more results\n      return onBatch();\n    }\n    // fetch next batch, exclusive start\n    var lastKey = keysBatch[keysBatch.length - 1];\n    var newKeyRange;\n    if (keyRange && keyRange.upper) {\n      try {\n        newKeyRange = IDBKeyRange.bound(lastKey, keyRange.upper,\n          true, keyRange.upperOpen);\n      } catch (e) {\n        if (e.name === \"DataError\" && e.code === 0) {\n          return onBatch(); // we're done, startkey and endkey are equal\n        }\n      }\n    } else {\n      newKeyRange = IDBKeyRange.lowerBound(lastKey, true);\n    }\n    keyRange = newKeyRange;\n    keysBatch = null;\n    valuesBatch = null;\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  }\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (!cursor) { // done\n      return onBatch();\n    }\n    // regular IDBCursor acts like a batch where batch size is always 1\n    onBatch([cursor.key], [cursor.value], cursor);\n  }\n\n  if (useGetAll) {\n    pseudoCursor = {\"continue\": continuePseudoCursor};\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  } else if (descending) {\n    objectStore.openCursor(keyRange, 'prev').onsuccess = onCursor;\n  } else {\n    objectStore.openCursor(keyRange).onsuccess = onCursor;\n  }\n}\n\n// simple shim for objectStore.getAll(), falling back to IDBCursor\nfunction getAll(objectStore, keyRange, onSuccess) {\n  if (typeof objectStore.getAll === 'function') {\n    // use native getAll\n    objectStore.getAll(keyRange).onsuccess = onSuccess;\n    return;\n  }\n  // fall back to cursors\n  var values = [];\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (cursor) {\n      values.push(cursor.value);\n      cursor.continue();\n    } else {\n      onSuccess({\n        target: {\n          result: values\n        }\n      });\n    }\n  }\n\n  objectStore.openCursor(keyRange).onsuccess = onCursor;\n}\n\nfunction allDocsKeys(keys, docStore, onBatch) {\n  // It's not guaranted to be returned in right order  \n  var valuesBatch = new Array(keys.length);\n  var count = 0;\n  keys.forEach(function (key, index) {\n    docStore.get(key).onsuccess = function (event) {\n      if (event.target.result) {\n        valuesBatch[index] = event.target.result;\n      } else {\n        valuesBatch[index] = {key: key, error: 'not_found'};\n      }\n      count++;\n      if (count === keys.length) {\n        onBatch(keys, valuesBatch, {});\n      }\n    };\n  });\n}\n\nfunction createKeyRange(start, end, inclusiveEnd, key, descending) {\n  try {\n    if (start && end) {\n      if (descending) {\n        return IDBKeyRange.bound(end, start, !inclusiveEnd, false);\n      } else {\n        return IDBKeyRange.bound(start, end, false, !inclusiveEnd);\n      }\n    } else if (start) {\n      if (descending) {\n        return IDBKeyRange.upperBound(start);\n      } else {\n        return IDBKeyRange.lowerBound(start);\n      }\n    } else if (end) {\n      if (descending) {\n        return IDBKeyRange.lowerBound(end, !inclusiveEnd);\n      } else {\n        return IDBKeyRange.upperBound(end, !inclusiveEnd);\n      }\n    } else if (key) {\n      return IDBKeyRange.only(key);\n    }\n  } catch (e) {\n    return {error: e};\n  }\n  return null;\n}\n\nfunction idbAllDocs(opts, idb, callback) {\n  var start = 'startkey' in opts ? opts.startkey : false;\n  var end = 'endkey' in opts ? opts.endkey : false;\n  var key = 'key' in opts ? opts.key : false;\n  var keys = 'keys' in opts ? opts.keys : false; \n  var skip = opts.skip || 0;\n  var limit = typeof opts.limit === 'number' ? opts.limit : -1;\n  var inclusiveEnd = opts.inclusive_end !== false;\n\n  var keyRange ; \n  var keyRangeError;\n  if (!keys) {\n    keyRange = createKeyRange(start, end, inclusiveEnd, key, opts.descending);\n    keyRangeError = keyRange && keyRange.error;\n    if (keyRangeError && \n      !(keyRangeError.name === \"DataError\" && keyRangeError.code === 0)) {\n      // DataError with error code 0 indicates start is less than end, so\n      // can just do an empty query. Else need to throw\n      return callback(createError(IDB_ERROR,\n        keyRangeError.name, keyRangeError.message));\n    }\n  }\n\n  var stores = [DOC_STORE, BY_SEQ_STORE, META_STORE];\n\n  if (opts.attachments) {\n    stores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, stores, 'readonly');\n  if (txnResult.error) {\n    return callback(txnResult.error);\n  }\n  var txn = txnResult.txn;\n  txn.oncomplete = onTxnComplete;\n  txn.onabort = idbError(callback);\n  var docStore = txn.objectStore(DOC_STORE);\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var metaStore = txn.objectStore(META_STORE);\n  var docIdRevIndex = seqStore.index('_doc_id_rev');\n  var results = [];\n  var docCount;\n  var updateSeq;\n\n  metaStore.get(META_STORE).onsuccess = function (e) {\n    docCount = e.target.result.docCount;\n  };\n\n  /* istanbul ignore if */\n  if (opts.update_seq) {\n    getMaxUpdateSeq(seqStore, function (e) { \n      if (e.target.result && e.target.result.length > 0) {\n        updateSeq = e.target.result[0];\n      }\n    });\n  }\n\n  function getMaxUpdateSeq(objectStore, onSuccess) {\n    function onCursor(e) {\n      var cursor = e.target.result;\n      var maxKey = undefined;\n      if (cursor && cursor.key) {\n        maxKey = cursor.key;\n      } \n      return onSuccess({\n        target: {\n          result: [maxKey]\n        }\n      });\n    }\n    objectStore.openCursor(null, 'prev').onsuccess = onCursor;\n  }\n\n  // if the user specifies include_docs=true, then we don't\n  // want to block the main cursor while we're fetching the doc\n  function fetchDocAsynchronously(metadata, row, winningRev$$1) {\n    var key = metadata.id + \"::\" + winningRev$$1;\n    docIdRevIndex.get(key).onsuccess =  function onGetDoc(e) {\n      row.doc = decodeDoc(e.target.result) || {};\n      if (opts.conflicts) {\n        var conflicts = collectConflicts(metadata);\n        if (conflicts.length) {\n          row.doc._conflicts = conflicts;\n        }\n      }\n      fetchAttachmentsIfNecessary(row.doc, opts, txn);\n    };\n  }\n\n  function allDocsInner(winningRev$$1, metadata) {\n    var row = {\n      id: metadata.id,\n      key: metadata.id,\n      value: {\n        rev: winningRev$$1\n      }\n    };\n    var deleted = metadata.deleted;\n    if (deleted) {\n      if (keys) {\n        results.push(row);\n        // deleted docs are okay with \"keys\" requests\n        row.value.deleted = true;\n        row.doc = null;\n      }\n    } else if (skip-- <= 0) {\n      results.push(row);\n      if (opts.include_docs) {\n        fetchDocAsynchronously(metadata, row, winningRev$$1);\n      }\n    }\n  }\n\n  function processBatch(batchValues) {\n    for (var i = 0, len = batchValues.length; i < len; i++) {\n      if (results.length === limit) {\n        break;\n      }\n      var batchValue = batchValues[i];\n      if (batchValue.error && keys) {\n        // key was not found with \"keys\" requests\n        results.push(batchValue);\n        continue;\n      }\n      var metadata = decodeMetadata(batchValue);\n      var winningRev$$1 = metadata.winningRev;\n      allDocsInner(winningRev$$1, metadata);\n    }\n  }\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor) {\n      return;\n    }\n    processBatch(batchValues);\n    if (results.length < limit) {\n      cursor.continue();\n    }\n  }\n\n  function onGetAll(e) {\n    var values = e.target.result;\n    if (opts.descending) {\n      values = values.reverse();\n    }\n    processBatch(values);\n  }\n\n  function onResultsReady() {\n    var returnVal = {\n      total_rows: docCount,\n      offset: opts.skip,\n      rows: results\n    };\n    \n    /* istanbul ignore if */\n    if (opts.update_seq && updateSeq !== undefined) {\n      returnVal.update_seq = updateSeq;\n    }\n    callback(null, returnVal);\n  }\n\n  function onTxnComplete() {\n    if (opts.attachments) {\n      postProcessAttachments(results, opts.binary).then(onResultsReady);\n    } else {\n      onResultsReady();\n    }\n  }\n\n  // don't bother doing any requests if start > end or limit === 0\n  if (keyRangeError || limit === 0) {\n    return;\n  }\n  if (keys) {\n    return allDocsKeys(opts.keys, docStore, onBatch);\n  }\n  if (limit === -1) { // just fetch everything\n    return getAll(docStore, keyRange, onGetAll);\n  }\n  // else do a cursor\n  // choose a batch size based on the skip, since we'll need to skip that many\n  runBatchedCursor(docStore, keyRange, opts.descending, limit + skip, onBatch);\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\nfunction checkBlobSupport(txn) {\n  return new Promise(function (resolve) {\n    var blob$$1 = createBlob(['']);\n    var req = txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob$$1, 'key');\n\n    req.onsuccess = function () {\n      var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n      var matchedEdge = navigator.userAgent.match(/Edge\\//);\n      // MS Edge pretends to be Chrome 42:\n      // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n      resolve(matchedEdge || !matchedChrome ||\n        parseInt(matchedChrome[1], 10) >= 43);\n    };\n\n    req.onerror = txn.onabort = function (e) {\n      // If the transaction aborts now its due to not being able to\n      // write to the database, likely due to the disk being full\n      e.preventDefault();\n      e.stopPropagation();\n      resolve(false);\n    };\n  }).catch(function () {\n    return false; // error, so assume unsupported\n  });\n}\n\nfunction countDocs(txn, cb) {\n  var index = txn.objectStore(DOC_STORE).index('deletedOrLocal');\n  index.count(IDBKeyRange.only('0')).onsuccess = function (e) {\n    cb(e.target.result);\n  };\n}\n\n// This task queue ensures that IDB open calls are done in their own tick\n\nvar running = false;\nvar queue = [];\n\nfunction tryCode(fun, err, res, PouchDB) {\n  try {\n    fun(err, res);\n  } catch (err) {\n    // Shouldn't happen, but in some odd cases\n    // IndexedDB implementations might throw a sync\n    // error, in which case this will at least log it.\n    PouchDB.emit('error', err);\n  }\n}\n\nfunction applyNext() {\n  if (running || !queue.length) {\n    return;\n  }\n  running = true;\n  queue.shift()();\n}\n\nfunction enqueueTask(action, callback, PouchDB) {\n  queue.push(function runAction() {\n    action(function runCallback(err, res) {\n      tryCode(callback, err, res, PouchDB);\n      running = false;\n      immediate(function runNext() {\n        applyNext(PouchDB);\n      });\n    });\n  });\n  applyNext();\n}\n\nfunction changes(opts, api, dbName, idb) {\n  opts = clone(opts);\n\n  if (opts.continuous) {\n    var id = dbName + ':' + uuid();\n    changesHandler.addListener(dbName, id, api, opts);\n    changesHandler.notify(dbName);\n    return {\n      cancel: function () {\n        changesHandler.removeListener(dbName, id);\n      }\n    };\n  }\n\n  var docIds = opts.doc_ids && new ExportedSet(opts.doc_ids);\n\n  opts.since = opts.since || 0;\n  var lastSeq = opts.since;\n\n  var limit = 'limit' in opts ? opts.limit : -1;\n  if (limit === 0) {\n    limit = 1; // per CouchDB _changes spec\n  }\n\n  var results = [];\n  var numResults = 0;\n  var filter = filterChange(opts);\n  var docIdsToMetadata = new ExportedMap();\n\n  var txn;\n  var bySeqStore;\n  var docStore;\n  var docIdRevIndex;\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor || !batchKeys.length) { // done\n      return;\n    }\n\n    var winningDocs = new Array(batchKeys.length);\n    var metadatas = new Array(batchKeys.length);\n\n    function processMetadataAndWinningDoc(metadata, winningDoc) {\n      var change = opts.processChange(winningDoc, metadata, opts);\n      lastSeq = change.seq = metadata.seq;\n\n      var filtered = filter(change);\n      if (typeof filtered === 'object') { // anything but true/false indicates error\n        return Promise.reject(filtered);\n      }\n\n      if (!filtered) {\n        return Promise.resolve();\n      }\n      numResults++;\n      if (opts.return_docs) {\n        results.push(change);\n      }\n      // process the attachment immediately\n      // for the benefit of live listeners\n      if (opts.attachments && opts.include_docs) {\n        return new Promise(function (resolve) {\n          fetchAttachmentsIfNecessary(winningDoc, opts, txn, function () {\n            postProcessAttachments([change], opts.binary).then(function () {\n              resolve(change);\n            });\n          });\n        });\n      } else {\n        return Promise.resolve(change);\n      }\n    }\n\n    function onBatchDone() {\n      var promises = [];\n      for (var i = 0, len = winningDocs.length; i < len; i++) {\n        if (numResults === limit) {\n          break;\n        }\n        var winningDoc = winningDocs[i];\n        if (!winningDoc) {\n          continue;\n        }\n        var metadata = metadatas[i];\n        promises.push(processMetadataAndWinningDoc(metadata, winningDoc));\n      }\n\n      Promise.all(promises).then(function (changes) {\n        for (var i = 0, len = changes.length; i < len; i++) {\n          if (changes[i]) {\n            opts.onChange(changes[i]);\n          }\n        }\n      }).catch(opts.complete);\n\n      if (numResults !== limit) {\n        cursor.continue();\n      }\n    }\n\n    // Fetch all metadatas/winningdocs from this batch in parallel, then process\n    // them all only once all data has been collected. This is done in parallel\n    // because it's faster than doing it one-at-a-time.\n    var numDone = 0;\n    batchValues.forEach(function (value, i) {\n      var doc = decodeDoc(value);\n      var seq = batchKeys[i];\n      fetchWinningDocAndMetadata(doc, seq, function (metadata, winningDoc) {\n        metadatas[i] = metadata;\n        winningDocs[i] = winningDoc;\n        if (++numDone === batchKeys.length) {\n          onBatchDone();\n        }\n      });\n    });\n  }\n\n  function onGetMetadata(doc, seq, metadata, cb) {\n    if (metadata.seq !== seq) {\n      // some other seq is later\n      return cb();\n    }\n\n    if (metadata.winningRev === doc._rev) {\n      // this is the winning doc\n      return cb(metadata, doc);\n    }\n\n    // fetch winning doc in separate request\n    var docIdRev = doc._id + '::' + metadata.winningRev;\n    var req = docIdRevIndex.get(docIdRev);\n    req.onsuccess = function (e) {\n      cb(metadata, decodeDoc(e.target.result));\n    };\n  }\n\n  function fetchWinningDocAndMetadata(doc, seq, cb) {\n    if (docIds && !docIds.has(doc._id)) {\n      return cb();\n    }\n\n    var metadata = docIdsToMetadata.get(doc._id);\n    if (metadata) { // cached\n      return onGetMetadata(doc, seq, metadata, cb);\n    }\n    // metadata not cached, have to go fetch it\n    docStore.get(doc._id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      docIdsToMetadata.set(doc._id, metadata);\n      onGetMetadata(doc, seq, metadata, cb);\n    };\n  }\n\n  function finish() {\n    opts.complete(null, {\n      results: results,\n      last_seq: lastSeq\n    });\n  }\n\n  function onTxnComplete() {\n    if (!opts.continuous && opts.attachments) {\n      // cannot guarantee that postProcessing was already done,\n      // so do it again\n      postProcessAttachments(results).then(finish);\n    } else {\n      finish();\n    }\n  }\n\n  var objectStores = [DOC_STORE, BY_SEQ_STORE];\n  if (opts.attachments) {\n    objectStores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, objectStores, 'readonly');\n  if (txnResult.error) {\n    return opts.complete(txnResult.error);\n  }\n  txn = txnResult.txn;\n  txn.onabort = idbError(opts.complete);\n  txn.oncomplete = onTxnComplete;\n\n  bySeqStore = txn.objectStore(BY_SEQ_STORE);\n  docStore = txn.objectStore(DOC_STORE);\n  docIdRevIndex = bySeqStore.index('_doc_id_rev');\n\n  var keyRange = (opts.since && !opts.descending) ?\n    IDBKeyRange.lowerBound(opts.since, true) : null;\n\n  runBatchedCursor(bySeqStore, keyRange, opts.descending, limit, onBatch);\n}\n\nvar cachedDBs = new ExportedMap();\nvar blobSupportPromise;\nvar openReqList = new ExportedMap();\n\nfunction IdbPouch(opts, callback) {\n  var api = this;\n\n  enqueueTask(function (thisCallback) {\n    init(api, opts, thisCallback);\n  }, callback, api.constructor);\n}\n\nfunction init(api, opts, callback) {\n\n  var dbName = opts.name;\n\n  var idb = null;\n  api._meta = null;\n\n  // called when creating a fresh new database\n  function createSchema(db) {\n    var docStore = db.createObjectStore(DOC_STORE, {keyPath : 'id'});\n    db.createObjectStore(BY_SEQ_STORE, {autoIncrement: true})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n    db.createObjectStore(ATTACH_STORE, {keyPath: 'digest'});\n    db.createObjectStore(META_STORE, {keyPath: 'id', autoIncrement: false});\n    db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n\n    // added in v2\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    // added in v3\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'});\n\n    // added in v4\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 2\n  // unfortunately \"deletedOrLocal\" is a misnomer now that we no longer\n  // store local docs in the main doc-store, but whaddyagonnado\n  function addDeletedOrLocalIndex(txn, callback) {\n    var docStore = txn.objectStore(DOC_STORE);\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    docStore.openCursor().onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var deleted = isDeleted(metadata);\n        metadata.deletedOrLocal = deleted ? \"1\" : \"0\";\n        docStore.put(metadata);\n        cursor.continue();\n      } else {\n        callback();\n      }\n    };\n  }\n\n  // migration to version 3 (part 1)\n  function createLocalStoreSchema(db) {\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n  }\n\n  // migration to version 3 (part 2)\n  function migrateLocalStore(txn, cb) {\n    var localStore = txn.objectStore(LOCAL_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var docId = metadata.id;\n        var local = isLocalId(docId);\n        var rev$$1 = winningRev(metadata);\n        if (local) {\n          var docIdRev = docId + \"::\" + rev$$1;\n          // remove all seq entries\n          // associated with this docId\n          var start = docId + \"::\";\n          var end = docId + \"::~\";\n          var index = seqStore.index('_doc_id_rev');\n          var range = IDBKeyRange.bound(start, end, false, false);\n          var seqCursor = index.openCursor(range);\n          seqCursor.onsuccess = function (e) {\n            seqCursor = e.target.result;\n            if (!seqCursor) {\n              // done\n              docStore.delete(cursor.primaryKey);\n              cursor.continue();\n            } else {\n              var data = seqCursor.value;\n              if (data._doc_id_rev === docIdRev) {\n                localStore.put(data);\n              }\n              seqStore.delete(seqCursor.primaryKey);\n              seqCursor.continue();\n            }\n          };\n        } else {\n          cursor.continue();\n        }\n      } else if (cb) {\n        cb();\n      }\n    };\n  }\n\n  // migration to version 4 (part 1)\n  function addAttachAndSeqStore(db) {\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 4 (part 2)\n  function migrateAttsAndSeqs(txn, callback) {\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n    var attStore = txn.objectStore(ATTACH_STORE);\n    var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n\n    // need to actually populate the table. this is the expensive part,\n    // so as an optimization, check first that this database even\n    // contains attachments\n    var req = attStore.count();\n    req.onsuccess = function (e) {\n      var count = e.target.result;\n      if (!count) {\n        return callback(); // done\n      }\n\n      seqStore.openCursor().onsuccess = function (e) {\n        var cursor = e.target.result;\n        if (!cursor) {\n          return callback(); // done\n        }\n        var doc = cursor.value;\n        var seq = cursor.primaryKey;\n        var atts = Object.keys(doc._attachments || {});\n        var digestMap = {};\n        for (var j = 0; j < atts.length; j++) {\n          var att = doc._attachments[atts[j]];\n          digestMap[att.digest] = true; // uniq digests, just in case\n        }\n        var digests = Object.keys(digestMap);\n        for (j = 0; j < digests.length; j++) {\n          var digest = digests[j];\n          attAndSeqStore.put({\n            seq: seq,\n            digestSeq: digest + '::' + seq\n          });\n        }\n        cursor.continue();\n      };\n    };\n  }\n\n  // migration to version 5\n  // Instead of relying on on-the-fly migration of metadata,\n  // this brings the doc-store to its modern form:\n  // - metadata.winningrev\n  // - metadata.seq\n  // - stringify the metadata when storing it\n  function migrateMetadata(txn) {\n\n    function decodeMetadataCompat(storedObject) {\n      if (!storedObject.data) {\n        // old format, when we didn't store it stringified\n        storedObject.deleted = storedObject.deletedOrLocal === '1';\n        return storedObject;\n      }\n      return decodeMetadata(storedObject);\n    }\n\n    // ensure that every metadata has a winningRev and seq,\n    // which was previously created on-the-fly but better to migrate\n    var bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (e) {\n      var cursor = e.target.result;\n      if (!cursor) {\n        return; // done\n      }\n      var metadata = decodeMetadataCompat(cursor.value);\n\n      metadata.winningRev = metadata.winningRev ||\n        winningRev(metadata);\n\n      function fetchMetadataSeq() {\n        // metadata.seq was added post-3.2.0, so if it's missing,\n        // we need to fetch it manually\n        var start = metadata.id + '::';\n        var end = metadata.id + '::\\uffff';\n        var req = bySeqStore.index('_doc_id_rev').openCursor(\n          IDBKeyRange.bound(start, end));\n\n        var metadataSeq = 0;\n        req.onsuccess = function (e) {\n          var cursor = e.target.result;\n          if (!cursor) {\n            metadata.seq = metadataSeq;\n            return onGetMetadataSeq();\n          }\n          var seq = cursor.primaryKey;\n          if (seq > metadataSeq) {\n            metadataSeq = seq;\n          }\n          cursor.continue();\n        };\n      }\n\n      function onGetMetadataSeq() {\n        var metadataToStore = encodeMetadata(metadata,\n          metadata.winningRev, metadata.deleted);\n\n        var req = docStore.put(metadataToStore);\n        req.onsuccess = function () {\n          cursor.continue();\n        };\n      }\n\n      if (metadata.seq) {\n        return onGetMetadataSeq();\n      }\n\n      fetchMetadataSeq();\n    };\n\n  }\n\n  api._remote = false;\n  api.type = function () {\n    return 'idb';\n  };\n\n  api._id = toPromise(function (callback) {\n    callback(null, api._meta.instanceId);\n  });\n\n  api._bulkDocs = function idb_bulkDocs(req, reqOpts, callback) {\n    idbBulkDocs(opts, req, reqOpts, api, idb, callback);\n  };\n\n  // First we look up the metadata in the ids database, then we fetch the\n  // current revision(s) from the by sequence store\n  api._get = function idb_get(id, opts, callback) {\n    var doc;\n    var metadata;\n    var err;\n    var txn = opts.ctx;\n    if (!txn) {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n\n    function finish() {\n      callback(err, {doc: doc, metadata: metadata, ctx: txn});\n    }\n\n    txn.objectStore(DOC_STORE).get(id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      // we can determine the result here if:\n      // 1. there is no such document\n      // 2. the document is deleted and we don't ask about specific rev\n      // When we ask with opts.rev we expect the answer to be either\n      // doc (possibly with _deleted=true) or missing error\n      if (!metadata) {\n        err = createError(MISSING_DOC, 'missing');\n        return finish();\n      }\n\n      var rev$$1;\n      if (!opts.rev) {\n        rev$$1 = metadata.winningRev;\n        var deleted = isDeleted(metadata);\n        if (deleted) {\n          err = createError(MISSING_DOC, \"deleted\");\n          return finish();\n        }\n      } else {\n        rev$$1 = opts.latest ? latest(opts.rev, metadata) : opts.rev;\n      }\n\n      var objectStore = txn.objectStore(BY_SEQ_STORE);\n      var key = metadata.id + '::' + rev$$1;\n\n      objectStore.index('_doc_id_rev').get(key).onsuccess = function (e) {\n        doc = e.target.result;\n        if (doc) {\n          doc = decodeDoc(doc);\n        }\n        if (!doc) {\n          err = createError(MISSING_DOC, 'missing');\n          return finish();\n        }\n        finish();\n      };\n    };\n  };\n\n  api._getAttachment = function (docId, attachId, attachment, opts, callback) {\n    var txn;\n    if (opts.ctx) {\n      txn = opts.ctx;\n    } else {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n    var digest = attachment.digest;\n    var type = attachment.content_type;\n\n    txn.objectStore(ATTACH_STORE).get(digest).onsuccess = function (e) {\n      var body = e.target.result.body;\n      readBlobData(body, type, opts.binary, function (blobData) {\n        callback(null, blobData);\n      });\n    };\n  };\n\n  api._info = function idb_info(callback) {\n    var updateSeq;\n    var docCount;\n\n    var txnResult = openTransactionSafely(idb, [META_STORE, BY_SEQ_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      docCount = e.target.result.docCount;\n    };\n    txn.objectStore(BY_SEQ_STORE).openCursor(null, 'prev').onsuccess = function (e) {\n      var cursor = e.target.result;\n      updateSeq = cursor ? cursor.key : 0;\n    };\n\n    txn.oncomplete = function () {\n      callback(null, {\n        doc_count: docCount,\n        update_seq: updateSeq,\n        // for debugging\n        idb_attachment_format: (api._meta.blobSupport ? 'binary' : 'base64')\n      });\n    };\n  };\n\n  api._allDocs = function idb_allDocs(opts, callback) {\n    idbAllDocs(opts, idb, callback);\n  };\n\n  api._changes = function idbChanges(opts) {\n    return changes(opts, api, dbName, idb);\n  };\n\n  api._close = function (callback) {\n    // https://developer.mozilla.org/en-US/docs/IndexedDB/IDBDatabase#close\n    // \"Returns immediately and closes the connection in a separate thread...\"\n    idb.close();\n    cachedDBs.delete(dbName);\n    callback();\n  };\n\n  api._getRevisionTree = function (docId, callback) {\n    var txnResult = openTransactionSafely(idb, [DOC_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    var req = txn.objectStore(DOC_STORE).get(docId);\n    req.onsuccess = function (event) {\n      var doc = decodeMetadata(event.target.result);\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        callback(null, doc.rev_tree);\n      }\n    };\n  };\n\n  // This function removes revisions of document docId\n  // which are listed in revs and sets this document\n  // revision to to rev_tree\n  api._doCompaction = function (docId, revs, callback) {\n    var stores = [\n      DOC_STORE,\n      BY_SEQ_STORE,\n      ATTACH_STORE,\n      ATTACH_AND_SEQ_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n\n    var docStore = txn.objectStore(DOC_STORE);\n\n    docStore.get(docId).onsuccess = function (event) {\n      var metadata = decodeMetadata(event.target.result);\n      traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                                         revHash, ctx, opts) {\n        var rev$$1 = pos + '-' + revHash;\n        if (revs.indexOf(rev$$1) !== -1) {\n          opts.status = 'missing';\n        }\n      });\n      compactRevs(revs, docId, txn);\n      var winningRev$$1 = metadata.winningRev;\n      var deleted = metadata.deleted;\n      txn.objectStore(DOC_STORE).put(\n        encodeMetadata(metadata, winningRev$$1, deleted));\n    };\n    txn.onabort = idbError(callback);\n    txn.oncomplete = function () {\n      callback();\n    };\n  };\n\n\n  api._getLocal = function (id, callback) {\n    var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var tx = txnResult.txn;\n    var req = tx.objectStore(LOCAL_STORE).get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var doc = e.target.result;\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        delete doc['_doc_id_rev']; // for backwards compat\n        callback(null, doc);\n      }\n    };\n  };\n\n  api._putLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    delete doc._revisions; // ignore this, trust the rev\n    var oldRev = doc._rev;\n    var id = doc._id;\n    if (!oldRev) {\n      doc._rev = '0-1';\n    } else {\n      doc._rev = '0-' + (parseInt(oldRev.split('-')[1], 10) + 1);\n    }\n\n    var tx = opts.ctx;\n    var ret;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.onerror = idbError(callback);\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req;\n    if (oldRev) {\n      req = oStore.get(id);\n      req.onsuccess = function (e) {\n        var oldDoc = e.target.result;\n        if (!oldDoc || oldDoc._rev !== oldRev) {\n          callback(createError(REV_CONFLICT));\n        } else { // update\n          var req = oStore.put(doc);\n          req.onsuccess = function () {\n            ret = {ok: true, id: doc._id, rev: doc._rev};\n            if (opts.ctx) { // return immediately\n              callback(null, ret);\n            }\n          };\n        }\n      };\n    } else { // new doc\n      req = oStore.add(doc);\n      req.onerror = function (e) {\n        // constraint error, already exists\n        callback(createError(REV_CONFLICT));\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n      };\n      req.onsuccess = function () {\n        ret = {ok: true, id: doc._id, rev: doc._rev};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      };\n    }\n  };\n\n  api._removeLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var tx = opts.ctx;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n    var ret;\n    var id = doc._id;\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req = oStore.get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var oldDoc = e.target.result;\n      if (!oldDoc || oldDoc._rev !== doc._rev) {\n        callback(createError(MISSING_DOC));\n      } else {\n        oStore.delete(id);\n        ret = {ok: true, id: id, rev: '0-0'};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      }\n    };\n  };\n\n  api._destroy = function (opts, callback) {\n    changesHandler.removeAllListeners(dbName);\n\n    //Close open request for \"dbName\" database to fix ie delay.\n    var openReq = openReqList.get(dbName);\n    if (openReq && openReq.result) {\n      openReq.result.close();\n      cachedDBs.delete(dbName);\n    }\n    var req = indexedDB.deleteDatabase(dbName);\n\n    req.onsuccess = function () {\n      //Remove open request from the list.\n      openReqList.delete(dbName);\n      if (hasLocalStorage() && (dbName in localStorage)) {\n        delete localStorage[dbName];\n      }\n      callback(null, { 'ok': true });\n    };\n\n    req.onerror = idbError(callback);\n  };\n\n  var cached = cachedDBs.get(dbName);\n\n  if (cached) {\n    idb = cached.idb;\n    api._meta = cached.global;\n    return immediate(function () {\n      callback(null, api);\n    });\n  }\n\n  var req = indexedDB.open(dbName, ADAPTER_VERSION);\n  openReqList.set(dbName, req);\n\n  req.onupgradeneeded = function (e) {\n    var db = e.target.result;\n    if (e.oldVersion < 1) {\n      return createSchema(db); // new db, initial schema\n    }\n    // do migrations\n\n    var txn = e.currentTarget.transaction;\n    // these migrations have to be done in this function, before\n    // control is returned to the event loop, because IndexedDB\n\n    if (e.oldVersion < 3) {\n      createLocalStoreSchema(db); // v2 -> v3\n    }\n    if (e.oldVersion < 4) {\n      addAttachAndSeqStore(db); // v3 -> v4\n    }\n\n    var migrations = [\n      addDeletedOrLocalIndex, // v1 -> v2\n      migrateLocalStore,      // v2 -> v3\n      migrateAttsAndSeqs,     // v3 -> v4\n      migrateMetadata         // v4 -> v5\n    ];\n\n    var i = e.oldVersion;\n\n    function next() {\n      var migration = migrations[i - 1];\n      i++;\n      if (migration) {\n        migration(txn, next);\n      }\n    }\n\n    next();\n  };\n\n  req.onsuccess = function (e) {\n\n    idb = e.target.result;\n\n    idb.onversionchange = function () {\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    idb.onabort = function (e) {\n      guardedConsole('error', 'Database has a global failure', e.target.error);\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    // Do a few setup operations (in parallel as much as possible):\n    // 1. Fetch meta doc\n    // 2. Check blob support\n    // 3. Calculate docCount\n    // 4. Generate an instanceId if necessary\n    // 5. Store docCount and instanceId on meta doc\n\n    var txn = idb.transaction([\n      META_STORE,\n      DETECT_BLOB_SUPPORT_STORE,\n      DOC_STORE\n    ], 'readwrite');\n\n    var storedMetaDoc = false;\n    var metaDoc;\n    var docCount;\n    var blobSupport;\n    var instanceId;\n\n    function completeSetup() {\n      if (typeof blobSupport === 'undefined' || !storedMetaDoc) {\n        return;\n      }\n      api._meta = {\n        name: dbName,\n        instanceId: instanceId,\n        blobSupport: blobSupport\n      };\n\n      cachedDBs.set(dbName, {\n        idb: idb,\n        global: api._meta\n      });\n      callback(null, api);\n    }\n\n    function storeMetaDocIfReady() {\n      if (typeof docCount === 'undefined' || typeof metaDoc === 'undefined') {\n        return;\n      }\n      var instanceKey = dbName + '_id';\n      if (instanceKey in metaDoc) {\n        instanceId = metaDoc[instanceKey];\n      } else {\n        metaDoc[instanceKey] = instanceId = uuid();\n      }\n      metaDoc.docCount = docCount;\n      txn.objectStore(META_STORE).put(metaDoc);\n    }\n\n    //\n    // fetch or generate the instanceId\n    //\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result || { id: META_STORE };\n      storeMetaDocIfReady();\n    };\n\n    //\n    // countDocs\n    //\n    countDocs(txn, function (count) {\n      docCount = count;\n      storeMetaDocIfReady();\n    });\n\n    //\n    // check blob support\n    //\n    if (!blobSupportPromise) {\n      // make sure blob support is only checked once\n      blobSupportPromise = checkBlobSupport(txn);\n    }\n\n    blobSupportPromise.then(function (val) {\n      blobSupport = val;\n      completeSetup();\n    });\n\n    // only when the metadata put transaction has completed,\n    // consider the setup done\n    txn.oncomplete = function () {\n      storedMetaDoc = true;\n      completeSetup();\n    };\n    txn.onabort = idbError(callback);\n  };\n\n  req.onerror = function (e) {\n    var msg = e.target.error && e.target.error.message;\n\n    if (!msg) {\n      msg = 'Failed to open indexedDB, are you in private browsing mode?';\n    } else if (msg.indexOf(\"stored database is a higher version\") !== -1) {\n      msg = new Error('This DB was created with the newer \"indexeddb\" adapter, but you are trying to open it with the older \"idb\" adapter');\n    }\n\n    guardedConsole('error', msg);\n    callback(createError(IDB_ERROR, msg));\n  };\n}\n\nIdbPouch.valid = function () {\n  // Following #7085 buggy idb versions (typically Safari < 10.1) are\n  // considered valid.\n\n  // On Firefox SecurityError is thrown while referencing indexedDB if cookies\n  // are not allowed. `typeof indexedDB` also triggers the error.\n  try {\n    // some outdated implementations of IDB that appear on Samsung\n    // and HTC Android devices <4.4 are missing IDBKeyRange\n    return typeof indexedDB !== 'undefined' && typeof IDBKeyRange !== 'undefined';\n  } catch (e) {\n    return false;\n  }\n};\n\nfunction IDBPouch (PouchDB) {\n  PouchDB.adapter('idb', IdbPouch, true);\n}\n\n// dead simple promise pool, inspired by https://github.com/timdp/es6-promise-pool\n// but much smaller in code size. limits the number of concurrent promises that are executed\n\n\nfunction pool(promiseFactories, limit) {\n  return new Promise(function (resolve, reject) {\n    var running = 0;\n    var current = 0;\n    var done = 0;\n    var len = promiseFactories.length;\n    var err;\n\n    function runNext() {\n      running++;\n      promiseFactories[current++]().then(onSuccess, onError);\n    }\n\n    function doNext() {\n      if (++done === len) {\n        /* istanbul ignore if */\n        if (err) {\n          reject(err);\n        } else {\n          resolve();\n        }\n      } else {\n        runNextBatch();\n      }\n    }\n\n    function onSuccess() {\n      running--;\n      doNext();\n    }\n\n    /* istanbul ignore next */\n    function onError(thisErr) {\n      running--;\n      err = err || thisErr;\n      doNext();\n    }\n\n    function runNextBatch() {\n      while (running < limit && current < len) {\n        runNext();\n      }\n    }\n\n    runNextBatch();\n  });\n}\n\nvar CHANGES_BATCH_SIZE = 25;\nvar MAX_SIMULTANEOUS_REVS = 50;\nvar CHANGES_TIMEOUT_BUFFER = 5000;\nvar DEFAULT_HEARTBEAT = 10000;\n\nvar supportsBulkGetMap = {};\n\nfunction readAttachmentsAsBlobOrBuffer(row) {\n  var doc = row.doc || row.ok;\n  var atts = doc && doc._attachments;\n  if (!atts) {\n    return;\n  }\n  Object.keys(atts).forEach(function (filename) {\n    var att = atts[filename];\n    att.data = b64ToBluffer(att.data, att.content_type);\n  });\n}\n\nfunction encodeDocId(id) {\n  if (/^_design/.test(id)) {\n    return '_design/' + encodeURIComponent(id.slice(8));\n  }\n  if (/^_local/.test(id)) {\n    return '_local/' + encodeURIComponent(id.slice(7));\n  }\n  return encodeURIComponent(id);\n}\n\nfunction preprocessAttachments$1(doc) {\n  if (!doc._attachments || !Object.keys(doc._attachments)) {\n    return Promise.resolve();\n  }\n\n  return Promise.all(Object.keys(doc._attachments).map(function (key) {\n    var attachment = doc._attachments[key];\n    if (attachment.data && typeof attachment.data !== 'string') {\n      return new Promise(function (resolve) {\n        blobToBase64(attachment.data, resolve);\n      }).then(function (b64) {\n        attachment.data = b64;\n      });\n    }\n  }));\n}\n\nfunction hasUrlPrefix(opts) {\n  if (!opts.prefix) {\n    return false;\n  }\n  var protocol = parseUri(opts.prefix).protocol;\n  return protocol === 'http' || protocol === 'https';\n}\n\n// Get all the information you possibly can about the URI given by name and\n// return it as a suitable object.\nfunction getHost(name, opts) {\n  // encode db name if opts.prefix is a url (#5574)\n  if (hasUrlPrefix(opts)) {\n    var dbName = opts.name.substr(opts.prefix.length);\n    // Ensure prefix has a trailing slash\n    var prefix = opts.prefix.replace(/\\/?$/, '/');\n    name = prefix + encodeURIComponent(dbName);\n  }\n\n  var uri = parseUri(name);\n  if (uri.user || uri.password) {\n    uri.auth = {username: uri.user, password: uri.password};\n  }\n\n  // Split the path part of the URI into parts using '/' as the delimiter\n  // after removing any leading '/' and any trailing '/'\n  var parts = uri.path.replace(/(^\\/|\\/$)/g, '').split('/');\n\n  uri.db = parts.pop();\n  // Prevent double encoding of URI component\n  if (uri.db.indexOf('%') === -1) {\n    uri.db = encodeURIComponent(uri.db);\n  }\n\n  uri.path = parts.join('/');\n\n  return uri;\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genDBUrl(opts, path) {\n  return genUrl(opts, opts.db + '/' + path);\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genUrl(opts, path) {\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  var pathDel = !opts.path ? '' : '/';\n\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  return opts.protocol + '://' + opts.host +\n         (opts.port ? (':' + opts.port) : '') +\n         '/' + opts.path + pathDel + path;\n}\n\nfunction paramsToStr(params) {\n  return '?' + Object.keys(params).map(function (k) {\n    return k + '=' + encodeURIComponent(params[k]);\n  }).join('&');\n}\n\nfunction shouldCacheBust(opts) {\n  var ua = (typeof navigator !== 'undefined' && navigator.userAgent) ?\n      navigator.userAgent.toLowerCase() : '';\n  var isIE = ua.indexOf('msie') !== -1;\n  var isTrident = ua.indexOf('trident') !== -1;\n  var isEdge = ua.indexOf('edge') !== -1;\n  var isGET = !('method' in opts) || opts.method === 'GET';\n  return (isIE || isTrident || isEdge) && isGET;\n}\n\n// Implements the PouchDB API for dealing with CouchDB instances over HTTP\nfunction HttpPouch(opts, callback) {\n\n  // The functions that will be publicly available for HttpPouch\n  var api = this;\n\n  var host = getHost(opts.name, opts);\n  var dbUrl = genDBUrl(host, '');\n\n  opts = clone(opts);\n\n  var ourFetch = function (url, options) {\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    options.credentials = 'include';\n\n    if (opts.auth || host.auth) {\n      var nAuth = opts.auth || host.auth;\n      var str = nAuth.username + ':' + nAuth.password;\n      var token = thisBtoa(unescape(encodeURIComponent(str)));\n      options.headers.set('Authorization', 'Basic ' + token);\n    }\n\n    var headers = opts.headers || {};\n    Object.keys(headers).forEach(function (key) {\n      options.headers.append(key, headers[key]);\n    });\n\n    /* istanbul ignore if */\n    if (shouldCacheBust(options)) {\n      url += (url.indexOf('?') === -1 ? '?' : '&') + '_nonce=' + Date.now();\n    }\n\n    var fetchFun = opts.fetch || f$1;\n    return fetchFun(url, options);\n  };\n\n  function adapterFun$$1(name, fun) {\n    return adapterFun(name, getArguments(function (args) {\n      setup().then(function () {\n        return fun.apply(this, args);\n      }).catch(function (e) {\n        var callback = args.pop();\n        callback(e);\n      });\n    })).bind(api);\n  }\n\n  function fetchJSON(url, options, callback) {\n\n    var result = {};\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (!options.headers.get('Content-Type')) {\n      options.headers.set('Content-Type', 'application/json');\n    }\n    if (!options.headers.get('Accept')) {\n      options.headers.set('Accept', 'application/json');\n    }\n\n    return ourFetch(url, options).then(function (response) {\n      result.ok = response.ok;\n      result.status = response.status;\n      return response.json();\n    }).then(function (json) {\n      result.data = json;\n      if (!result.ok) {\n        result.data.status = result.status;\n        var err = generateErrorFromResponse(result.data);\n        if (callback) {\n          return callback(err);\n        } else {\n          throw err;\n        }\n      }\n\n      if (Array.isArray(result.data)) {\n        result.data = result.data.map(function (v) {\n          if (v.error || v.missing) {\n            return generateErrorFromResponse(v);\n          } else {\n            return v;\n          }\n        });\n      }\n\n      if (callback) {\n        callback(null, result.data);\n      } else {\n        return result;\n      }\n    });\n  }\n\n  var setupPromise;\n\n  function setup() {\n    if (opts.skip_setup) {\n      return Promise.resolve();\n    }\n\n    // If there is a setup in process or previous successful setup\n    // done then we will use that\n    // If previous setups have been rejected we will try again\n    if (setupPromise) {\n      return setupPromise;\n    }\n\n    setupPromise = fetchJSON(dbUrl).catch(function (err) {\n      if (err && err.status && err.status === 404) {\n        // Doesnt exist, create it\n        explainError(404, 'PouchDB is just detecting if the remote exists.');\n        return fetchJSON(dbUrl, {method: 'PUT'});\n      } else {\n        return Promise.reject(err);\n      }\n    }).catch(function (err) {\n      // If we try to create a database that already exists, skipped in\n      // istanbul since its catching a race condition.\n      /* istanbul ignore if */\n      if (err && err.status && err.status === 412) {\n        return true;\n      }\n      return Promise.reject(err);\n    });\n\n    setupPromise.catch(function () {\n      setupPromise = null;\n    });\n\n    return setupPromise;\n  }\n\n  immediate(function () {\n    callback(null, api);\n  });\n\n  api._remote = true;\n\n  /* istanbul ignore next */\n  api.type = function () {\n    return 'http';\n  };\n\n  api.id = adapterFun$$1('id', function (callback) {\n    ourFetch(genUrl(host, '')).then(function (response) {\n      return response.json();\n    }).catch(function () {\n      return {};\n    }).then(function (result) {\n      // Bad response or missing `uuid` should not prevent ID generation.\n      var uuid$$1 = (result && result.uuid) ?\n          (result.uuid + host.db) : genDBUrl(host, '');\n      callback(null, uuid$$1);\n    });\n  });\n\n  // Sends a POST request to the host calling the couchdb _compact function\n  //    version: The version of CouchDB it is running\n  api.compact = adapterFun$$1('compact', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    fetchJSON(genDBUrl(host, '_compact'), {method: 'POST'}).then(function () {\n      function ping() {\n        api.info(function (err, res) {\n          // CouchDB may send a \"compact_running:true\" if it's\n          // already compacting. PouchDB Server doesn't.\n          /* istanbul ignore else */\n          if (res && !res.compact_running) {\n            callback(null, {ok: true});\n          } else {\n            setTimeout(ping, opts.interval || 200);\n          }\n        });\n      }\n      // Ping the http if it's finished compaction\n      ping();\n    });\n  });\n\n  api.bulkGet = adapterFun('bulkGet', function (opts, callback) {\n    var self = this;\n\n    function doBulkGet(cb) {\n      var params = {};\n      if (opts.revs) {\n        params.revs = true;\n      }\n      if (opts.attachments) {\n        /* istanbul ignore next */\n        params.attachments = true;\n      }\n      if (opts.latest) {\n        params.latest = true;\n      }\n      fetchJSON(genDBUrl(host, '_bulk_get' + paramsToStr(params)), {\n        method: 'POST',\n        body: JSON.stringify({ docs: opts.docs})\n      }).then(function (result) {\n        if (opts.attachments && opts.binary) {\n          result.data.results.forEach(function (res) {\n            res.docs.forEach(readAttachmentsAsBlobOrBuffer);\n          });\n        }\n        cb(null, result.data);\n      }).catch(cb);\n    }\n\n    /* istanbul ignore next */\n    function doBulkGetShim() {\n      // avoid \"url too long error\" by splitting up into multiple requests\n      var batchSize = MAX_SIMULTANEOUS_REVS;\n      var numBatches = Math.ceil(opts.docs.length / batchSize);\n      var numDone = 0;\n      var results = new Array(numBatches);\n\n      function onResult(batchNum) {\n        return function (err, res) {\n          // err is impossible because shim returns a list of errs in that case\n          results[batchNum] = res.results;\n          if (++numDone === numBatches) {\n            callback(null, {results: flatten(results)});\n          }\n        };\n      }\n\n      for (var i = 0; i < numBatches; i++) {\n        var subOpts = pick(opts, ['revs', 'attachments', 'binary', 'latest']);\n        subOpts.docs = opts.docs.slice(i * batchSize,\n          Math.min(opts.docs.length, (i + 1) * batchSize));\n        bulkGet(self, subOpts, onResult(i));\n      }\n    }\n\n    // mark the whole database as either supporting or not supporting _bulk_get\n    var dbUrl = genUrl(host, '');\n    var supportsBulkGet = supportsBulkGetMap[dbUrl];\n\n    /* istanbul ignore next */\n    if (typeof supportsBulkGet !== 'boolean') {\n      // check if this database supports _bulk_get\n      doBulkGet(function (err, res) {\n        if (err) {\n          supportsBulkGetMap[dbUrl] = false;\n          explainError(\n            err.status,\n            'PouchDB is just detecting if the remote ' +\n            'supports the _bulk_get API.'\n          );\n          doBulkGetShim();\n        } else {\n          supportsBulkGetMap[dbUrl] = true;\n          callback(null, res);\n        }\n      });\n    } else if (supportsBulkGet) {\n      doBulkGet(callback);\n    } else {\n      doBulkGetShim();\n    }\n  });\n\n  // Calls GET on the host, which gets back a JSON string containing\n  //    couchdb: A welcome string\n  //    version: The version of CouchDB it is running\n  api._info = function (callback) {\n    setup().then(function () {\n      return ourFetch(genDBUrl(host, ''));\n    }).then(function (response) {\n      return response.json();\n    }).then(function (info) {\n      info.host = genDBUrl(host, '');\n      callback(null, info);\n    }).catch(callback);\n  };\n\n  api.fetch = function (path, options) {\n    return setup().then(function () {\n      var url = path.substring(0, 1) === '/' ?\n        genUrl(host, path.substring(1)) :\n        genDBUrl(host, path);\n      return ourFetch(url, options);\n    });\n  };\n\n  // Get the document with the given id from the database given by host.\n  // The id could be solely the _id in the database, or it may be a\n  // _design/ID or _local/ID path\n  api.get = adapterFun$$1('get', function (id, opts, callback) {\n    // If no options were given, set the callback to the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n\n    if (opts.revs) {\n      params.revs = true;\n    }\n\n    if (opts.revs_info) {\n      params.revs_info = true;\n    }\n\n    if (opts.latest) {\n      params.latest = true;\n    }\n\n    if (opts.open_revs) {\n      if (opts.open_revs !== \"all\") {\n        opts.open_revs = JSON.stringify(opts.open_revs);\n      }\n      params.open_revs = opts.open_revs;\n    }\n\n    if (opts.rev) {\n      params.rev = opts.rev;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = opts.conflicts;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = opts.update_seq;\n    }\n\n    id = encodeDocId(id);\n\n    function fetchAttachments(doc) {\n      var atts = doc._attachments;\n      var filenames = atts && Object.keys(atts);\n      if (!atts || !filenames.length) {\n        return;\n      }\n      // we fetch these manually in separate XHRs, because\n      // Sync Gateway would normally send it back as multipart/mixed,\n      // which we cannot parse. Also, this is more efficient than\n      // receiving attachments as base64-encoded strings.\n      function fetchData(filename) {\n        var att = atts[filename];\n        var path = encodeDocId(doc._id) + '/' + encodeAttachmentId(filename) +\n            '?rev=' + doc._rev;\n        return ourFetch(genDBUrl(host, path)).then(function (response) {\n          if ('buffer' in response) {\n            return response.buffer();\n          } else {\n            /* istanbul ignore next */\n            return response.blob();\n          }\n        }).then(function (blob) {\n          if (opts.binary) {\n            var typeFieldDescriptor = Object.getOwnPropertyDescriptor(blob.__proto__, 'type');\n            if (!typeFieldDescriptor || typeFieldDescriptor.set) {\n              blob.type = att.content_type;\n            }\n            return blob;\n          }\n          return new Promise(function (resolve) {\n            blobToBase64(blob, resolve);\n          });\n        }).then(function (data) {\n          delete att.stub;\n          delete att.length;\n          att.data = data;\n        });\n      }\n\n      var promiseFactories = filenames.map(function (filename) {\n        return function () {\n          return fetchData(filename);\n        };\n      });\n\n      // This limits the number of parallel xhr requests to 5 any time\n      // to avoid issues with maximum browser request limits\n      return pool(promiseFactories, 5);\n    }\n\n    function fetchAllAttachments(docOrDocs) {\n      if (Array.isArray(docOrDocs)) {\n        return Promise.all(docOrDocs.map(function (doc) {\n          if (doc.ok) {\n            return fetchAttachments(doc.ok);\n          }\n        }));\n      }\n      return fetchAttachments(docOrDocs);\n    }\n\n    var url = genDBUrl(host, id + paramsToStr(params));\n    fetchJSON(url).then(function (res) {\n      return Promise.resolve().then(function () {\n        if (opts.attachments) {\n          return fetchAllAttachments(res.data);\n        }\n      }).then(function () {\n        callback(null, res.data);\n      });\n    }).catch(function (e) {\n      e.docId = id;\n      callback(e);\n    });\n  });\n\n\n  // Delete the document given by doc from the database given by host.\n  api.remove = adapterFun$$1('remove', function (docOrId, optsOrRev, opts, cb) {\n    var doc;\n    if (typeof optsOrRev === 'string') {\n      // id, rev, opts, callback style\n      doc = {\n        _id: docOrId,\n        _rev: optsOrRev\n      };\n      if (typeof opts === 'function') {\n        cb = opts;\n        opts = {};\n      }\n    } else {\n      // doc, opts, callback style\n      doc = docOrId;\n      if (typeof optsOrRev === 'function') {\n        cb = optsOrRev;\n        opts = {};\n      } else {\n        cb = opts;\n        opts = optsOrRev;\n      }\n    }\n\n    var rev$$1 = (doc._rev || opts.rev);\n    var url = genDBUrl(host, encodeDocId(doc._id)) + '?rev=' + rev$$1;\n\n    fetchJSON(url, {method: 'DELETE'}, cb).catch(cb);\n  });\n\n  function encodeAttachmentId(attachmentId) {\n    return attachmentId.split(\"/\").map(encodeURIComponent).join(\"/\");\n  }\n\n  // Get the attachment\n  api.getAttachment = adapterFun$$1('getAttachment', function (docId, attachmentId,\n                                                            opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var params = opts.rev ? ('?rev=' + opts.rev) : '';\n    var url = genDBUrl(host, encodeDocId(docId)) + '/' +\n        encodeAttachmentId(attachmentId) + params;\n    var contentType;\n    ourFetch(url, {method: 'GET'}).then(function (response) {\n      contentType = response.headers.get('content-type');\n      if (!response.ok) {\n        throw response;\n      } else {\n        if (typeof process !== 'undefined' && !process.browser && typeof response.buffer === 'function') {\n          return response.buffer();\n        } else {\n          /* istanbul ignore next */\n          return response.blob();\n        }\n      }\n    }).then(function (blob) {\n      // TODO: also remove\n      if (typeof process !== 'undefined' && !process.browser) {\n        blob.type = contentType;\n      }\n      callback(null, blob);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Remove the attachment given by the id and rev\n  api.removeAttachment =  adapterFun$$1('removeAttachment', function (docId,\n                                                                   attachmentId,\n                                                                   rev$$1,\n                                                                   callback) {\n    var url = genDBUrl(host, encodeDocId(docId) + '/' +\n                       encodeAttachmentId(attachmentId)) + '?rev=' + rev$$1;\n    fetchJSON(url, {method: 'DELETE'}, callback).catch(callback);\n  });\n\n  // Add the attachment given by blob and its contentType property\n  // to the document with the given id, the revision given by rev, and\n  // add it to the database given by host.\n  api.putAttachment = adapterFun$$1('putAttachment', function (docId, attachmentId,\n                                                            rev$$1, blob,\n                                                            type, callback) {\n    if (typeof type === 'function') {\n      callback = type;\n      type = blob;\n      blob = rev$$1;\n      rev$$1 = null;\n    }\n    var id = encodeDocId(docId) + '/' + encodeAttachmentId(attachmentId);\n    var url = genDBUrl(host, id);\n    if (rev$$1) {\n      url += '?rev=' + rev$$1;\n    }\n\n    if (typeof blob === 'string') {\n      // input is assumed to be a base64 string\n      var binary;\n      try {\n        binary = thisAtob(blob);\n      } catch (err) {\n        return callback(createError(BAD_ARG,\n                        'Attachment is not a valid base64 string'));\n      }\n      blob = binary ? binStringToBluffer(binary, type) : '';\n    }\n\n    // Add the attachment\n    fetchJSON(url, {\n      headers: new h({'Content-Type': type}),\n      method: 'PUT',\n      body: blob\n    }, callback).catch(callback);\n  });\n\n  // Update/create multiple documents given by req in the database\n  // given by host.\n  api._bulkDocs = function (req, opts, callback) {\n    // If new_edits=false then it prevents the database from creating\n    // new revision numbers for the documents. Instead it just uses\n    // the old ones. This is used in database replication.\n    req.new_edits = opts.new_edits;\n\n    setup().then(function () {\n      return Promise.all(req.docs.map(preprocessAttachments$1));\n    }).then(function () {\n      // Update/create the documents\n      return fetchJSON(genDBUrl(host, '_bulk_docs'), {\n        method: 'POST',\n        body: JSON.stringify(req)\n      }, callback);\n    }).catch(callback);\n  };\n\n\n  // Update/create document\n  api._put = function (doc, opts, callback) {\n    setup().then(function () {\n      return preprocessAttachments$1(doc);\n    }).then(function () {\n      return fetchJSON(genDBUrl(host, encodeDocId(doc._id)), {\n        method: 'PUT',\n        body: JSON.stringify(doc)\n      });\n    }).then(function (result) {\n      callback(null, result.data);\n    }).catch(function (err) {\n      err.docId = doc && doc._id;\n      callback(err);\n    });\n  };\n\n\n  // Get a listing of the documents in the database given\n  // by host and ordered by increasing id.\n  api.allDocs = adapterFun$$1('allDocs', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n    var body;\n    var method = 'GET';\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    if (opts.include_docs) {\n      params.include_docs = true;\n    }\n\n    // added in CouchDB 1.6.0\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.key) {\n      params.key = JSON.stringify(opts.key);\n    }\n\n    if (opts.start_key) {\n      opts.startkey = opts.start_key;\n    }\n\n    if (opts.startkey) {\n      params.startkey = JSON.stringify(opts.startkey);\n    }\n\n    if (opts.end_key) {\n      opts.endkey = opts.end_key;\n    }\n\n    if (opts.endkey) {\n      params.endkey = JSON.stringify(opts.endkey);\n    }\n\n    if (typeof opts.inclusive_end !== 'undefined') {\n      params.inclusive_end = !!opts.inclusive_end;\n    }\n\n    if (typeof opts.limit !== 'undefined') {\n      params.limit = opts.limit;\n    }\n\n    if (typeof opts.skip !== 'undefined') {\n      params.skip = opts.skip;\n    }\n\n    var paramStr = paramsToStr(params);\n\n    if (typeof opts.keys !== 'undefined') {\n      method = 'POST';\n      body = {keys: opts.keys};\n    }\n\n    fetchJSON(genDBUrl(host, '_all_docs' + paramStr), {\n       method: method,\n      body: JSON.stringify(body)\n    }).then(function (result) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        result.data.rows.forEach(readAttachmentsAsBlobOrBuffer);\n      }\n      callback(null, result.data);\n    }).catch(callback);\n  });\n\n  // Get a list of changes made to documents in the database given by host.\n  // TODO According to the README, there should be two other methods here,\n  // api.changes.addListener and api.changes.removeListener.\n  api._changes = function (opts) {\n\n    // We internally page the results of a changes request, this means\n    // if there is a large set of changes to be returned we can start\n    // processing them quicker instead of waiting on the entire\n    // set of changes to return and attempting to process them at once\n    var batchSize = 'batch_size' in opts ? opts.batch_size : CHANGES_BATCH_SIZE;\n\n    opts = clone(opts);\n\n    if (opts.continuous && !('heartbeat' in opts)) {\n      opts.heartbeat = DEFAULT_HEARTBEAT;\n    }\n\n    var requestTimeout = ('timeout' in opts) ? opts.timeout : 30 * 1000;\n\n    // ensure CHANGES_TIMEOUT_BUFFER applies\n    if ('timeout' in opts && opts.timeout &&\n      (requestTimeout - opts.timeout) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.timeout + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    /* istanbul ignore if */\n    if ('heartbeat' in opts && opts.heartbeat &&\n       (requestTimeout - opts.heartbeat) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.heartbeat + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    var params = {};\n    if ('timeout' in opts && opts.timeout) {\n      params.timeout = opts.timeout;\n    }\n\n    var limit = (typeof opts.limit !== 'undefined') ? opts.limit : false;\n    var leftToFetch = limit;\n\n    if (opts.style) {\n      params.style = opts.style;\n    }\n\n    if (opts.include_docs || opts.filter && typeof opts.filter === 'function') {\n      params.include_docs = true;\n    }\n\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.continuous) {\n      params.feed = 'longpoll';\n    }\n\n    if (opts.seq_interval) {\n      params.seq_interval = opts.seq_interval;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if ('heartbeat' in opts) {\n      // If the heartbeat value is false, it disables the default heartbeat\n      if (opts.heartbeat) {\n        params.heartbeat = opts.heartbeat;\n      }\n    }\n\n    if (opts.filter && typeof opts.filter === 'string') {\n      params.filter = opts.filter;\n    }\n\n    if (opts.view && typeof opts.view === 'string') {\n      params.filter = '_view';\n      params.view = opts.view;\n    }\n\n    // If opts.query_params exists, pass it through to the changes request.\n    // These parameters may be used by the filter on the source database.\n    if (opts.query_params && typeof opts.query_params === 'object') {\n      for (var param_name in opts.query_params) {\n        /* istanbul ignore else */\n        if (opts.query_params.hasOwnProperty(param_name)) {\n          params[param_name] = opts.query_params[param_name];\n        }\n      }\n    }\n\n    var method = 'GET';\n    var body;\n\n    if (opts.doc_ids) {\n      // set this automagically for the user; it's annoying that couchdb\n      // requires both a \"filter\" and a \"doc_ids\" param.\n      params.filter = '_doc_ids';\n      method = 'POST';\n      body = {doc_ids: opts.doc_ids };\n    }\n    /* istanbul ignore next */\n    else if (opts.selector) {\n      // set this automagically for the user, similar to above\n      params.filter = '_selector';\n      method = 'POST';\n      body = {selector: opts.selector };\n    }\n\n    var controller = new a();\n    var lastFetchedSeq;\n\n    // Get all the changes starting wtih the one immediately after the\n    // sequence number given by since.\n    var fetchData = function (since, callback) {\n      if (opts.aborted) {\n        return;\n      }\n      params.since = since;\n      // \"since\" can be any kind of json object in Cloudant/CouchDB 2.x\n      /* istanbul ignore next */\n      if (typeof params.since === \"object\") {\n        params.since = JSON.stringify(params.since);\n      }\n\n      if (opts.descending) {\n        if (limit) {\n          params.limit = leftToFetch;\n        }\n      } else {\n        params.limit = (!limit || leftToFetch > batchSize) ?\n          batchSize : leftToFetch;\n      }\n\n      // Set the options for the ajax call\n      var url = genDBUrl(host, '_changes' + paramsToStr(params));\n      var fetchOpts = {\n        signal: controller.signal,\n        method: method,\n        body: JSON.stringify(body)\n      };\n      lastFetchedSeq = since;\n\n      /* istanbul ignore if */\n      if (opts.aborted) {\n        return;\n      }\n\n      // Get the changes\n      setup().then(function () {\n        return fetchJSON(url, fetchOpts, callback);\n      }).catch(callback);\n    };\n\n    // If opts.since exists, get all the changes from the sequence\n    // number given by opts.since. Otherwise, get all the changes\n    // from the sequence number 0.\n    var results = {results: []};\n\n    var fetched = function (err, res) {\n      if (opts.aborted) {\n        return;\n      }\n      var raw_results_length = 0;\n      // If the result of the ajax call (res) contains changes (res.results)\n      if (res && res.results) {\n        raw_results_length = res.results.length;\n        results.last_seq = res.last_seq;\n        var pending = null;\n        var lastSeq = null;\n        // Attach 'pending' property if server supports it (CouchDB 2.0+)\n        /* istanbul ignore if */\n        if (typeof res.pending === 'number') {\n          pending = res.pending;\n        }\n        if (typeof results.last_seq === 'string' || typeof results.last_seq === 'number') {\n          lastSeq = results.last_seq;\n        }\n        // For each change\n        var req = {};\n        req.query = opts.query_params;\n        res.results = res.results.filter(function (c) {\n          leftToFetch--;\n          var ret = filterChange(opts)(c);\n          if (ret) {\n            if (opts.include_docs && opts.attachments && opts.binary) {\n              readAttachmentsAsBlobOrBuffer(c);\n            }\n            if (opts.return_docs) {\n              results.results.push(c);\n            }\n            opts.onChange(c, pending, lastSeq);\n          }\n          return ret;\n        });\n      } else if (err) {\n        // In case of an error, stop listening for changes and call\n        // opts.complete\n        opts.aborted = true;\n        opts.complete(err);\n        return;\n      }\n\n      // The changes feed may have timed out with no results\n      // if so reuse last update sequence\n      if (res && res.last_seq) {\n        lastFetchedSeq = res.last_seq;\n      }\n\n      var finished = (limit && leftToFetch <= 0) ||\n        (res && raw_results_length < batchSize) ||\n        (opts.descending);\n\n      if ((opts.continuous && !(limit && leftToFetch <= 0)) || !finished) {\n        // Queue a call to fetch again with the newest sequence number\n        immediate(function () { fetchData(lastFetchedSeq, fetched); });\n      } else {\n        // We're done, call the callback\n        opts.complete(null, results);\n      }\n    };\n\n    fetchData(opts.since || 0, fetched);\n\n    // Return a method to cancel this method from processing any more\n    return {\n      cancel: function () {\n        opts.aborted = true;\n        controller.abort();\n      }\n    };\n  };\n\n  // Given a set of document/revision IDs (given by req), tets the subset of\n  // those that do NOT correspond to revisions stored in the database.\n  // See http://wiki.apache.org/couchdb/HttpPostRevsDiff\n  api.revsDiff = adapterFun$$1('revsDiff', function (req, opts, callback) {\n    // If no options were given, set the callback to be the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n\n    // Get the missing document/revision IDs\n    fetchJSON(genDBUrl(host, '_revs_diff'), {\n      method: 'POST',\n      body: JSON.stringify(req)\n    }, callback).catch(callback);\n  });\n\n  api._close = function (callback) {\n    callback();\n  };\n\n  api._destroy = function (options, callback) {\n    fetchJSON(genDBUrl(host, ''), {method: 'DELETE'}).then(function (json) {\n      callback(null, json);\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status === 404) {\n        callback(null, {ok: true});\n      } else {\n        callback(err);\n      }\n    });\n  };\n}\n\n// HttpPouch is a valid adapter.\nHttpPouch.valid = function () {\n  return true;\n};\n\nfunction HttpPouch$1 (PouchDB) {\n  PouchDB.adapter('http', HttpPouch, false);\n  PouchDB.adapter('https', HttpPouch, false);\n}\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      immediate(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      immediate(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new ExportedSet(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nfunction createBuiltInError(name) {\n  var message = 'builtin ' + name +\n    ' function requires map values to be numbers' +\n    ' or number arrays';\n  return new BuiltInError(message);\n}\n\nfunction sum(values) {\n  var result = 0;\n  for (var i = 0, len = values.length; i < len; i++) {\n    var num = values[i];\n    if (typeof num !== 'number') {\n      if (Array.isArray(num)) {\n        // lists of numbers are also allowed, sum them separately\n        result = typeof result === 'number' ? [result] : result;\n        for (var j = 0, jLen = num.length; j < jLen; j++) {\n          var jNum = num[j];\n          if (typeof jNum !== 'number') {\n            throw createBuiltInError('_sum');\n          } else if (typeof result[j] === 'undefined') {\n            result.push(jNum);\n          } else {\n            result[j] += jNum;\n          }\n        }\n      } else { // not array/number\n        throw createBuiltInError('_sum');\n      }\n    } else if (typeof result === 'number') {\n      result += num;\n    } else { // add number to array\n      result[0] += num;\n    }\n  }\n  return result;\n}\n\nvar log = guardedConsole.bind(null, 'log');\nvar isArray = Array.isArray;\nvar toJSON = JSON.parse;\n\nfunction evalFunctionWithEval(func, emit) {\n  return scopeEval(\n    \"return (\" + func.replace(/;\\s*$/, \"\") + \");\",\n    {\n      emit: emit,\n      sum: sum,\n      log: log,\n      isArray: isArray,\n      toJSON: toJSON\n    }\n  );\n}\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue$1() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue$1.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue$1.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue$1();\nvar CHANGES_BATCH_SIZE$1 = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = b64ToBluffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new h({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new ExportedSet();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue$1();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue$1();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE$1\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE$1) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new ExportedMap();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new ExportedMap();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new ExportedMap();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new ExportedMap();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new ExportedSet();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              immediate(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nvar builtInReduce = {\n  _sum: function (keys, values) {\n    return sum(values);\n  },\n\n  _count: function (keys, values) {\n    return values.length;\n  },\n\n  _stats: function (keys, values) {\n    // no need to implement rereduce=true, because Pouch\n    // will never call it\n    function sumsqr(values) {\n      var _sumsqr = 0;\n      for (var i = 0, len = values.length; i < len; i++) {\n        var num = values[i];\n        _sumsqr += (num * num);\n      }\n      return _sumsqr;\n    }\n    return {\n      sum     : sum(values),\n      min     : Math.min.apply(null, values),\n      max     : Math.max.apply(null, values),\n      count   : values.length,\n      sumsqr : sumsqr(values)\n    };\n  }\n};\n\nfunction getBuiltIn(reduceFunString) {\n  if (/^_sum/.test(reduceFunString)) {\n    return builtInReduce._sum;\n  } else if (/^_count/.test(reduceFunString)) {\n    return builtInReduce._count;\n  } else if (/^_stats/.test(reduceFunString)) {\n    return builtInReduce._stats;\n  } else if (/^_/.test(reduceFunString)) {\n    throw new Error(reduceFunString + ' is not a supported reduce function.');\n  }\n}\n\nfunction mapper(mapFun, emit) {\n  // for temp_views one can use emit(doc, emit), see #38\n  if (typeof mapFun === \"function\" && mapFun.length === 2) {\n    var origMap = mapFun;\n    return function (doc) {\n      return origMap(doc, emit);\n    };\n  } else {\n    return evalFunctionWithEval(mapFun.toString(), emit);\n  }\n}\n\nfunction reducer(reduceFun) {\n  var reduceFunString = reduceFun.toString();\n  var builtIn = getBuiltIn(reduceFunString);\n  if (builtIn) {\n    return builtIn;\n  } else {\n    return evalFunctionWithEval(reduceFunString);\n  }\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var fun = ddoc.views && ddoc.views[viewName];\n  if (typeof fun.map !== 'string') {\n    throw new NotFoundError('ddoc ' + ddoc._id + ' has no string view named ' +\n      viewName + ', instead found object of type: ' + typeof fun.map);\n  }\n}\n\nvar localDocName = 'mrviews';\nvar abstract = createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator);\n\nfunction query(fun, opts, callback) {\n  return abstract.query.call(this, fun, opts, callback);\n}\n\nfunction viewCleanup(callback) {\n  return abstract.viewCleanup.call(this, callback);\n}\n\nvar mapreduce = {\n  query: query,\n  viewCleanup: viewCleanup\n};\n\nfunction isGenOne$1(rev$$1) {\n  return /^1-/.test(rev$$1);\n}\n\nfunction fileHasChanged(localDoc, remoteDoc, filename) {\n  return !localDoc._attachments ||\n         !localDoc._attachments[filename] ||\n         localDoc._attachments[filename].digest !== remoteDoc._attachments[filename].digest;\n}\n\nfunction getDocAttachments(db, doc) {\n  var filenames = Object.keys(doc._attachments);\n  return Promise.all(filenames.map(function (filename) {\n    return db.getAttachment(doc._id, filename, {rev: doc._rev});\n  }));\n}\n\nfunction getDocAttachmentsFromTargetOrSource(target, src, doc) {\n  var doCheckForLocalAttachments = isRemote(src) && !isRemote(target);\n  var filenames = Object.keys(doc._attachments);\n\n  if (!doCheckForLocalAttachments) {\n    return getDocAttachments(src, doc);\n  }\n\n  return target.get(doc._id).then(function (localDoc) {\n    return Promise.all(filenames.map(function (filename) {\n      if (fileHasChanged(localDoc, doc, filename)) {\n        return src.getAttachment(doc._id, filename);\n      }\n\n      return target.getAttachment(localDoc._id, filename);\n    }));\n  }).catch(function (error) {\n    /* istanbul ignore if */\n    if (error.status !== 404) {\n      throw error;\n    }\n\n    return getDocAttachments(src, doc);\n  });\n}\n\nfunction createBulkGetOpts(diffs) {\n  var requests = [];\n  Object.keys(diffs).forEach(function (id) {\n    var missingRevs = diffs[id].missing;\n    missingRevs.forEach(function (missingRev) {\n      requests.push({\n        id: id,\n        rev: missingRev\n      });\n    });\n  });\n\n  return {\n    docs: requests,\n    revs: true,\n    latest: true\n  };\n}\n\n//\n// Fetch all the documents from the src as described in the \"diffs\",\n// which is a mapping of docs IDs to revisions. If the state ever\n// changes to \"cancelled\", then the returned promise will be rejected.\n// Else it will be resolved with a list of fetched documents.\n//\nfunction getDocs(src, target, diffs, state) {\n  diffs = clone(diffs); // we do not need to modify this\n\n  var resultDocs = [],\n      ok = true;\n\n  function getAllDocs() {\n\n    var bulkGetOpts = createBulkGetOpts(diffs);\n\n    if (!bulkGetOpts.docs.length) { // optimization: skip empty requests\n      return;\n    }\n\n    return src.bulkGet(bulkGetOpts).then(function (bulkGetResponse) {\n      /* istanbul ignore if */\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      return Promise.all(bulkGetResponse.results.map(function (bulkGetInfo) {\n        return Promise.all(bulkGetInfo.docs.map(function (doc) {\n          var remoteDoc = doc.ok;\n\n          if (doc.error) {\n            // when AUTO_COMPACTION is set, docs can be returned which look\n            // like this: {\"missing\":\"1-7c3ac256b693c462af8442f992b83696\"}\n            ok = false;\n          }\n\n          if (!remoteDoc || !remoteDoc._attachments) {\n            return remoteDoc;\n          }\n\n          return getDocAttachmentsFromTargetOrSource(target, src, remoteDoc)\n                   .then(function (attachments) {\n                           var filenames = Object.keys(remoteDoc._attachments);\n                           attachments\n                             .forEach(function (attachment, i) {\n                                        var att = remoteDoc._attachments[filenames[i]];\n                                        delete att.stub;\n                                        delete att.length;\n                                        att.data = attachment;\n                                      });\n\n                                      return remoteDoc;\n                                    });\n        }));\n      }))\n\n      .then(function (results) {\n        resultDocs = resultDocs.concat(flatten(results).filter(Boolean));\n      });\n    });\n  }\n\n  function hasAttachments(doc) {\n    return doc._attachments && Object.keys(doc._attachments).length > 0;\n  }\n\n  function hasConflicts(doc) {\n    return doc._conflicts && doc._conflicts.length > 0;\n  }\n\n  function fetchRevisionOneDocs(ids) {\n    // Optimization: fetch gen-1 docs and attachments in\n    // a single request using _all_docs\n    return src.allDocs({\n      keys: ids,\n      include_docs: true,\n      conflicts: true\n    }).then(function (res) {\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      res.rows.forEach(function (row) {\n        if (row.deleted || !row.doc || !isGenOne$1(row.value.rev) ||\n            hasAttachments(row.doc) || hasConflicts(row.doc)) {\n          // if any of these conditions apply, we need to fetch using get()\n          return;\n        }\n\n        // strip _conflicts array to appease CSG (#5793)\n        /* istanbul ignore if */\n        if (row.doc._conflicts) {\n          delete row.doc._conflicts;\n        }\n\n        // the doc we got back from allDocs() is sufficient\n        resultDocs.push(row.doc);\n        delete diffs[row.id];\n      });\n    });\n  }\n\n  function getRevisionOneDocs() {\n    // filter out the generation 1 docs and get them\n    // leaving the non-generation one docs to be got otherwise\n    var ids = Object.keys(diffs).filter(function (id) {\n      var missing = diffs[id].missing;\n      return missing.length === 1 && isGenOne$1(missing[0]);\n    });\n    if (ids.length > 0) {\n      return fetchRevisionOneDocs(ids);\n    }\n  }\n\n  function returnResult() {\n    return { ok:ok, docs:resultDocs };\n  }\n\n  return Promise.resolve()\n    .then(getRevisionOneDocs)\n    .then(getAllDocs)\n    .then(returnResult);\n}\n\nvar CHECKPOINT_VERSION = 1;\nvar REPLICATOR = \"pouchdb\";\n// This is an arbitrary number to limit the\n// amount of replication history we save in the checkpoint.\n// If we save too much, the checkpoing docs will become very big,\n// if we save fewer, we'll run a greater risk of having to\n// read all the changes from 0 when checkpoint PUTs fail\n// CouchDB 2.0 has a more involved history pruning,\n// but let's go for the simple version for now.\nvar CHECKPOINT_HISTORY_SIZE = 5;\nvar LOWEST_SEQ = 0;\n\nfunction updateCheckpoint(db, id, checkpoint, session, returnValue) {\n  return db.get(id).catch(function (err) {\n    if (err.status === 404) {\n      if (db.adapter === 'http' || db.adapter === 'https') {\n        explainError(\n          404, 'PouchDB is just checking if a remote checkpoint exists.'\n        );\n      }\n      return {\n        session_id: session,\n        _id: id,\n        history: [],\n        replicator: REPLICATOR,\n        version: CHECKPOINT_VERSION\n      };\n    }\n    throw err;\n  }).then(function (doc) {\n    if (returnValue.cancelled) {\n      return;\n    }\n\n    // if the checkpoint has not changed, do not update\n    if (doc.last_seq === checkpoint) {\n      return;\n    }\n\n    // Filter out current entry for this replication\n    doc.history = (doc.history || []).filter(function (item) {\n      return item.session_id !== session;\n    });\n\n    // Add the latest checkpoint to history\n    doc.history.unshift({\n      last_seq: checkpoint,\n      session_id: session\n    });\n\n    // Just take the last pieces in history, to\n    // avoid really big checkpoint docs.\n    // see comment on history size above\n    doc.history = doc.history.slice(0, CHECKPOINT_HISTORY_SIZE);\n\n    doc.version = CHECKPOINT_VERSION;\n    doc.replicator = REPLICATOR;\n\n    doc.session_id = session;\n    doc.last_seq = checkpoint;\n\n    return db.put(doc).catch(function (err) {\n      if (err.status === 409) {\n        // retry; someone is trying to write a checkpoint simultaneously\n        return updateCheckpoint(db, id, checkpoint, session, returnValue);\n      }\n      throw err;\n    });\n  });\n}\n\nfunction Checkpointer(src, target, id, returnValue, opts) {\n  this.src = src;\n  this.target = target;\n  this.id = id;\n  this.returnValue = returnValue;\n  this.opts = opts || {};\n}\n\nCheckpointer.prototype.writeCheckpoint = function (checkpoint, session) {\n  var self = this;\n  return this.updateTarget(checkpoint, session).then(function () {\n    return self.updateSource(checkpoint, session);\n  });\n};\n\nCheckpointer.prototype.updateTarget = function (checkpoint, session) {\n  if (this.opts.writeTargetCheckpoint) {\n    return updateCheckpoint(this.target, this.id, checkpoint,\n      session, this.returnValue);\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nCheckpointer.prototype.updateSource = function (checkpoint, session) {\n  if (this.opts.writeSourceCheckpoint) {\n    var self = this;\n    return updateCheckpoint(this.src, this.id, checkpoint,\n      session, this.returnValue)\n      .catch(function (err) {\n        if (isForbiddenError(err)) {\n          self.opts.writeSourceCheckpoint = false;\n          return true;\n        }\n        throw err;\n      });\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nvar comparisons = {\n  \"undefined\": function (targetDoc, sourceDoc) {\n    // This is the previous comparison function\n    if (collate(targetDoc.last_seq, sourceDoc.last_seq) === 0) {\n      return sourceDoc.last_seq;\n    }\n    /* istanbul ignore next */\n    return 0;\n  },\n  \"1\": function (targetDoc, sourceDoc) {\n    // This is the comparison function ported from CouchDB\n    return compareReplicationLogs(sourceDoc, targetDoc).last_seq;\n  }\n};\n\nCheckpointer.prototype.getCheckpoint = function () {\n  var self = this;\n\n  if (self.opts && self.opts.writeSourceCheckpoint && !self.opts.writeTargetCheckpoint) {\n    return self.src.get(self.id).then(function (sourceDoc) {\n      return sourceDoc.last_seq || LOWEST_SEQ;\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        throw err;\n      }\n      return LOWEST_SEQ;\n    });\n  }\n\n  return self.target.get(self.id).then(function (targetDoc) {\n    if (self.opts && self.opts.writeTargetCheckpoint && !self.opts.writeSourceCheckpoint) {\n      return targetDoc.last_seq || LOWEST_SEQ;\n    }\n\n    return self.src.get(self.id).then(function (sourceDoc) {\n      // Since we can't migrate an old version doc to a new one\n      // (no session id), we just go with the lowest seq in this case\n      /* istanbul ignore if */\n      if (targetDoc.version !== sourceDoc.version) {\n        return LOWEST_SEQ;\n      }\n\n      var version;\n      if (targetDoc.version) {\n        version = targetDoc.version.toString();\n      } else {\n        version = \"undefined\";\n      }\n\n      if (version in comparisons) {\n        return comparisons[version](targetDoc, sourceDoc);\n      }\n      /* istanbul ignore next */\n      return LOWEST_SEQ;\n    }, function (err) {\n      if (err.status === 404 && targetDoc.last_seq) {\n        return self.src.put({\n          _id: self.id,\n          last_seq: LOWEST_SEQ\n        }).then(function () {\n          return LOWEST_SEQ;\n        }, function (err) {\n          if (isForbiddenError(err)) {\n            self.opts.writeSourceCheckpoint = false;\n            return targetDoc.last_seq;\n          }\n          /* istanbul ignore next */\n          return LOWEST_SEQ;\n        });\n      }\n      throw err;\n    });\n  }).catch(function (err) {\n    if (err.status !== 404) {\n      throw err;\n    }\n    return LOWEST_SEQ;\n  });\n};\n// This checkpoint comparison is ported from CouchDBs source\n// they come from here:\n// https://github.com/apache/couchdb-couch-replicator/blob/master/src/couch_replicator.erl#L863-L906\n\nfunction compareReplicationLogs(srcDoc, tgtDoc) {\n  if (srcDoc.session_id === tgtDoc.session_id) {\n    return {\n      last_seq: srcDoc.last_seq,\n      history: srcDoc.history\n    };\n  }\n\n  return compareReplicationHistory(srcDoc.history, tgtDoc.history);\n}\n\nfunction compareReplicationHistory(sourceHistory, targetHistory) {\n  // the erlang loop via function arguments is not so easy to repeat in JS\n  // therefore, doing this as recursion\n  var S = sourceHistory[0];\n  var sourceRest = sourceHistory.slice(1);\n  var T = targetHistory[0];\n  var targetRest = targetHistory.slice(1);\n\n  if (!S || targetHistory.length === 0) {\n    return {\n      last_seq: LOWEST_SEQ,\n      history: []\n    };\n  }\n\n  var sourceId = S.session_id;\n  /* istanbul ignore if */\n  if (hasSessionId(sourceId, targetHistory)) {\n    return {\n      last_seq: S.last_seq,\n      history: sourceHistory\n    };\n  }\n\n  var targetId = T.session_id;\n  if (hasSessionId(targetId, sourceRest)) {\n    return {\n      last_seq: T.last_seq,\n      history: targetRest\n    };\n  }\n\n  return compareReplicationHistory(sourceRest, targetRest);\n}\n\nfunction hasSessionId(sessionId, history) {\n  var props = history[0];\n  var rest = history.slice(1);\n\n  if (!sessionId || history.length === 0) {\n    return false;\n  }\n\n  if (sessionId === props.session_id) {\n    return true;\n  }\n\n  return hasSessionId(sessionId, rest);\n}\n\nfunction isForbiddenError(err) {\n  return typeof err.status === 'number' && Math.floor(err.status / 100) === 4;\n}\n\nvar STARTING_BACK_OFF = 0;\n\nfunction backOff(opts, returnValue, error, callback) {\n  if (opts.retry === false) {\n    returnValue.emit('error', error);\n    returnValue.removeAllListeners();\n    return;\n  }\n  /* istanbul ignore if */\n  if (typeof opts.back_off_function !== 'function') {\n    opts.back_off_function = defaultBackOff;\n  }\n  returnValue.emit('requestError', error);\n  if (returnValue.state === 'active' || returnValue.state === 'pending') {\n    returnValue.emit('paused', error);\n    returnValue.state = 'stopped';\n    var backOffSet = function backoffTimeSet() {\n      opts.current_back_off = STARTING_BACK_OFF;\n    };\n    var removeBackOffSetter = function removeBackOffTimeSet() {\n      returnValue.removeListener('active', backOffSet);\n    };\n    returnValue.once('paused', removeBackOffSetter);\n    returnValue.once('active', backOffSet);\n  }\n\n  opts.current_back_off = opts.current_back_off || STARTING_BACK_OFF;\n  opts.current_back_off = opts.back_off_function(opts.current_back_off);\n  setTimeout(callback, opts.current_back_off);\n}\n\nfunction sortObjectPropertiesByKey(queryParams) {\n  return Object.keys(queryParams).sort(collate).reduce(function (result, key) {\n    result[key] = queryParams[key];\n    return result;\n  }, {});\n}\n\n// Generate a unique id particular to this replication.\n// Not guaranteed to align perfectly with CouchDB's rep ids.\nfunction generateReplicationId(src, target, opts) {\n  var docIds = opts.doc_ids ? opts.doc_ids.sort(collate) : '';\n  var filterFun = opts.filter ? opts.filter.toString() : '';\n  var queryParams = '';\n  var filterViewName =  '';\n  var selector = '';\n\n  // possibility for checkpoints to be lost here as behaviour of\n  // JSON.stringify is not stable (see #6226)\n  /* istanbul ignore if */\n  if (opts.selector) {\n    selector = JSON.stringify(opts.selector);\n  }\n\n  if (opts.filter && opts.query_params) {\n    queryParams = JSON.stringify(sortObjectPropertiesByKey(opts.query_params));\n  }\n\n  if (opts.filter && opts.filter === '_view') {\n    filterViewName = opts.view.toString();\n  }\n\n  return Promise.all([src.id(), target.id()]).then(function (res) {\n    var queryData = res[0] + res[1] + filterFun + filterViewName +\n      queryParams + docIds + selector;\n    return new Promise(function (resolve) {\n      binaryMd5(queryData, resolve);\n    });\n  }).then(function (md5sum) {\n    // can't use straight-up md5 alphabet, because\n    // the char '/' is interpreted as being for attachments,\n    // and + is also not url-safe\n    md5sum = md5sum.replace(/\\//g, '.').replace(/\\+/g, '_');\n    return '_local/' + md5sum;\n  });\n}\n\nfunction replicate(src, target, opts, returnValue, result) {\n  var batches = [];               // list of batches to be processed\n  var currentBatch;               // the batch currently being processed\n  var pendingBatch = {\n    seq: 0,\n    changes: [],\n    docs: []\n  }; // next batch, not yet ready to be processed\n  var writingCheckpoint = false;  // true while checkpoint is being written\n  var changesCompleted = false;   // true when all changes received\n  var replicationCompleted = false; // true when replication has completed\n  var last_seq = 0;\n  var continuous = opts.continuous || opts.live || false;\n  var batch_size = opts.batch_size || 100;\n  var batches_limit = opts.batches_limit || 10;\n  var changesPending = false;     // true while src.changes is running\n  var doc_ids = opts.doc_ids;\n  var selector = opts.selector;\n  var repId;\n  var checkpointer;\n  var changedDocs = [];\n  // Like couchdb, every replication gets a unique session id\n  var session = uuid();\n\n  result = result || {\n    ok: true,\n    start_time: new Date().toISOString(),\n    docs_read: 0,\n    docs_written: 0,\n    doc_write_failures: 0,\n    errors: []\n  };\n\n  var changesOpts = {};\n  returnValue.ready(src, target);\n\n  function initCheckpointer() {\n    if (checkpointer) {\n      return Promise.resolve();\n    }\n    return generateReplicationId(src, target, opts).then(function (res) {\n      repId = res;\n\n      var checkpointOpts = {};\n      if (opts.checkpoint === false) {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'source') {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'target') {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: true };\n      } else {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: true };\n      }\n\n      checkpointer = new Checkpointer(src, target, repId, returnValue, checkpointOpts);\n    });\n  }\n\n  function writeDocs() {\n    changedDocs = [];\n\n    if (currentBatch.docs.length === 0) {\n      return;\n    }\n    var docs = currentBatch.docs;\n    var bulkOpts = {timeout: opts.timeout};\n    return target.bulkDocs({docs: docs, new_edits: false}, bulkOpts).then(function (res) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n\n      // `res` doesn't include full documents (which live in `docs`), so we create a map of \n      // (id -> error), and check for errors while iterating over `docs`\n      var errorsById = Object.create(null);\n      res.forEach(function (res) {\n        if (res.error) {\n          errorsById[res.id] = res;\n        }\n      });\n\n      var errorsNo = Object.keys(errorsById).length;\n      result.doc_write_failures += errorsNo;\n      result.docs_written += docs.length - errorsNo;\n\n      docs.forEach(function (doc) {\n        var error = errorsById[doc._id];\n        if (error) {\n          result.errors.push(error);\n          // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n          var errorName = (error.name || '').toLowerCase();\n          if (errorName === 'unauthorized' || errorName === 'forbidden') {\n            returnValue.emit('denied', clone(error));\n          } else {\n            throw error;\n          }\n        } else {\n          changedDocs.push(doc);\n        }\n      });\n\n    }, function (err) {\n      result.doc_write_failures += docs.length;\n      throw err;\n    });\n  }\n\n  function finishBatch() {\n    if (currentBatch.error) {\n      throw new Error('There was a problem getting docs.');\n    }\n    result.last_seq = last_seq = currentBatch.seq;\n    var outResult = clone(result);\n    if (changedDocs.length) {\n      outResult.docs = changedDocs;\n      // Attach 'pending' property if server supports it (CouchDB 2.0+)\n      /* istanbul ignore if */\n      if (typeof currentBatch.pending === 'number') {\n        outResult.pending = currentBatch.pending;\n        delete currentBatch.pending;\n      }\n      returnValue.emit('change', outResult);\n    }\n    writingCheckpoint = true;\n    return checkpointer.writeCheckpoint(currentBatch.seq,\n        session).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      currentBatch = undefined;\n      getChanges();\n    }).catch(function (err) {\n      onCheckpointError(err);\n      throw err;\n    });\n  }\n\n  function getDiffs() {\n    var diff = {};\n    currentBatch.changes.forEach(function (change) {\n      // Couchbase Sync Gateway emits these, but we can ignore them\n      /* istanbul ignore if */\n      if (change.id === \"_user/\") {\n        return;\n      }\n      diff[change.id] = change.changes.map(function (x) {\n        return x.rev;\n      });\n    });\n    return target.revsDiff(diff).then(function (diffs) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      // currentBatch.diffs elements are deleted as the documents are written\n      currentBatch.diffs = diffs;\n    });\n  }\n\n  function getBatchDocs() {\n    return getDocs(src, target, currentBatch.diffs, returnValue).then(function (got) {\n      currentBatch.error = !got.ok;\n      got.docs.forEach(function (doc) {\n        delete currentBatch.diffs[doc._id];\n        result.docs_read++;\n        currentBatch.docs.push(doc);\n      });\n    });\n  }\n\n  function startNextBatch() {\n    if (returnValue.cancelled || currentBatch) {\n      return;\n    }\n    if (batches.length === 0) {\n      processPendingBatch(true);\n      return;\n    }\n    currentBatch = batches.shift();\n    getDiffs()\n      .then(getBatchDocs)\n      .then(writeDocs)\n      .then(finishBatch)\n      .then(startNextBatch)\n      .catch(function (err) {\n        abortReplication('batch processing terminated with error', err);\n      });\n  }\n\n\n  function processPendingBatch(immediate$$1) {\n    if (pendingBatch.changes.length === 0) {\n      if (batches.length === 0 && !currentBatch) {\n        if ((continuous && changesOpts.live) || changesCompleted) {\n          returnValue.state = 'pending';\n          returnValue.emit('paused');\n        }\n        if (changesCompleted) {\n          completeReplication();\n        }\n      }\n      return;\n    }\n    if (\n      immediate$$1 ||\n      changesCompleted ||\n      pendingBatch.changes.length >= batch_size\n    ) {\n      batches.push(pendingBatch);\n      pendingBatch = {\n        seq: 0,\n        changes: [],\n        docs: []\n      };\n      if (returnValue.state === 'pending' || returnValue.state === 'stopped') {\n        returnValue.state = 'active';\n        returnValue.emit('active');\n      }\n      startNextBatch();\n    }\n  }\n\n\n  function abortReplication(reason, err) {\n    if (replicationCompleted) {\n      return;\n    }\n    if (!err.message) {\n      err.message = reason;\n    }\n    result.ok = false;\n    result.status = 'aborting';\n    batches = [];\n    pendingBatch = {\n      seq: 0,\n      changes: [],\n      docs: []\n    };\n    completeReplication(err);\n  }\n\n\n  function completeReplication(fatalError) {\n    if (replicationCompleted) {\n      return;\n    }\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      result.status = 'cancelled';\n      if (writingCheckpoint) {\n        return;\n      }\n    }\n    result.status = result.status || 'complete';\n    result.end_time = new Date().toISOString();\n    result.last_seq = last_seq;\n    replicationCompleted = true;\n\n    if (fatalError) {\n      // need to extend the error because Firefox considers \".result\" read-only\n      fatalError = createError(fatalError);\n      fatalError.result = result;\n\n      // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n      var errorName = (fatalError.name || '').toLowerCase();\n      if (errorName === 'unauthorized' || errorName === 'forbidden') {\n        returnValue.emit('error', fatalError);\n        returnValue.removeAllListeners();\n      } else {\n        backOff(opts, returnValue, fatalError, function () {\n          replicate(src, target, opts, returnValue);\n        });\n      }\n    } else {\n      returnValue.emit('complete', result);\n      returnValue.removeAllListeners();\n    }\n  }\n\n\n  function onChange(change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    // Attach 'pending' property if server supports it (CouchDB 2.0+)\n    /* istanbul ignore if */\n    if (typeof pending === 'number') {\n      pendingBatch.pending = pending;\n    }\n\n    var filter = filterChange(opts)(change);\n    if (!filter) {\n      return;\n    }\n    pendingBatch.seq = change.seq || lastSeq;\n    pendingBatch.changes.push(change);\n    immediate(function () {\n      processPendingBatch(batches.length === 0 && changesOpts.live);\n    });\n  }\n\n\n  function onChangesComplete(changes) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n\n    // if no results were returned then we're done,\n    // else fetch more\n    if (changes.results.length > 0) {\n      changesOpts.since = changes.results[changes.results.length - 1].seq;\n      getChanges();\n      processPendingBatch(true);\n    } else {\n\n      var complete = function () {\n        if (continuous) {\n          changesOpts.live = true;\n          getChanges();\n        } else {\n          changesCompleted = true;\n        }\n        processPendingBatch(true);\n      };\n\n      // update the checkpoint so we start from the right seq next time\n      if (!currentBatch && changes.results.length === 0) {\n        writingCheckpoint = true;\n        checkpointer.writeCheckpoint(changes.last_seq,\n            session).then(function () {\n          writingCheckpoint = false;\n          result.last_seq = last_seq = changes.last_seq;\n          complete();\n        })\n        .catch(onCheckpointError);\n      } else {\n        complete();\n      }\n    }\n  }\n\n\n  function onChangesError(err) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    abortReplication('changes rejected', err);\n  }\n\n\n  function getChanges() {\n    if (!(\n      !changesPending &&\n      !changesCompleted &&\n      batches.length < batches_limit\n      )) {\n      return;\n    }\n    changesPending = true;\n    function abortChanges() {\n      changes.cancel();\n    }\n    function removeListener() {\n      returnValue.removeListener('cancel', abortChanges);\n    }\n\n    if (returnValue._changes) { // remove old changes() and listeners\n      returnValue.removeListener('cancel', returnValue._abortChanges);\n      returnValue._changes.cancel();\n    }\n    returnValue.once('cancel', abortChanges);\n\n    var changes = src.changes(changesOpts)\n      .on('change', onChange);\n    changes.then(removeListener, removeListener);\n    changes.then(onChangesComplete)\n      .catch(onChangesError);\n\n    if (opts.retry) {\n      // save for later so we can cancel if necessary\n      returnValue._changes = changes;\n      returnValue._abortChanges = abortChanges;\n    }\n  }\n\n\n  function startChanges() {\n    initCheckpointer().then(function () {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      return checkpointer.getCheckpoint().then(function (checkpoint) {\n        last_seq = checkpoint;\n        changesOpts = {\n          since: last_seq,\n          limit: batch_size,\n          batch_size: batch_size,\n          style: 'all_docs',\n          doc_ids: doc_ids,\n          selector: selector,\n          return_docs: true // required so we know when we're done\n        };\n        if (opts.filter) {\n          if (typeof opts.filter !== 'string') {\n            // required for the client-side filter in onChange\n            changesOpts.include_docs = true;\n          } else { // ddoc filter\n            changesOpts.filter = opts.filter;\n          }\n        }\n        if ('heartbeat' in opts) {\n          changesOpts.heartbeat = opts.heartbeat;\n        }\n        if ('timeout' in opts) {\n          changesOpts.timeout = opts.timeout;\n        }\n        if (opts.query_params) {\n          changesOpts.query_params = opts.query_params;\n        }\n        if (opts.view) {\n          changesOpts.view = opts.view;\n        }\n        getChanges();\n      });\n    }).catch(function (err) {\n      abortReplication('getCheckpoint rejected with ', err);\n    });\n  }\n\n  /* istanbul ignore next */\n  function onCheckpointError(err) {\n    writingCheckpoint = false;\n    abortReplication('writeCheckpoint completed with error', err);\n  }\n\n  /* istanbul ignore if */\n  if (returnValue.cancelled) { // cancelled immediately\n    completeReplication();\n    return;\n  }\n\n  if (!returnValue._addedListeners) {\n    returnValue.once('cancel', completeReplication);\n\n    if (typeof opts.complete === 'function') {\n      returnValue.once('error', opts.complete);\n      returnValue.once('complete', function (result) {\n        opts.complete(null, result);\n      });\n    }\n    returnValue._addedListeners = true;\n  }\n\n  if (typeof opts.since === 'undefined') {\n    startChanges();\n  } else {\n    initCheckpointer().then(function () {\n      writingCheckpoint = true;\n      return checkpointer.writeCheckpoint(opts.since, session);\n    }).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      last_seq = opts.since;\n      startChanges();\n    }).catch(onCheckpointError);\n  }\n}\n\n// We create a basic promise so the caller can cancel the replication possibly\n// before we have actually started listening to changes etc\ninherits(Replication, EventEmitter);\nfunction Replication() {\n  EventEmitter.call(this);\n  this.cancelled = false;\n  this.state = 'pending';\n  var self = this;\n  var promise = new Promise(function (fulfill, reject) {\n    self.once('complete', fulfill);\n    self.once('error', reject);\n  });\n  self.then = function (resolve, reject) {\n    return promise.then(resolve, reject);\n  };\n  self.catch = function (reject) {\n    return promise.catch(reject);\n  };\n  // As we allow error handling via \"error\" event as well,\n  // put a stub in here so that rejecting never throws UnhandledError.\n  self.catch(function () {});\n}\n\nReplication.prototype.cancel = function () {\n  this.cancelled = true;\n  this.state = 'cancelled';\n  this.emit('cancel');\n};\n\nReplication.prototype.ready = function (src, target) {\n  var self = this;\n  if (self._readyCalled) {\n    return;\n  }\n  self._readyCalled = true;\n\n  function onDestroy() {\n    self.cancel();\n  }\n  src.once('destroyed', onDestroy);\n  target.once('destroyed', onDestroy);\n  function cleanup() {\n    src.removeListener('destroyed', onDestroy);\n    target.removeListener('destroyed', onDestroy);\n  }\n  self.once('complete', cleanup);\n};\n\nfunction toPouch(db, opts) {\n  var PouchConstructor = opts.PouchConstructor;\n  if (typeof db === 'string') {\n    return new PouchConstructor(db, opts);\n  } else {\n    return db;\n  }\n}\n\nfunction replicateWrapper(src, target, opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n\n  if (opts.doc_ids && !Array.isArray(opts.doc_ids)) {\n    throw createError(BAD_REQUEST,\n                       \"`doc_ids` filter parameter is not a list.\");\n  }\n\n  opts.complete = callback;\n  opts = clone(opts);\n  opts.continuous = opts.continuous || opts.live;\n  opts.retry = ('retry' in opts) ? opts.retry : false;\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  var replicateRet = new Replication(opts);\n  var srcPouch = toPouch(src, opts);\n  var targetPouch = toPouch(target, opts);\n  replicate(srcPouch, targetPouch, opts, replicateRet);\n  return replicateRet;\n}\n\ninherits(Sync, EventEmitter);\nfunction sync(src, target, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n  opts = clone(opts);\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  src = toPouch(src, opts);\n  target = toPouch(target, opts);\n  return new Sync(src, target, opts, callback);\n}\n\nfunction Sync(src, target, opts, callback) {\n  var self = this;\n  this.canceled = false;\n\n  var optsPush = opts.push ? $inject_Object_assign({}, opts, opts.push) : opts;\n  var optsPull = opts.pull ? $inject_Object_assign({}, opts, opts.pull) : opts;\n\n  this.push = replicateWrapper(src, target, optsPush);\n  this.pull = replicateWrapper(target, src, optsPull);\n\n  this.pushPaused = true;\n  this.pullPaused = true;\n\n  function pullChange(change) {\n    self.emit('change', {\n      direction: 'pull',\n      change: change\n    });\n  }\n  function pushChange(change) {\n    self.emit('change', {\n      direction: 'push',\n      change: change\n    });\n  }\n  function pushDenied(doc) {\n    self.emit('denied', {\n      direction: 'push',\n      doc: doc\n    });\n  }\n  function pullDenied(doc) {\n    self.emit('denied', {\n      direction: 'pull',\n      doc: doc\n    });\n  }\n  function pushPaused() {\n    self.pushPaused = true;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('paused');\n    }\n  }\n  function pullPaused() {\n    self.pullPaused = true;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('paused');\n    }\n  }\n  function pushActive() {\n    self.pushPaused = false;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('active', {\n        direction: 'push'\n      });\n    }\n  }\n  function pullActive() {\n    self.pullPaused = false;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('active', {\n        direction: 'pull'\n      });\n    }\n  }\n\n  var removed = {};\n\n  function removeAll(type) { // type is 'push' or 'pull'\n    return function (event, func) {\n      var isChange = event === 'change' &&\n        (func === pullChange || func === pushChange);\n      var isDenied = event === 'denied' &&\n        (func === pullDenied || func === pushDenied);\n      var isPaused = event === 'paused' &&\n        (func === pullPaused || func === pushPaused);\n      var isActive = event === 'active' &&\n        (func === pullActive || func === pushActive);\n\n      if (isChange || isDenied || isPaused || isActive) {\n        if (!(event in removed)) {\n          removed[event] = {};\n        }\n        removed[event][type] = true;\n        if (Object.keys(removed[event]).length === 2) {\n          // both push and pull have asked to be removed\n          self.removeAllListeners(event);\n        }\n      }\n    };\n  }\n\n  if (opts.live) {\n    this.push.on('complete', self.pull.cancel.bind(self.pull));\n    this.pull.on('complete', self.push.cancel.bind(self.push));\n  }\n\n  function addOneListener(ee, event, listener) {\n    if (ee.listeners(event).indexOf(listener) == -1) {\n      ee.on(event, listener);\n    }\n  }\n\n  this.on('newListener', function (event) {\n    if (event === 'change') {\n      addOneListener(self.pull, 'change', pullChange);\n      addOneListener(self.push, 'change', pushChange);\n    } else if (event === 'denied') {\n      addOneListener(self.pull, 'denied', pullDenied);\n      addOneListener(self.push, 'denied', pushDenied);\n    } else if (event === 'active') {\n      addOneListener(self.pull, 'active', pullActive);\n      addOneListener(self.push, 'active', pushActive);\n    } else if (event === 'paused') {\n      addOneListener(self.pull, 'paused', pullPaused);\n      addOneListener(self.push, 'paused', pushPaused);\n    }\n  });\n\n  this.on('removeListener', function (event) {\n    if (event === 'change') {\n      self.pull.removeListener('change', pullChange);\n      self.push.removeListener('change', pushChange);\n    } else if (event === 'denied') {\n      self.pull.removeListener('denied', pullDenied);\n      self.push.removeListener('denied', pushDenied);\n    } else if (event === 'active') {\n      self.pull.removeListener('active', pullActive);\n      self.push.removeListener('active', pushActive);\n    } else if (event === 'paused') {\n      self.pull.removeListener('paused', pullPaused);\n      self.push.removeListener('paused', pushPaused);\n    }\n  });\n\n  this.pull.on('removeListener', removeAll('pull'));\n  this.push.on('removeListener', removeAll('push'));\n\n  var promise = Promise.all([\n    this.push,\n    this.pull\n  ]).then(function (resp) {\n    var out = {\n      push: resp[0],\n      pull: resp[1]\n    };\n    self.emit('complete', out);\n    if (callback) {\n      callback(null, out);\n    }\n    self.removeAllListeners();\n    return out;\n  }, function (err) {\n    self.cancel();\n    if (callback) {\n      // if there's a callback, then the callback can receive\n      // the error event\n      callback(err);\n    } else {\n      // if there's no callback, then we're safe to emit an error\n      // event, which would otherwise throw an unhandled error\n      // due to 'error' being a special event in EventEmitters\n      self.emit('error', err);\n    }\n    self.removeAllListeners();\n    if (callback) {\n      // no sense throwing if we're already emitting an 'error' event\n      throw err;\n    }\n  });\n\n  this.then = function (success, err) {\n    return promise.then(success, err);\n  };\n\n  this.catch = function (err) {\n    return promise.catch(err);\n  };\n}\n\nSync.prototype.cancel = function () {\n  if (!this.canceled) {\n    this.canceled = true;\n    this.push.cancel();\n    this.pull.cancel();\n  }\n};\n\nfunction replication(PouchDB) {\n  PouchDB.replicate = replicateWrapper;\n  PouchDB.sync = sync;\n\n  Object.defineProperty(PouchDB.prototype, 'replicate', {\n    get: function () {\n      var self = this;\n      if (typeof this.replicateMethods === 'undefined') {\n        this.replicateMethods = {\n          from: function (other, opts, callback) {\n            return self.constructor.replicate(other, self, opts, callback);\n          },\n          to: function (other, opts, callback) {\n            return self.constructor.replicate(self, other, opts, callback);\n          }\n        };\n      }\n      return this.replicateMethods;\n    }\n  });\n\n  PouchDB.prototype.sync = function (dbName, opts, callback) {\n    return this.constructor.sync(this, dbName, opts, callback);\n  };\n}\n\nPouchDB.plugin(IDBPouch)\n  .plugin(HttpPouch$1)\n  .plugin(mapreduce)\n  .plugin(replication);\n\n// Pull from src because pouchdb-node/pouchdb-browser themselves\n\nexport default PouchDB;\n","'use strict';\n\nif (typeof Promise === 'undefined') {\n  // Rejection tracking prevents a common issue where React gets into an\n  // inconsistent state due to an error, but it gets swallowed by a Promise,\n  // and the user has no idea what causes React's erratic future behavior.\n  require('promise/lib/rejection-tracking').enable();\n  window.Promise = require('promise/lib/es6-extensions.js');\n}\n\n// fetch() polyfill for making API calls.\nrequire('whatwg-fetch');\n\n// Object.assign() is commonly used with React.\n// It will use the native implementation if it's present and isn't buggy.\nObject.assign = require('object-assign');\n","'use strict';\n\nvar Promise = require('./core');\n\nvar DEFAULT_WHITELIST = [\n  ReferenceError,\n  TypeError,\n  RangeError\n];\n\nvar enabled = false;\nexports.disable = disable;\nfunction disable() {\n  enabled = false;\n  Promise._Y = null;\n  Promise._Z = null;\n}\n\nexports.enable = enable;\nfunction enable(options) {\n  options = options || {};\n  if (enabled) disable();\n  enabled = true;\n  var id = 0;\n  var displayId = 0;\n  var rejections = {};\n  Promise._Y = function (promise) {\n    if (\n      promise._V === 2 && // IS REJECTED\n      rejections[promise._1]\n    ) {\n      if (rejections[promise._1].logged) {\n        onHandled(promise._1);\n      } else {\n        clearTimeout(rejections[promise._1].timeout);\n      }\n      delete rejections[promise._1];\n    }\n  };\n  Promise._Z = function (promise, err) {\n    if (promise._U === 0) { // not yet handled\n      promise._1 = id++;\n      rejections[promise._1] = {\n        displayId: null,\n        error: err,\n        timeout: setTimeout(\n          onUnhandled.bind(null, promise._1),\n          // For reference errors and type errors, this almost always\n          // means the programmer made a mistake, so log them after just\n          // 100ms\n          // otherwise, wait 2 seconds to see if they get handled\n          matchWhitelist(err, DEFAULT_WHITELIST)\n            ? 100\n            : 2000\n        ),\n        logged: false\n      };\n    }\n  };\n  function onUnhandled(id) {\n    if (\n      options.allRejections ||\n      matchWhitelist(\n        rejections[id].error,\n        options.whitelist || DEFAULT_WHITELIST\n      )\n    ) {\n      rejections[id].displayId = displayId++;\n      if (options.onUnhandled) {\n        rejections[id].logged = true;\n        options.onUnhandled(\n          rejections[id].displayId,\n          rejections[id].error\n        );\n      } else {\n        rejections[id].logged = true;\n        logError(\n          rejections[id].displayId,\n          rejections[id].error\n        );\n      }\n    }\n  }\n  function onHandled(id) {\n    if (rejections[id].logged) {\n      if (options.onHandled) {\n        options.onHandled(rejections[id].displayId, rejections[id].error);\n      } else if (!rejections[id].onUnhandled) {\n        console.warn(\n          'Promise Rejection Handled (id: ' + rejections[id].displayId + '):'\n        );\n        console.warn(\n          '  This means you can ignore any previous messages of the form \"Possible Unhandled Promise Rejection\" with id ' +\n          rejections[id].displayId + '.'\n        );\n      }\n    }\n  }\n}\n\nfunction logError(id, error) {\n  console.warn('Possible Unhandled Promise Rejection (id: ' + id + '):');\n  var errStr = (error && (error.stack || error)) + '';\n  errStr.split('\\n').forEach(function (line) {\n    console.warn('  ' + line);\n  });\n}\n\nfunction matchWhitelist(error, list) {\n  return list.some(function (cls) {\n    return error instanceof cls;\n  });\n}","\"use strict\";\n\n// Use the fastest means possible to execute a task in its own turn, with\n// priority over other events including IO, animation, reflow, and redraw\n// events in browsers.\n//\n// An exception thrown by a task will permanently interrupt the processing of\n// subsequent tasks. The higher level `asap` function ensures that if an\n// exception is thrown by a task, that the task queue will continue flushing as\n// soon as possible, but if you use `rawAsap` directly, you are responsible to\n// either ensure that no exceptions are thrown from your task, or to manually\n// call `rawAsap.requestFlush` if an exception is thrown.\nmodule.exports = rawAsap;\nfunction rawAsap(task) {\n    if (!queue.length) {\n        requestFlush();\n        flushing = true;\n    }\n    // Equivalent to push, but avoids a function call.\n    queue[queue.length] = task;\n}\n\nvar queue = [];\n// Once a flush has been requested, no further calls to `requestFlush` are\n// necessary until the next `flush` completes.\nvar flushing = false;\n// `requestFlush` is an implementation-specific method that attempts to kick\n// off a `flush` event as quickly as possible. `flush` will attempt to exhaust\n// the event queue before yielding to the browser's own event loop.\nvar requestFlush;\n// The position of the next task to execute in the task queue. This is\n// preserved between calls to `flush` so that it can be resumed if\n// a task throws an exception.\nvar index = 0;\n// If a task schedules additional tasks recursively, the task queue can grow\n// unbounded. To prevent memory exhaustion, the task queue will periodically\n// truncate already-completed tasks.\nvar capacity = 1024;\n\n// The flush function processes all tasks that have been scheduled with\n// `rawAsap` unless and until one of those tasks throws an exception.\n// If a task throws an exception, `flush` ensures that its state will remain\n// consistent and will resume where it left off when called again.\n// However, `flush` does not make any arrangements to be called again if an\n// exception is thrown.\nfunction flush() {\n    while (index < queue.length) {\n        var currentIndex = index;\n        // Advance the index before calling the task. This ensures that we will\n        // begin flushing on the next task the task throws an error.\n        index = index + 1;\n        queue[currentIndex].call();\n        // Prevent leaking memory for long chains of recursive calls to `asap`.\n        // If we call `asap` within tasks scheduled by `asap`, the queue will\n        // grow, but to avoid an O(n) walk for every task we execute, we don't\n        // shift tasks off the queue after they have been executed.\n        // Instead, we periodically shift 1024 tasks off the queue.\n        if (index > capacity) {\n            // Manually shift all values starting at the index back to the\n            // beginning of the queue.\n            for (var scan = 0, newLength = queue.length - index; scan < newLength; scan++) {\n                queue[scan] = queue[scan + index];\n            }\n            queue.length -= index;\n            index = 0;\n        }\n    }\n    queue.length = 0;\n    index = 0;\n    flushing = false;\n}\n\n// `requestFlush` is implemented using a strategy based on data collected from\n// every available SauceLabs Selenium web driver worker at time of writing.\n// https://docs.google.com/spreadsheets/d/1mG-5UYGup5qxGdEMWkhP6BWCz053NUb2E1QoUTU16uA/edit#gid=783724593\n\n// Safari 6 and 6.1 for desktop, iPad, and iPhone are the only browsers that\n// have WebKitMutationObserver but not un-prefixed MutationObserver.\n// Must use `global` or `self` instead of `window` to work in both frames and web\n// workers. `global` is a provision of Browserify, Mr, Mrs, or Mop.\n\n/* globals self */\nvar scope = typeof global !== \"undefined\" ? global : self;\nvar BrowserMutationObserver = scope.MutationObserver || scope.WebKitMutationObserver;\n\n// MutationObservers are desirable because they have high priority and work\n// reliably everywhere they are implemented.\n// They are implemented in all modern browsers.\n//\n// - Android 4-4.3\n// - Chrome 26-34\n// - Firefox 14-29\n// - Internet Explorer 11\n// - iPad Safari 6-7.1\n// - iPhone Safari 7-7.1\n// - Safari 6-7\nif (typeof BrowserMutationObserver === \"function\") {\n    requestFlush = makeRequestCallFromMutationObserver(flush);\n\n// MessageChannels are desirable because they give direct access to the HTML\n// task queue, are implemented in Internet Explorer 10, Safari 5.0-1, and Opera\n// 11-12, and in web workers in many engines.\n// Although message channels yield to any queued rendering and IO tasks, they\n// would be better than imposing the 4ms delay of timers.\n// However, they do not work reliably in Internet Explorer or Safari.\n\n// Internet Explorer 10 is the only browser that has setImmediate but does\n// not have MutationObservers.\n// Although setImmediate yields to the browser's renderer, it would be\n// preferrable to falling back to setTimeout since it does not have\n// the minimum 4ms penalty.\n// Unfortunately there appears to be a bug in Internet Explorer 10 Mobile (and\n// Desktop to a lesser extent) that renders both setImmediate and\n// MessageChannel useless for the purposes of ASAP.\n// https://github.com/kriskowal/q/issues/396\n\n// Timers are implemented universally.\n// We fall back to timers in workers in most engines, and in foreground\n// contexts in the following browsers.\n// However, note that even this simple case requires nuances to operate in a\n// broad spectrum of browsers.\n//\n// - Firefox 3-13\n// - Internet Explorer 6-9\n// - iPad Safari 4.3\n// - Lynx 2.8.7\n} else {\n    requestFlush = makeRequestCallFromTimer(flush);\n}\n\n// `requestFlush` requests that the high priority event queue be flushed as\n// soon as possible.\n// This is useful to prevent an error thrown in a task from stalling the event\n// queue if the exception handled by Node.jss\n// `process.on(\"uncaughtException\")` or by a domain.\nrawAsap.requestFlush = requestFlush;\n\n// To request a high priority event, we induce a mutation observer by toggling\n// the text of a text node between \"1\" and \"-1\".\nfunction makeRequestCallFromMutationObserver(callback) {\n    var toggle = 1;\n    var observer = new BrowserMutationObserver(callback);\n    var node = document.createTextNode(\"\");\n    observer.observe(node, {characterData: true});\n    return function requestCall() {\n        toggle = -toggle;\n        node.data = toggle;\n    };\n}\n\n// The message channel technique was discovered by Malte Ubl and was the\n// original foundation for this library.\n// http://www.nonblocking.io/2011/06/windownexttick.html\n\n// Safari 6.0.5 (at least) intermittently fails to create message ports on a\n// page's first load. Thankfully, this version of Safari supports\n// MutationObservers, so we don't need to fall back in that case.\n\n// function makeRequestCallFromMessageChannel(callback) {\n//     var channel = new MessageChannel();\n//     channel.port1.onmessage = callback;\n//     return function requestCall() {\n//         channel.port2.postMessage(0);\n//     };\n// }\n\n// For reasons explained above, we are also unable to use `setImmediate`\n// under any circumstances.\n// Even if we were, there is another bug in Internet Explorer 10.\n// It is not sufficient to assign `setImmediate` to `requestFlush` because\n// `setImmediate` must be called *by name* and therefore must be wrapped in a\n// closure.\n// Never forget.\n\n// function makeRequestCallFromSetImmediate(callback) {\n//     return function requestCall() {\n//         setImmediate(callback);\n//     };\n// }\n\n// Safari 6.0 has a problem where timers will get lost while the user is\n// scrolling. This problem does not impact ASAP because Safari 6.0 supports\n// mutation observers, so that implementation is used instead.\n// However, if we ever elect to use timers in Safari, the prevalent work-around\n// is to add a scroll event listener that calls for a flush.\n\n// `setTimeout` does not call the passed callback if the delay is less than\n// approximately 7 in web workers in Firefox 8 through 18, and sometimes not\n// even then.\n\nfunction makeRequestCallFromTimer(callback) {\n    return function requestCall() {\n        // We dispatch a timeout with a specified delay of 0 for engines that\n        // can reliably accommodate that request. This will usually be snapped\n        // to a 4 milisecond delay, but once we're flushing, there's no delay\n        // between events.\n        var timeoutHandle = setTimeout(handleTimer, 0);\n        // However, since this timer gets frequently dropped in Firefox\n        // workers, we enlist an interval handle that will try to fire\n        // an event 20 times per second until it succeeds.\n        var intervalHandle = setInterval(handleTimer, 50);\n\n        function handleTimer() {\n            // Whichever timer succeeds will cancel both timers and\n            // execute the callback.\n            clearTimeout(timeoutHandle);\n            clearInterval(intervalHandle);\n            callback();\n        }\n    };\n}\n\n// This is for `asap.js` only.\n// Its name will be periodically randomized to break any code that depends on\n// its existence.\nrawAsap.makeRequestCallFromTimer = makeRequestCallFromTimer;\n\n// ASAP was originally a nextTick shim included in Q. This was factored out\n// into this ASAP package. It was later adapted to RSVP which made further\n// amendments. These decisions, particularly to marginalize MessageChannel and\n// to capture the MutationObserver implementation in a closure, were integrated\n// back into ASAP proper.\n// https://github.com/tildeio/rsvp.js/blob/cddf7232546a9cf858524b75cde6f9edf72620a7/lib/rsvp/asap.js\n","'use strict';\n\n//This file contains the ES6 extensions to the core Promises/A+ API\n\nvar Promise = require('./core.js');\n\nmodule.exports = Promise;\n\n/* Static Functions */\n\nvar TRUE = valuePromise(true);\nvar FALSE = valuePromise(false);\nvar NULL = valuePromise(null);\nvar UNDEFINED = valuePromise(undefined);\nvar ZERO = valuePromise(0);\nvar EMPTYSTRING = valuePromise('');\n\nfunction valuePromise(value) {\n  var p = new Promise(Promise._0);\n  p._V = 1;\n  p._W = value;\n  return p;\n}\nPromise.resolve = function (value) {\n  if (value instanceof Promise) return value;\n\n  if (value === null) return NULL;\n  if (value === undefined) return UNDEFINED;\n  if (value === true) return TRUE;\n  if (value === false) return FALSE;\n  if (value === 0) return ZERO;\n  if (value === '') return EMPTYSTRING;\n\n  if (typeof value === 'object' || typeof value === 'function') {\n    try {\n      var then = value.then;\n      if (typeof then === 'function') {\n        return new Promise(then.bind(value));\n      }\n    } catch (ex) {\n      return new Promise(function (resolve, reject) {\n        reject(ex);\n      });\n    }\n  }\n  return valuePromise(value);\n};\n\nvar iterableToArray = function (iterable) {\n  if (typeof Array.from === 'function') {\n    // ES2015+, iterables exist\n    iterableToArray = Array.from;\n    return Array.from(iterable);\n  }\n\n  // ES5, only arrays and array-likes exist\n  iterableToArray = function (x) { return Array.prototype.slice.call(x); };\n  return Array.prototype.slice.call(iterable);\n}\n\nPromise.all = function (arr) {\n  var args = iterableToArray(arr);\n\n  return new Promise(function (resolve, reject) {\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n    function res(i, val) {\n      if (val && (typeof val === 'object' || typeof val === 'function')) {\n        if (val instanceof Promise && val.then === Promise.prototype.then) {\n          while (val._V === 3) {\n            val = val._W;\n          }\n          if (val._V === 1) return res(i, val._W);\n          if (val._V === 2) reject(val._W);\n          val.then(function (val) {\n            res(i, val);\n          }, reject);\n          return;\n        } else {\n          var then = val.then;\n          if (typeof then === 'function') {\n            var p = new Promise(then.bind(val));\n            p.then(function (val) {\n              res(i, val);\n            }, reject);\n            return;\n          }\n        }\n      }\n      args[i] = val;\n      if (--remaining === 0) {\n        resolve(args);\n      }\n    }\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.reject = function (value) {\n  return new Promise(function (resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function (values) {\n  return new Promise(function (resolve, reject) {\n    iterableToArray(values).forEach(function(value){\n      Promise.resolve(value).then(resolve, reject);\n    });\n  });\n};\n\n/* Prototype Methods */\n\nPromise.prototype['catch'] = function (onRejected) {\n  return this.then(null, onRejected);\n};\n","var support = {\n  searchParams: 'URLSearchParams' in self,\n  iterable: 'Symbol' in self && 'iterator' in Symbol,\n  blob:\n    'FileReader' in self &&\n    'Blob' in self &&\n    (function() {\n      try {\n        new Blob()\n        return true\n      } catch (e) {\n        return false\n      }\n    })(),\n  formData: 'FormData' in self,\n  arrayBuffer: 'ArrayBuffer' in self\n}\n\nfunction isDataView(obj) {\n  return obj && DataView.prototype.isPrototypeOf(obj)\n}\n\nif (support.arrayBuffer) {\n  var viewClasses = [\n    '[object Int8Array]',\n    '[object Uint8Array]',\n    '[object Uint8ClampedArray]',\n    '[object Int16Array]',\n    '[object Uint16Array]',\n    '[object Int32Array]',\n    '[object Uint32Array]',\n    '[object Float32Array]',\n    '[object Float64Array]'\n  ]\n\n  var isArrayBufferView =\n    ArrayBuffer.isView ||\n    function(obj) {\n      return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n    }\n}\n\nfunction normalizeName(name) {\n  if (typeof name !== 'string') {\n    name = String(name)\n  }\n  if (/[^a-z0-9\\-#$%&'*+.^_`|~]/i.test(name)) {\n    throw new TypeError('Invalid character in header field name')\n  }\n  return name.toLowerCase()\n}\n\nfunction normalizeValue(value) {\n  if (typeof value !== 'string') {\n    value = String(value)\n  }\n  return value\n}\n\n// Build a destructive iterator for the value list\nfunction iteratorFor(items) {\n  var iterator = {\n    next: function() {\n      var value = items.shift()\n      return {done: value === undefined, value: value}\n    }\n  }\n\n  if (support.iterable) {\n    iterator[Symbol.iterator] = function() {\n      return iterator\n    }\n  }\n\n  return iterator\n}\n\nexport function Headers(headers) {\n  this.map = {}\n\n  if (headers instanceof Headers) {\n    headers.forEach(function(value, name) {\n      this.append(name, value)\n    }, this)\n  } else if (Array.isArray(headers)) {\n    headers.forEach(function(header) {\n      this.append(header[0], header[1])\n    }, this)\n  } else if (headers) {\n    Object.getOwnPropertyNames(headers).forEach(function(name) {\n      this.append(name, headers[name])\n    }, this)\n  }\n}\n\nHeaders.prototype.append = function(name, value) {\n  name = normalizeName(name)\n  value = normalizeValue(value)\n  var oldValue = this.map[name]\n  this.map[name] = oldValue ? oldValue + ', ' + value : value\n}\n\nHeaders.prototype['delete'] = function(name) {\n  delete this.map[normalizeName(name)]\n}\n\nHeaders.prototype.get = function(name) {\n  name = normalizeName(name)\n  return this.has(name) ? this.map[name] : null\n}\n\nHeaders.prototype.has = function(name) {\n  return this.map.hasOwnProperty(normalizeName(name))\n}\n\nHeaders.prototype.set = function(name, value) {\n  this.map[normalizeName(name)] = normalizeValue(value)\n}\n\nHeaders.prototype.forEach = function(callback, thisArg) {\n  for (var name in this.map) {\n    if (this.map.hasOwnProperty(name)) {\n      callback.call(thisArg, this.map[name], name, this)\n    }\n  }\n}\n\nHeaders.prototype.keys = function() {\n  var items = []\n  this.forEach(function(value, name) {\n    items.push(name)\n  })\n  return iteratorFor(items)\n}\n\nHeaders.prototype.values = function() {\n  var items = []\n  this.forEach(function(value) {\n    items.push(value)\n  })\n  return iteratorFor(items)\n}\n\nHeaders.prototype.entries = function() {\n  var items = []\n  this.forEach(function(value, name) {\n    items.push([name, value])\n  })\n  return iteratorFor(items)\n}\n\nif (support.iterable) {\n  Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n}\n\nfunction consumed(body) {\n  if (body.bodyUsed) {\n    return Promise.reject(new TypeError('Already read'))\n  }\n  body.bodyUsed = true\n}\n\nfunction fileReaderReady(reader) {\n  return new Promise(function(resolve, reject) {\n    reader.onload = function() {\n      resolve(reader.result)\n    }\n    reader.onerror = function() {\n      reject(reader.error)\n    }\n  })\n}\n\nfunction readBlobAsArrayBuffer(blob) {\n  var reader = new FileReader()\n  var promise = fileReaderReady(reader)\n  reader.readAsArrayBuffer(blob)\n  return promise\n}\n\nfunction readBlobAsText(blob) {\n  var reader = new FileReader()\n  var promise = fileReaderReady(reader)\n  reader.readAsText(blob)\n  return promise\n}\n\nfunction readArrayBufferAsText(buf) {\n  var view = new Uint8Array(buf)\n  var chars = new Array(view.length)\n\n  for (var i = 0; i < view.length; i++) {\n    chars[i] = String.fromCharCode(view[i])\n  }\n  return chars.join('')\n}\n\nfunction bufferClone(buf) {\n  if (buf.slice) {\n    return buf.slice(0)\n  } else {\n    var view = new Uint8Array(buf.byteLength)\n    view.set(new Uint8Array(buf))\n    return view.buffer\n  }\n}\n\nfunction Body() {\n  this.bodyUsed = false\n\n  this._initBody = function(body) {\n    this._bodyInit = body\n    if (!body) {\n      this._bodyText = ''\n    } else if (typeof body === 'string') {\n      this._bodyText = body\n    } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n      this._bodyBlob = body\n    } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n      this._bodyFormData = body\n    } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n      this._bodyText = body.toString()\n    } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n      this._bodyArrayBuffer = bufferClone(body.buffer)\n      // IE 10-11 can't handle a DataView body.\n      this._bodyInit = new Blob([this._bodyArrayBuffer])\n    } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n      this._bodyArrayBuffer = bufferClone(body)\n    } else {\n      this._bodyText = body = Object.prototype.toString.call(body)\n    }\n\n    if (!this.headers.get('content-type')) {\n      if (typeof body === 'string') {\n        this.headers.set('content-type', 'text/plain;charset=UTF-8')\n      } else if (this._bodyBlob && this._bodyBlob.type) {\n        this.headers.set('content-type', this._bodyBlob.type)\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n      }\n    }\n  }\n\n  if (support.blob) {\n    this.blob = function() {\n      var rejected = consumed(this)\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return Promise.resolve(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as blob')\n      } else {\n        return Promise.resolve(new Blob([this._bodyText]))\n      }\n    }\n\n    this.arrayBuffer = function() {\n      if (this._bodyArrayBuffer) {\n        return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n      } else {\n        return this.blob().then(readBlobAsArrayBuffer)\n      }\n    }\n  }\n\n  this.text = function() {\n    var rejected = consumed(this)\n    if (rejected) {\n      return rejected\n    }\n\n    if (this._bodyBlob) {\n      return readBlobAsText(this._bodyBlob)\n    } else if (this._bodyArrayBuffer) {\n      return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n    } else if (this._bodyFormData) {\n      throw new Error('could not read FormData body as text')\n    } else {\n      return Promise.resolve(this._bodyText)\n    }\n  }\n\n  if (support.formData) {\n    this.formData = function() {\n      return this.text().then(decode)\n    }\n  }\n\n  this.json = function() {\n    return this.text().then(JSON.parse)\n  }\n\n  return this\n}\n\n// HTTP methods whose capitalization should be normalized\nvar methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\nfunction normalizeMethod(method) {\n  var upcased = method.toUpperCase()\n  return methods.indexOf(upcased) > -1 ? upcased : method\n}\n\nexport function Request(input, options) {\n  options = options || {}\n  var body = options.body\n\n  if (input instanceof Request) {\n    if (input.bodyUsed) {\n      throw new TypeError('Already read')\n    }\n    this.url = input.url\n    this.credentials = input.credentials\n    if (!options.headers) {\n      this.headers = new Headers(input.headers)\n    }\n    this.method = input.method\n    this.mode = input.mode\n    this.signal = input.signal\n    if (!body && input._bodyInit != null) {\n      body = input._bodyInit\n      input.bodyUsed = true\n    }\n  } else {\n    this.url = String(input)\n  }\n\n  this.credentials = options.credentials || this.credentials || 'same-origin'\n  if (options.headers || !this.headers) {\n    this.headers = new Headers(options.headers)\n  }\n  this.method = normalizeMethod(options.method || this.method || 'GET')\n  this.mode = options.mode || this.mode || null\n  this.signal = options.signal || this.signal\n  this.referrer = null\n\n  if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n    throw new TypeError('Body not allowed for GET or HEAD requests')\n  }\n  this._initBody(body)\n}\n\nRequest.prototype.clone = function() {\n  return new Request(this, {body: this._bodyInit})\n}\n\nfunction decode(body) {\n  var form = new FormData()\n  body\n    .trim()\n    .split('&')\n    .forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n  return form\n}\n\nfunction parseHeaders(rawHeaders) {\n  var headers = new Headers()\n  // Replace instances of \\r\\n and \\n followed by at least one space or horizontal tab with a space\n  // https://tools.ietf.org/html/rfc7230#section-3.2\n  var preProcessedHeaders = rawHeaders.replace(/\\r?\\n[\\t ]+/g, ' ')\n  preProcessedHeaders.split(/\\r?\\n/).forEach(function(line) {\n    var parts = line.split(':')\n    var key = parts.shift().trim()\n    if (key) {\n      var value = parts.join(':').trim()\n      headers.append(key, value)\n    }\n  })\n  return headers\n}\n\nBody.call(Request.prototype)\n\nexport function Response(bodyInit, options) {\n  if (!options) {\n    options = {}\n  }\n\n  this.type = 'default'\n  this.status = options.status === undefined ? 200 : options.status\n  this.ok = this.status >= 200 && this.status < 300\n  this.statusText = 'statusText' in options ? options.statusText : 'OK'\n  this.headers = new Headers(options.headers)\n  this.url = options.url || ''\n  this._initBody(bodyInit)\n}\n\nBody.call(Response.prototype)\n\nResponse.prototype.clone = function() {\n  return new Response(this._bodyInit, {\n    status: this.status,\n    statusText: this.statusText,\n    headers: new Headers(this.headers),\n    url: this.url\n  })\n}\n\nResponse.error = function() {\n  var response = new Response(null, {status: 0, statusText: ''})\n  response.type = 'error'\n  return response\n}\n\nvar redirectStatuses = [301, 302, 303, 307, 308]\n\nResponse.redirect = function(url, status) {\n  if (redirectStatuses.indexOf(status) === -1) {\n    throw new RangeError('Invalid status code')\n  }\n\n  return new Response(null, {status: status, headers: {location: url}})\n}\n\nexport var DOMException = self.DOMException\ntry {\n  new DOMException()\n} catch (err) {\n  DOMException = function(message, name) {\n    this.message = message\n    this.name = name\n    var error = Error(message)\n    this.stack = error.stack\n  }\n  DOMException.prototype = Object.create(Error.prototype)\n  DOMException.prototype.constructor = DOMException\n}\n\nexport function fetch(input, init) {\n  return new Promise(function(resolve, reject) {\n    var request = new Request(input, init)\n\n    if (request.signal && request.signal.aborted) {\n      return reject(new DOMException('Aborted', 'AbortError'))\n    }\n\n    var xhr = new XMLHttpRequest()\n\n    function abortXhr() {\n      xhr.abort()\n    }\n\n    xhr.onload = function() {\n      var options = {\n        status: xhr.status,\n        statusText: xhr.statusText,\n        headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n      }\n      options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL')\n      var body = 'response' in xhr ? xhr.response : xhr.responseText\n      resolve(new Response(body, options))\n    }\n\n    xhr.onerror = function() {\n      reject(new TypeError('Network request failed'))\n    }\n\n    xhr.ontimeout = function() {\n      reject(new TypeError('Network request failed'))\n    }\n\n    xhr.onabort = function() {\n      reject(new DOMException('Aborted', 'AbortError'))\n    }\n\n    xhr.open(request.method, request.url, true)\n\n    if (request.credentials === 'include') {\n      xhr.withCredentials = true\n    } else if (request.credentials === 'omit') {\n      xhr.withCredentials = false\n    }\n\n    if ('responseType' in xhr && support.blob) {\n      xhr.responseType = 'blob'\n    }\n\n    request.headers.forEach(function(value, name) {\n      xhr.setRequestHeader(name, value)\n    })\n\n    if (request.signal) {\n      request.signal.addEventListener('abort', abortXhr)\n\n      xhr.onreadystatechange = function() {\n        // DONE (success or failure)\n        if (xhr.readyState === 4) {\n          request.signal.removeEventListener('abort', abortXhr)\n        }\n      }\n    }\n\n    xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n  })\n}\n\nfetch.polyfill = true\n\nif (!self.fetch) {\n  self.fetch = fetch\n  self.Headers = Headers\n  self.Request = Request\n  self.Response = Response\n}\n","/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n"],"sourceRoot":""}